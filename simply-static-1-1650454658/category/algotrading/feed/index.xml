<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Algorithmic Trading &#8211; Niklas Baier</title>
	<atom:link href="https://niklasbaier.github.io/me/category/algotrading/feed/" rel="self" type="application/rss+xml" />
	<link>https://niklasbaier.github.io/me/</link>
	<description>My personal website.</description>
	<lastBuildDate>Mon, 20 Dec 2021 14:05:35 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>
	hourly	</sy:updatePeriod>
	<sy:updateFrequency>
	1	</sy:updateFrequency>
	<generator>https://wordpress.org/?v=5.9.3</generator>
	<item>
		<title>Building up a Securities Master Database</title>
		<link>https://niklasbaier.github.io/me/building-up-a-securities-master-database/</link>
					<comments>https://niklasbaier.github.io/me/building-up-a-securities-master-database/#respond</comments>
		
		<dc:creator><![CDATA[Niklas Baier]]></dc:creator>
		<pubDate>Mon, 06 Dec 2021 18:51:18 +0000</pubDate>
				<category><![CDATA[Algorithmic Trading]]></category>
		<category><![CDATA[Quantitative Finance]]></category>
		<guid isPermaLink="false">https://niklasbaier.github.io/me/?p=49</guid>

					<description><![CDATA[Building up a Securities Master Database This is the first big post in a series of detailed articles about building up a Full Quant Tech Stack. In the following, I will discuss my approach to building up aÂ Securities Master Database (SMD) for storing corporate information and historical price data for a universe of financial instruments &#8230;<p class="read-more"> <a class="" href="https://niklasbaier.github.io/me/building-up-a-securities-master-database/"> <span class="screen-reader-text">Building up a Securities Master Database</span> Read More &#187;</a></p>]]></description>
										<content:encoded><![CDATA[		<div data-elementor-type="wp-post" data-elementor-id="49" class="elementor elementor-49" data-elementor-settings="[]">
							<div class="elementor-section-wrap">
							<section class="elementor-section elementor-top-section elementor-element elementor-element-e9db8df elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="e9db8df" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-ca661e9" data-id="ca661e9" data-element_type="column">
			<div class="elementor-widget-wrap elementor-element-populated">
								<div class="elementor-element elementor-element-5c3aca6 elementor-widget elementor-widget-heading" data-id="5c3aca6" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h1 class="elementor-heading-title elementor-size-xl">Building up a Securities Master Database</h1>		</div>
				</div>
				<div class="elementor-element elementor-element-8f6b86a elementor-widget elementor-widget-image" data-id="8f6b86a" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
															<img src="https://niklasbaier.github.io/me/wp-content/uploads/elementor/thumbs/data-centre-ph4o7hr8vi5wogq6w1ep2vsfaoy2w7tpo03rmmwlow.jpeg" title="data centre" alt="data centre" />															</div>
				</div>
				<div class="elementor-element elementor-element-40ca2cc elementor-widget elementor-widget-text-editor" data-id="40ca2cc" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>This is the first big post in a series of detailed articles about building up a <a href="https://niklasbaier.github.io/me/roadmap-to-a-full-quant-tech-stack/">Full Quant Tech Stack</a>. In the following, I will discuss my approach to building up aÂ <i>Securities Master Database</i> (SMD) for storing corporate information and historical price data for a universe of financial instruments (mostly equities, but also ETFs, and maybe even derivates later on). I will go into detail about design choices in the database scheme, as well as different data vendors and their (dis-)advantages. I will also provide my code for me to retrace my steps in the future, as well as for the curious reader who may also want to build up their very own SMD.</p><p>I am by no means an expert on neither database design, nor coding in general, but I tried to keep everything as efficient as possible. If you find any mistakes in my logic or inefficiencies in my code, feel free to leave me a comment with constructive criticism <img src="https://s.w.org/images/core/emoji/13.1.0/72x72/1f642.png" alt="ðŸ™‚" class="wp-smiley" style="height: 1em; max-height: 1em;" /></p><p>Finally, I didn&#8217;t natively come up with this approach to an SMD all by myself, butÂ <span style="font-style: inherit; font-weight: inherit; color: var(--darkreader-text--e-global-color-text); font-family: var( --e-global-typography-text-font-family ), Sans-serif; background-color: var(--darkreader-bg--ast-global-color-5); --darkreader-inline-color: var(--darkreader-text--darkreader-text--e-global-color-text); --darkreader-inline-bgcolor: var(--darkreader-bg--darkreader-bg--ast-global-color-5);" data-darkreader-inline-color="" data-darkreader-inline-bgcolor="">I am rather standing on the shoulders of giants, most notably </span><a style="font-style: inherit; font-weight: inherit; font-family: var( --e-global-typography-text-font-family ), Sans-serif;" href="https://www.quantstart.com/articles/Securities-Master-Database-with-MySQL-and-Python/">this QuantStart article</a><span style="font-style: inherit; font-weight: inherit; color: var(--darkreader-text--e-global-color-text); font-family: var( --e-global-typography-text-font-family ), Sans-serif; background-color: var(--darkreader-bg--ast-global-color-5); --darkreader-inline-color: var(--darkreader-text--darkreader-text--e-global-color-text); --darkreader-inline-bgcolor: var(--darkreader-bg--darkreader-bg--ast-global-color-5);" data-darkreader-inline-color="" data-darkreader-inline-bgcolor="">, </span><a style="font-style: inherit; font-weight: inherit; font-family: var( --e-global-typography-text-font-family ), Sans-serif;" href="https://reasonabledeviations.com/about/">Robert Andrew Martin</a><span style="font-style: inherit; font-weight: inherit; color: var(--darkreader-text--e-global-color-text); font-family: var( --e-global-typography-text-font-family ), Sans-serif; background-color: var(--darkreader-bg--ast-global-color-5); --darkreader-inline-color: var(--darkreader-text--darkreader-text--e-global-color-text); --darkreader-inline-bgcolor: var(--darkreader-bg--darkreader-bg--ast-global-color-5);" data-darkreader-inline-color="" data-darkreader-inline-bgcolor="">Â from </span><a style="font-style: inherit; font-weight: inherit; font-family: var( --e-global-typography-text-font-family ), Sans-serif;" href="https://reasonabledeviations.com/">Reasonable Deviations</a><span style="font-style: inherit; font-weight: inherit; color: var(--darkreader-text--e-global-color-text); font-family: var( --e-global-typography-text-font-family ), Sans-serif; background-color: var(--darkreader-bg--ast-global-color-5); --darkreader-inline-color: var(--darkreader-text--darkreader-text--e-global-color-text); --darkreader-inline-bgcolor: var(--darkreader-bg--darkreader-bg--ast-global-color-5);" data-darkreader-inline-color="" data-darkreader-inline-bgcolor="">, and </span><span style="font-family: var( --e-global-typography-text-font-family ), Sans-serif;"><span style="font-style: inherit; font-weight: inherit;"><a href="https://www.youtube.com/c/parttimelarry">Part Time Larry</a></span></span><span style="font-style: inherit; font-weight: inherit; color: var(--darkreader-text--e-global-color-text); font-family: var( --e-global-typography-text-font-family ), Sans-serif; background-color: var(--darkreader-bg--ast-global-color-5); --darkreader-inline-color: var(--darkreader-text--darkreader-text--e-global-color-text); --darkreader-inline-bgcolor: var(--darkreader-bg--darkreader-bg--ast-global-color-5);" data-darkreader-inline-color="" data-darkreader-inline-bgcolor=""> from </span><a style="font-style: inherit; font-weight: inherit; font-family: var( --e-global-typography-text-font-family ), Sans-serif;" href="https://hackingthemarkets.com/author/parttimelarry/">Hacking the Markets</a><span style="font-style: inherit; font-weight: inherit; color: var(--darkreader-text--e-global-color-text); font-family: var( --e-global-typography-text-font-family ), Sans-serif; background-color: var(--darkreader-bg--ast-global-color-5); --darkreader-inline-color: var(--darkreader-text--darkreader-text--e-global-color-text); --darkreader-inline-bgcolor: var(--darkreader-bg--darkreader-bg--ast-global-color-5);" data-darkreader-inline-color="" data-darkreader-inline-bgcolor="">. Their articles / videos were such a great and beginner-friendly guide to this endeavour and helped me a lot in understanding below concepts. Their ideas and code snippets served me well as a starting point for the first versions of my SMD. To make it my very own, I altered some passages here and there and expanded the scope in size and functionality.</span></p><p><span style="font-style: inherit; font-weight: inherit; color: var(--darkreader-text--e-global-color-text); font-family: var( --e-global-typography-text-font-family ), Sans-serif; background-color: var(--darkreader-bg--ast-global-color-5); --darkreader-inline-color: var(--darkreader-text--darkreader-text--e-global-color-text); --darkreader-inline-bgcolor: var(--darkreader-bg--darkreader-bg--ast-global-color-5);" data-darkreader-inline-color="" data-darkreader-inline-bgcolor="">With this post, I feel like it is time to give back to the community, so feel free to take my version of an SMD as your starting point.Â </span><span style="color: var(--darkreader-text--e-global-color-text); font-family: var( --e-global-typography-text-font-family ), Sans-serif; font-weight: var( --e-global-typography-text-font-weight ); background-color: var(--darkreader-bg--ast-global-color-5); font-size: 1rem; --darkreader-inline-color: var(--darkreader-text--darkreader-text--e-global-color-text); --darkreader-inline-bgcolor: var(--darkreader-bg--darkreader-bg--ast-global-color-5);" data-darkreader-inline-color="" data-darkreader-inline-bgcolor="">Without further ado, let&#8217;s get going!</span></p>						</div>
				</div>
					</div>
		</div>
							</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-045f5f6 elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="045f5f6" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-1e96b73" data-id="1e96b73" data-element_type="column">
			<div class="elementor-widget-wrap elementor-element-populated">
								<div class="elementor-element elementor-element-aa9aa56 elementor-widget elementor-widget-heading" data-id="aa9aa56" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-default">1. What is a Securities Master Database?</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-62b99cb elementor-widget elementor-widget-text-editor" data-id="62b99cb" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>An SMD is an organization-wide database that stores fundamental, pricing and transactional data for a variety of financial instruments such as equities, options, indices, forex, interest rates, futures, commodities, bonds and other derivatives across asset classes.</p><p>Datasets comprise end-of-day and / or intraday historical pricing for above-mentioned financial instruments, acquired via web-available APIs such as <a href="https://finance.yahoo.com/">Yahoo Finance</a>, <a href="https://data.nasdaq.com/">Quandl</a>, <a href="https://alpaca.markets/">Alpaca</a>, etc.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-6a62733 elementor-widget elementor-widget-heading" data-id="6a62733" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-medium">1.1. How is the data stored?</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-2a20aa4 elementor-widget elementor-widget-text-editor" data-id="2a20aa4" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>For financial data, <i>Relational Database Management Systems</i> (RDBMS) such as <i>MySQL</i> are particularly-well suited since they enable different <i>objects</i> such as <b>exchanges</b>, <b>data vendors</b>, <b>instruments</b> and <b>prices</b> to be separated into tables with relationships between them. Though I tried to design the database scheme in a future-proof way, there might be a time when I will have to update it nonetheless, e.g. when introducing a new table for <b>fundamental data</b>. Luckily, RDBMS can easily be modified to reflect such changes and new relationships between tables are quickly created<span style="font-style: inherit; font-weight: inherit; color: var(--darkreader-text--e-global-color-text); font-family: var( --e-global-typography-text-font-family ), Sans-serif; background-color: var(--darkreader-bg--ast-global-color-5); --darkreader-inline-color: var(--darkreader-text--darkreader-text--e-global-color-text); --darkreader-inline-bgcolor: var(--darkreader-bg--darkreader-bg--ast-global-color-5);" data-darkreader-inline-color="" data-darkreader-inline-bgcolor="">. Similarly, a MySQL database allows for cascading deletion of data, i.e. not only the data but also its dependencies / relationships to other table entries will be deleted. Furthermore, RDBMS are relatively straight-forward to install, platform-independent, easy to query via SQL, easy to integrate with backtesting systems (such as </span><a style="font-style: inherit; font-weight: inherit; font-family: var( --e-global-typography-text-font-family ), Sans-serif;" href="https://www.backtrader.com/">Backtrader</a><span style="font-style: inherit; font-weight: inherit; color: var(--darkreader-text--e-global-color-text); font-family: var( --e-global-typography-text-font-family ), Sans-serif; background-color: var(--darkreader-bg--ast-global-color-5); --darkreader-inline-color: var(--darkreader-text--darkreader-text--e-global-color-text); --darkreader-inline-bgcolor: var(--darkreader-bg--darkreader-bg--ast-global-color-5);" data-darkreader-inline-color="" data-darkreader-inline-bgcolor="">), as well as high performing at large scales.</span></p>						</div>
				</div>
				<div class="elementor-element elementor-element-220d6ec elementor-widget elementor-widget-heading" data-id="220d6ec" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-medium">1.2. How is the data structured?</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-59b0dca elementor-widget elementor-widget-text-editor" data-id="59b0dca" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>A common pattern for the construction of an SMD consists of the following entities (= tables in the database):</p><ul><li><b>Exchange</b> (original listing of the instrument)</li><li><b>Vendor</b> (actual data source for a particular data point)</li><li><b>Instrument</b> (ticker / symbol for the financial instrument, alongside some key corporate information)</li><li><b>Price</b> (actual price in OHLCV format for a particular instrument on a particular day)</li></ul>						</div>
				</div>
				<div class="elementor-element elementor-element-8b60ac9 elementor-widget elementor-widget-image" data-id="8b60ac9" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
												<figure class="wp-caption">
										<img width="340" height="465" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/ERD.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/ERD.png 340w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/ERD-219x300.png 219w" sizes="(max-width: 340px) 100vw, 340px" />											<figcaption class="widget-image-caption wp-caption-text">Entity Relationship Diagram for the four data tables.</figcaption>
										</figure>
									</div>
				</div>
					</div>
		</div>
							</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-537c345 elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="537c345" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-6c926cc" data-id="6c926cc" data-element_type="column">
			<div class="elementor-widget-wrap elementor-element-populated">
								<div class="elementor-element elementor-element-3583ec1 elementor-widget elementor-widget-heading" data-id="3583ec1" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-default">2. Prerequisites</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-0a519c4 elementor-widget elementor-widget-text-editor" data-id="0a519c4" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Now that we know what an SMD is, let&#8217;s get into the details on how to actually create one. But first, there are some prerequisites.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-140a370 elementor-widget elementor-widget-heading" data-id="140a370" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-medium">2.1. MySQL Database Setup on Mac</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-946f61a elementor-widget elementor-widget-text-editor" data-id="946f61a" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>I have already written a brief overview on how to setup a MySQL server locally in <a href="https://niklasbaier.github.io/me/setting-up-a-mac-for-development/">this post</a>, so please refer to it for the initializing steps.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-18d0293 elementor-widget elementor-widget-heading" data-id="18d0293" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-medium">2.2. MySQL Database Setup on Raspberry Pi</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-1b6b992 elementor-widget elementor-widget-text-editor" data-id="1b6b992" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>For the time being, I will keep my SMD running locally on my Mac, but I definitely have plans on hosting it on an always-on Raspberry Pi server. Doing so will enable me (and others) to connect to a remotely hosted, shared database instead of only a local instance. See also the open issues section at the end.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-fd0fdbf elementor-widget elementor-widget-heading" data-id="fd0fdbf" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-medium">2.3. Setting up Users</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-aafc809 elementor-widget elementor-widget-text-editor" data-id="aafc809" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>This step is not as important right now, but as soon as the database is accessed by people other than me, I will have to set up according user profiles. For now, I will access the local SMD as <i>root</i>.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-474304d elementor-widget elementor-widget-heading" data-id="474304d" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-medium">2.4. Optional: MySQL Workbech as GUI</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-869cc97 elementor-widget elementor-widget-text-editor" data-id="869cc97" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Since storing historical price data for a universe of financial instruments well into the ten-thousands will result in millions of row entries, it might be beneficial to set up a GUI client for manually looking up data from the database, e.g. when testing whether certain inserts have been successful. <a href="https://www.mysql.com/products/workbench/">MySQL Workbench</a> is an easy to use candidate for that.</p><p>To connect the client to your <i>local</i> MySQL server, just click on the + icon next to <i>MySQL Connections</i> &gt; Setup New Connection.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-7ca43d9 eael-table-align-center eael-dt-th-align-left eael-dt-td-align-left elementor-widget elementor-widget-eael-data-table" data-id="7ca43d9" data-element_type="widget" data-widget_type="eael-data-table.default">
				<div class="elementor-widget-container">
					<div class="eael-data-table-wrap" data-table_id="7ca43d9" data-custom_responsive="false">
			<table class="tablesorter eael-data-table center" id="eael-data-table-7ca43d9">
			    <thead>
			        <tr class="table-header">
									            <th class="" id="" colspan="">
														<span class="data-table-header-text"></span></th>
			        				            <th class="" id="" colspan="">
														<span class="data-table-header-text"></span></th>
			        				        </tr>
			    </thead>
			  	<tbody>
											<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Connection Name</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Securities Master Database</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Hostname</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">127.0.0.1 (stands for localhost)</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Port</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">3306</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Username</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">root</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Password</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Store in Keychain ... (type in root password of your local MySQL server)</div></div>
											</td>
																										</tr>
			        			    </tbody>
			</table>
		</div>
	  			</div>
				</div>
				<div class="elementor-element elementor-element-3cbf541 elementor-widget elementor-widget-text-editor" data-id="3cbf541" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Now, click on <i>Test connection</i>. If this window pops up, you&#8217;re good to go and can click <i>OK</i>.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-d8380f4 elementor-widget elementor-widget-image" data-id="d8380f4" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
															<img width="223" height="300" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-22-at-11.37.51-223x300.png" class="attachment-medium size-medium" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-22-at-11.37.51-223x300.png 223w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-22-at-11.37.51.png 328w" sizes="(max-width: 223px) 100vw, 223px" />															</div>
				</div>
				<div class="elementor-element elementor-element-f71ca3c elementor-widget elementor-widget-text-editor" data-id="f71ca3c" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>You can now access your database via the GUI client (as long as the server is running), e.g. to test out some SQL statements.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-a21b404 elementor-widget elementor-widget-image" data-id="a21b404" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
												<figure class="wp-caption">
										<img width="266" height="161" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-22-at-11.38.32.png" class="attachment-medium size-medium" alt="" loading="lazy" />											<figcaption class="widget-image-caption wp-caption-text">Just click on the connection to start the MySQL Workbench editor.</figcaption>
										</figure>
									</div>
				</div>
				<div class="elementor-element elementor-element-e9742e2 elementor-widget elementor-widget-alert" data-id="e9742e2" data-element_type="widget" data-widget_type="alert.default">
				<div class="elementor-widget-container">
					<div class="elementor-alert elementor-alert-warning" role="alert">
			<span class="elementor-alert-title">Caution</span>
							<span class="elementor-alert-description">In order to connect MySQL Workbench to your SMD, you will have to actually create the database first. Thus, best skip this step for now and come back later after 3.2. Database &amp; Table Creation.</span>
										<button type="button" class="elementor-alert-dismiss">
					<span aria-hidden="true">&times;</span>
					<span class="elementor-screen-only">Dismiss alert</span>
				</button>
					</div>
				</div>
				</div>
				<div class="elementor-element elementor-element-e1f4784 elementor-widget elementor-widget-heading" data-id="e1f4784" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-medium">2.5. Requirements.txt</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-5ad8367 elementor-widget elementor-widget-text-editor" data-id="5ad8367" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>The following packages need to be installed (<i>pip install -r requirements.txt</i>) into your dedicated Python environment (for a primer on conda environments, click <a href="https://niklasbaier.github.io/me/setting-up-a-mac-for-development/">here</a>):</p>						</div>
				</div>
				<div class="elementor-element elementor-element-af1d2e7 elementor-widget elementor-widget-text-editor" data-id="af1d2e7" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="text" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">alpaca_trade_api==1.4.1<br />cufflinks==0.17.3
lxml==4.6.3
matplotlib==3.4.3
numpy==1.21.3
pandas==1.3.3
pandas_datareader==0.10.0<br />plotly==5.3.1
PyMySQL==1.0.2
requests==2.26.0<br />seaborn==0.11.2
tqdm==4.62.0
yfinance==0.1.64</pre>						</div>
				</div>
				<div class="elementor-element elementor-element-19b5a35 elementor-widget elementor-widget-alert" data-id="19b5a35" data-element_type="widget" data-widget_type="alert.default">
				<div class="elementor-widget-container">
					<div class="elementor-alert elementor-alert-info" role="alert">
			<span class="elementor-alert-title">Hint</span>
							<span class="elementor-alert-description">Generating a requirements.txt file is very easy with the <i>pipreqs</i> package!</span>
										<button type="button" class="elementor-alert-dismiss">
					<span aria-hidden="true">&times;</span>
					<span class="elementor-screen-only">Dismiss alert</span>
				</button>
					</div>
				</div>
				</div>
					</div>
		</div>
							</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-840dda7 elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="840dda7" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-8448d6b" data-id="8448d6b" data-element_type="column">
			<div class="elementor-widget-wrap elementor-element-populated">
								<div class="elementor-element elementor-element-0dc5381 elementor-widget elementor-widget-heading" data-id="0dc5381" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-default">3. Generating the SMD</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-62ebe9f elementor-widget elementor-widget-heading" data-id="62ebe9f" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-medium">3.1. Database Schema</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-da3e36a elementor-widget elementor-widget-text-editor" data-id="da3e36a" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>A database schema sets out how all of the information is going to be organized in the database. The following suggested schema does not make any assumptions about which financial instruments you are interested in and gives you the flexibility of adding any type of security as long as it can be represented as a time series of prices.</p><p>Referring back to section <i>1.2. How is the data structured?</i>, the proposed scheme consists of four tables: <b>exchange</b>, <b>vendor</b>, <b>instrument</b>, and <b>price</b>.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-c2dfe72 eael-table-align-center eael-dt-th-align-left eael-dt-td-align-left elementor-widget elementor-widget-eael-data-table" data-id="c2dfe72" data-element_type="widget" data-widget_type="eael-data-table.default">
				<div class="elementor-widget-container">
					<div class="eael-data-table-wrap" data-table_id="c2dfe72" data-custom_responsive="false">
			<table class="tablesorter eael-data-table center" id="eael-data-table-c2dfe72">
			    <thead>
			        <tr class="table-header">
									            <th class="" id="" colspan="">
														<span class="data-table-header-text"></span></th>
			        				            <th class="" id="" colspan="">
														<span class="data-table-header-text"></span></th>
			        				        </tr>
			    </thead>
			  	<tbody>
											<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">exchange</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">contains information of the exchange and is a parent table for instrument</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">vendor</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">contains information about the actual data source</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">instrument</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">holds all of the relevant (corporate) information about the actual companies / underlying for which data will be collected</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">price</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">holds OHLC, Adj. Close and Volume data for every ticker that is part of the instrument table</div></div>
											</td>
																										</tr>
			        			    </tbody>
			</table>
		</div>
	  			</div>
				</div>
				<div class="elementor-element elementor-element-336d76e elementor-widget elementor-widget-text-editor" data-id="336d76e" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>For each table, the <a href="https://en.wikipedia.org/wiki/Primary_key">primary key</a> is a distinct ID which assigns an unambiguous integer value to every tuple. This allows us to uniquely identify a specific entry in the table. For linking the four tables together, we will use&nbsp;<a href="https://en.wikipedia.org/wiki/Foreign_key">foreign keys</a>&nbsp;to refer to these uniquely identifying IDs.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-4c7bcf0 elementor-widget elementor-widget-image" data-id="4c7bcf0" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
												<figure class="wp-caption">
										<img width="517" height="630" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/schema.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/schema.png 517w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/schema-246x300.png 246w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/schema-500x609.png 500w" sizes="(max-width: 517px) 100vw, 517px" />											<figcaption class="widget-image-caption wp-caption-text">Schema for the SMD.</figcaption>
										</figure>
									</div>
				</div>
				<div class="elementor-element elementor-element-3fc6ae5 elementor-widget elementor-widget-heading" data-id="3fc6ae5" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-medium">3.2. Database &amp; Table Creation</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-114c689 elementor-widget elementor-widget-text-editor" data-id="114c689" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Now that the schema for the SMD has been conceptualized, you can setup the database and its tables on your MySQL server.</p><p>If not done already, start the server and log in (as <i>root</i>) via:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-5d7bd57 elementor-widget elementor-widget-text-editor" data-id="5d7bd57" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="mysql" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">mysql.server <span style="color: #990099; font-weight: bold;">start</span>
mysql <span style="color: #cc0099;">-</span>u root <span style="color: #cc0099;">-</span>p</pre>						</div>
				</div>
				<div class="elementor-element elementor-element-161bbdb elementor-widget elementor-widget-heading" data-id="161bbdb" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h6 class="elementor-heading-title elementor-size-small">Database</h6>		</div>
				</div>
				<div class="elementor-element elementor-element-e62b045 elementor-widget elementor-widget-text-editor" data-id="e62b045" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="sql" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">CREATE</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">DATABASE</span> securities_master;
<span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">USE</span> securities_master;</pre>						</div>
				</div>
				<div class="elementor-element elementor-element-8809e4d elementor-widget elementor-widget-heading" data-id="8809e4d" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h6 class="elementor-heading-title elementor-size-small">Table: exchange</h6>		</div>
				</div>
				<div class="elementor-element elementor-element-6398e4d elementor-widget elementor-widget-text-editor" data-id="6398e4d" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="sql" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">CREATE</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">TABLE</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">IF</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">NOT</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">EXISTS</span> <span style="color: #ff0000; --darkreader-inline-color: #ff1a1a;" data-darkreader-inline-color="">`exchange`</span> <span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">(</span>
  <span style="color: #ff0000; --darkreader-inline-color: #ff1a1a;" data-darkreader-inline-color="">`id`</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">INT</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">(</span><span style="color: #cc66cc; --darkreader-inline-color: #cf6ecf;" data-darkreader-inline-color="">11</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">)</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">NOT</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">NULL</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">AUTO_INCREMENT</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">,</span>
  <span style="color: #ff0000; --darkreader-inline-color: #ff1a1a;" data-darkreader-inline-color="">`mic_code`</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">CHAR</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">(</span><span style="color: #cc66cc; --darkreader-inline-color: #cf6ecf;" data-darkreader-inline-color="">4</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">)</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">NOT</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">NULL</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">,</span>
  <span style="color: #ff0000; --darkreader-inline-color: #ff1a1a;" data-darkreader-inline-color="">`acronym`</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">VARCHAR</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">(</span><span style="color: #cc66cc; --darkreader-inline-color: #cf6ecf;" data-darkreader-inline-color="">50</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">)</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">NOT</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">NULL</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">,</span>
  <span style="color: #ff0000; --darkreader-inline-color: #ff1a1a;" data-darkreader-inline-color="">`name`</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">VARCHAR</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">(</span><span style="color: #cc66cc; --darkreader-inline-color: #cf6ecf;" data-darkreader-inline-color="">50</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">)</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">NOT</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">NULL</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">,</span>
  <span style="color: #ff0000; --darkreader-inline-color: #ff1a1a;" data-darkreader-inline-color="">`region`</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">VARCHAR</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">(</span><span style="color: #cc66cc; --darkreader-inline-color: #cf6ecf;" data-darkreader-inline-color="">50</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">)</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">NULL</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">DEFAULT</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">NULL</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">,</span>
  <span style="color: #ff0000; --darkreader-inline-color: #ff1a1a;" data-darkreader-inline-color="">`country`</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">VARCHAR</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">(</span><span style="color: #cc66cc; --darkreader-inline-color: #cf6ecf;" data-darkreader-inline-color="">50</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">)</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">NULL</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">DEFAULT</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">NULL</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">,</span>
  <span style="color: #ff0000; --darkreader-inline-color: #ff1a1a;" data-darkreader-inline-color="">`city`</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">VARCHAR</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">(</span><span style="color: #cc66cc; --darkreader-inline-color: #cf6ecf;" data-darkreader-inline-color="">50</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">)</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">NULL</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">DEFAULT</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">NULL</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">,</span>
  <span style="color: #ff0000; --darkreader-inline-color: #ff1a1a;" data-darkreader-inline-color="">`currency`</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">CHAR</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">(</span><span style="color: #cc66cc; --darkreader-inline-color: #cf6ecf;" data-darkreader-inline-color="">3</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">)</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">NULL</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">DEFAULT</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">NULL</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">,</span>
  <span style="color: #ff0000; --darkreader-inline-color: #ff1a1a;" data-darkreader-inline-color="">`created_date`</span> DATETIME <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">NULL</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">DEFAULT</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">CURRENT_TIMESTAMP</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">(</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">)</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">,</span>
  <span style="color: #ff0000; --darkreader-inline-color: #ff1a1a;" data-darkreader-inline-color="">`last_updated`</span> DATETIME <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">NULL</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">DEFAULT</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">CURRENT_TIMESTAMP</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">(</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">)</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">ON</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">UPDATE</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">CURRENT_TIMESTAMP</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">(</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">)</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">,</span>
  <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">PRIMARY</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">KEY</span> <span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">(</span><span style="color: #ff0000; --darkreader-inline-color: #ff1a1a;" data-darkreader-inline-color="">`id`</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">)</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">)</span>
  ENGINE <span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">=</span> InnoDB
  <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">DEFAULT</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">CHARACTER</span> <span style="color: #993333; font-weight: bold; --darkreader-inline-color: #cf6e6e;" data-darkreader-inline-color="">SET</span> <span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">=</span> utf8;</pre>						</div>
				</div>
				<div class="elementor-element elementor-element-7689501 elementor-widget elementor-widget-text-editor" data-id="7689501" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>For every entry in our <b>exchange</b> table, we want to store an auto-incrementing <u><i>id</i></u> as <i>primary key</i> (referenced by the <i>foreign key</i> of the <b>instrument</b> table), the unique four-character <a href="https://en.wikipedia.org/wiki/Market_Identifier_Code">Market Identifier Code (MIC)</a>Â <i>mic_code</i>, as well as the <i>acronym</i>,Â <i>name</i>, <i>region</i>, <i>country, city</i> and <i>currency</i> of the exchange. Furthermore we will keep track of when an exchange has been added to the table (<i>created_date</i>) and when it has been updated (<i>last_updated</i>).</p>						</div>
				</div>
				<div class="elementor-element elementor-element-0238969 elementor-widget elementor-widget-heading" data-id="0238969" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h6 class="elementor-heading-title elementor-size-small">Table: vendor</h6>		</div>
				</div>
				<div class="elementor-element elementor-element-440fb2f elementor-widget elementor-widget-text-editor" data-id="440fb2f" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;" data-darkreader-inline-color="" data-darkreader-inline-bgcolor=""><span style="color: #993333; font-weight: bold;" data-darkreader-inline-color="">CREATE</span> <span style="color: #993333; font-weight: bold;" data-darkreader-inline-color="">TABLE</span> <span style="color: #993333; font-weight: bold;" data-darkreader-inline-color="">IF</span> <span style="color: #993333; font-weight: bold;" data-darkreader-inline-color="">NOT</span> <span style="color: #993333; font-weight: bold;" data-darkreader-inline-color="">EXISTS</span> <span style="color: #ff0000;" data-darkreader-inline-color="">`vendor`</span> <span style="color: #66cc66;" data-darkreader-inline-color="">(</span>
  <span style="color: #ff0000;" data-darkreader-inline-color="">`id`</span> <span style="color: #993333; font-weight: bold;" data-darkreader-inline-color="">INT</span><span style="color: #66cc66;" data-darkreader-inline-color="">(</span><span style="color: #cc66cc;" data-darkreader-inline-color="">11</span><span style="color: #66cc66;" data-darkreader-inline-color="">)</span> <span style="color: #993333; font-weight: bold;" data-darkreader-inline-color="">NOT</span> <span style="color: #993333; font-weight: bold;" data-darkreader-inline-color="">NULL</span> <span style="color: #993333; font-weight: bold;" data-darkreader-inline-color="">AUTO_INCREMENT</span><span style="color: #66cc66;" data-darkreader-inline-color="">,</span>
  <span style="color: #ff0000;" data-darkreader-inline-color="">`name`</span> <span style="color: #993333; font-weight: bold;" data-darkreader-inline-color="">VARCHAR</span><span style="color: #66cc66;" data-darkreader-inline-color="">(</span><span style="color: #cc66cc;" data-darkreader-inline-color="">32</span><span style="color: #66cc66;" data-darkreader-inline-color="">)</span> <span style="color: #993333; font-weight: bold;" data-darkreader-inline-color="">NOT</span> <span style="color: #993333; font-weight: bold;" data-darkreader-inline-color="">NULL</span><span style="color: #66cc66;" data-darkreader-inline-color="">,</span>
  <span style="color: #ff0000;" data-darkreader-inline-color="">`website`</span> <span style="color: #993333; font-weight: bold;" data-darkreader-inline-color="">VARCHAR</span><span style="color: #66cc66;" data-darkreader-inline-color="">(</span><span style="color: #cc66cc;" data-darkreader-inline-color="">255</span><span style="color: #66cc66;" data-darkreader-inline-color="">)</span> <span style="color: #993333; font-weight: bold;" data-darkreader-inline-color="">NULL</span> <span style="color: #993333; font-weight: bold;" data-darkreader-inline-color="">DEFAULT</span> <span style="color: #993333; font-weight: bold;" data-darkreader-inline-color="">NULL</span><span style="color: #66cc66;" data-darkreader-inline-color="">,</span>
  <span style="color: #ff0000;" data-darkreader-inline-color="">`created_date`</span> DATETIME <span style="color: #993333; font-weight: bold;" data-darkreader-inline-color="">NULL</span> <span style="color: #993333; font-weight: bold;" data-darkreader-inline-color="">DEFAULT</span> <span style="color: #993333; font-weight: bold;" data-darkreader-inline-color="">CURRENT_TIMESTAMP</span><span style="color: #66cc66;" data-darkreader-inline-color="">(</span><span style="color: #66cc66;" data-darkreader-inline-color="">)</span><span style="color: #66cc66;" data-darkreader-inline-color="">,</span>
  <span style="color: #ff0000;" data-darkreader-inline-color="">`last_updated`</span> DATETIME <span style="color: #993333; font-weight: bold;" data-darkreader-inline-color="">NULL</span> <span style="color: #993333; font-weight: bold;" data-darkreader-inline-color="">DEFAULT</span> <span style="color: #993333; font-weight: bold;" data-darkreader-inline-color="">CURRENT_TIMESTAMP</span><span style="color: #66cc66;" data-darkreader-inline-color="">(</span><span style="color: #66cc66;" data-darkreader-inline-color="">)</span> <span style="color: #993333; font-weight: bold;" data-darkreader-inline-color="">ON</span> <span style="color: #993333; font-weight: bold;" data-darkreader-inline-color="">UPDATE</span> <span style="color: #993333; font-weight: bold;" data-darkreader-inline-color="">CURRENT_TIMESTAMP</span><span style="color: #66cc66;" data-darkreader-inline-color="">(</span><span style="color: #66cc66;" data-darkreader-inline-color="">)</span><span style="color: #66cc66;" data-darkreader-inline-color="">,</span>
  <span style="color: #993333; font-weight: bold;" data-darkreader-inline-color="">PRIMARY</span> <span style="color: #993333; font-weight: bold;" data-darkreader-inline-color="">KEY</span> <span style="color: #66cc66;" data-darkreader-inline-color="">(</span><span style="color: #ff0000;" data-darkreader-inline-color="">`id`</span><span style="color: #66cc66;" data-darkreader-inline-color="">)</span><span style="color: #66cc66;" data-darkreader-inline-color="">)</span>
  ENGINE <span style="color: #66cc66;" data-darkreader-inline-color="">=</span> InnoDB
  <span style="color: #993333; font-weight: bold;" data-darkreader-inline-color="">DEFAULT</span> <span style="color: #993333; font-weight: bold;" data-darkreader-inline-color="">CHARACTER</span> <span style="color: #993333; font-weight: bold;" data-darkreader-inline-color="">SET</span> <span style="color: #66cc66;" data-darkreader-inline-color="">=</span> utf8;</pre>						</div>
				</div>
				<div class="elementor-element elementor-element-a447320 elementor-widget elementor-widget-text-editor" data-id="a447320" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Similarly to above, for every data vendor in the <b>vendor</b> table, we keep its <i><u>id</u></i> as <i>primary key</i> (to be referenced by the <i>foreign key</i> of the <b>price</b> table). Additionally, we store the vendor&#8217;s <i>name</i> and <i>website</i>, as well as their date of creation and update.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-99fc027 elementor-widget elementor-widget-heading" data-id="99fc027" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h6 class="elementor-heading-title elementor-size-small">Table: instrument</h6>		</div>
				</div>
				<div class="elementor-element elementor-element-4fb08a3 elementor-widget elementor-widget-text-editor" data-id="4fb08a3" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="sql" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #993333; font-weight: bold;">CREATE</span> <span style="color: #993333; font-weight: bold;">TABLE</span> <span style="color: #993333; font-weight: bold;">IF</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">EXISTS</span> <span style="color: #ff0000;">`instrument`</span> <span style="color: #66cc66;">(</span>
  <span style="color: #ff0000;">`id`</span> <span style="color: #993333; font-weight: bold;">INT</span><span style="color: #66cc66;">(</span><span style="color: #cc66cc;">11</span><span style="color: #66cc66;">)</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span> <span style="color: #993333; font-weight: bold;">AUTO_INCREMENT</span><span style="color: #66cc66;">,</span>
  <span style="color: #ff0000;">`exchange_id`</span> <span style="color: #993333; font-weight: bold;">INT</span><span style="color: #66cc66;">(</span><span style="color: #cc66cc;">11</span><span style="color: #66cc66;">)</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
  <span style="color: #ff0000;">`ticker`</span> <span style="color: #993333; font-weight: bold;">VARCHAR</span><span style="color: #66cc66;">(</span><span style="color: #cc66cc;">10</span><span style="color: #66cc66;">)</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
  <span style="color: #ff0000;">`name`</span> <span style="color: #993333; font-weight: bold;">VARCHAR</span><span style="color: #66cc66;">(</span><span style="color: #cc66cc;">255</span><span style="color: #66cc66;">)</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
  <span style="color: #ff0000;">`sector`</span> <span style="color: #993333; font-weight: bold;">VARCHAR</span><span style="color: #66cc66;">(</span><span style="color: #cc66cc;">100</span><span style="color: #66cc66;">)</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
  <span style="color: #ff0000;">`industry`</span> <span style="color: #993333; font-weight: bold;">VARCHAR</span><span style="color: #66cc66;">(</span><span style="color: #cc66cc;">100</span><span style="color: #66cc66;">)</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
  <span style="color: #ff0000;">`country`</span> <span style="color: #993333; font-weight: bold;">VARCHAR</span><span style="color: #66cc66;">(</span><span style="color: #cc66cc;">100</span><span style="color: #66cc66;">)</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
  <span style="color: #ff0000;">`website`</span> <span style="color: #993333; font-weight: bold;">VARCHAR</span><span style="color: #66cc66;">(</span><span style="color: #cc66cc;">255</span><span style="color: #66cc66;">)</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
  <span style="color: #ff0000;">`created_date`</span><span style="color: #212529;"> DATETIME </span><span style="color: #993333; font-weight: bold;">NULL</span> <span style="color: #993333; font-weight: bold;">DEFAULT</span> <span style="color: #993333; font-weight: bold;">CURRENT_TIMESTAMP</span><span style="color: #66cc66;">(</span><span style="color: #66cc66;">)</span><span style="color: #66cc66;">,</span>
  <span style="color: #ff0000;">`last_updated`</span><span style="color: #212529;"> DATETIME </span><span style="color: #993333; font-weight: bold;">NULL</span> <span style="color: #993333; font-weight: bold;">DEFAULT</span> <span style="color: #993333; font-weight: bold;">CURRENT_TIMESTAMP</span><span style="color: #66cc66;">(</span><span style="color: #66cc66;">)</span> <span style="color: #993333; font-weight: bold;">ON</span> <span style="color: #993333; font-weight: bold;">UPDATE</span> <span style="color: #993333; font-weight: bold;">CURRENT_TIMESTAMP</span><span style="color: #66cc66;">(</span><span style="color: #66cc66;">)</span><span style="color: #66cc66;">,</span>
  <span style="color: #993333; font-weight: bold;">PRIMARY</span> <span style="color: #993333; font-weight: bold;">KEY</span> <span style="color: #66cc66;">(</span><span style="color: #ff0000;">`id`</span><span style="color: #66cc66;">)</span><span style="color: #66cc66;">,</span>
  <span style="color: #993333; font-weight: bold;">INDEX</span> <span style="color: #ff0000;">`exchange_id`</span> <span style="color: #66cc66;">(</span><span style="color: #ff0000;">`exchange_id`</span> <span style="color: #993333; font-weight: bold;">ASC</span><span style="color: #66cc66;">)</span><span style="color: #66cc66;">,</span>
  <span style="color: #993333; font-weight: bold;">INDEX</span> <span style="color: #ff0000;">`ticker`</span> <span style="color: #66cc66;">(</span><span style="color: #ff0000;">`ticker`</span> <span style="color: #993333; font-weight: bold;">ASC</span><span style="color: #66cc66;">)</span><span style="color: #66cc66;">,</span>
  <span style="color: #993333; font-weight: bold;">CONSTRAINT</span> <span style="color: #ff0000;">`fk_exchange_id`</span>
    <span style="color: #993333; font-weight: bold;">FOREIGN</span> <span style="color: #993333; font-weight: bold;">KEY</span> <span style="color: #66cc66;">(</span><span style="color: #ff0000;">`exchange_id`</span><span style="color: #66cc66;">)</span>
    <span style="color: #993333; font-weight: bold;">REFERENCES</span> <span style="color: #ff0000;">`exchange`</span> <span style="color: #66cc66;">(</span><span style="color: #ff0000;">`id`</span><span style="color: #66cc66;">)</span>
    <span style="color: #993333; font-weight: bold;">ON</span> <span style="color: #993333; font-weight: bold;">DELETE</span><span style="color: #212529;"> NO ACTION
    </span><span style="color: #993333; font-weight: bold;">ON</span> <span style="color: #993333; font-weight: bold;">UPDATE</span><span style="color: #212529;"> NO ACTION</span><span style="color: #66cc66;">)</span><span style="color: #212529;">
  ENGINE </span><span style="color: #66cc66;">=</span><span style="color: #212529;"> InnoDB
  </span><span style="color: #993333; font-weight: bold;">DEFAULT</span> <span style="color: #993333; font-weight: bold;">CHARACTER</span> <span style="color: #993333; font-weight: bold;">SET</span> <span style="color: #66cc66;">=</span><span style="color: #212529;"> utf8;</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-d4d9237 elementor-widget elementor-widget-text-editor" data-id="d4d9237" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>For the financial <b>instrument</b> table, we keep track of two unique identifiers: the instrument&#8217;s own <i><u>id</u></i> (you guessed it, its <i>primary key</i> to be referenced by the <b>price</b> table&#8217;s <i>foreign key</i>) and the id of the exchange that lists this instrument (<i>foreign key</i>Â of <b>instrument</b> that references <b>exchange</b>&#8216;s <i>id</i> attribute). This allows us to uniquely identify a certain instrument listed on a certain exchange since it is not uncommon for securities to be listed on several exchanges.</p><p>For the actual information on the financial instrument / underlying, we store its <i>ticker</i>, <i>name</i>, <i>sector</i>, <i>industry</i>, <i>country</i> and <i>website</i>. Again, as before, we keep track on its <i>created_date</i> and its <i>last_updated</i> date.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-b5e261f elementor-widget elementor-widget-heading" data-id="b5e261f" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h6 class="elementor-heading-title elementor-size-small">Table: price</h6>		</div>
				</div>
				<div class="elementor-element elementor-element-13feb56 elementor-widget elementor-widget-text-editor" data-id="13feb56" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="sql" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #993333; font-weight: bold;">CREATE</span> <span style="color: #993333; font-weight: bold;">TABLE</span> <span style="color: #993333; font-weight: bold;">IF</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">EXISTS</span> <span style="color: #ff0000;">`price`</span> <span style="color: #66cc66;">(</span>
  <span style="color: #ff0000;">`id`</span> <span style="color: #993333; font-weight: bold;">INT</span><span style="color: #66cc66;">(</span><span style="color: #cc66cc;">11</span><span style="color: #66cc66;">)</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span> <span style="color: #993333; font-weight: bold;">AUTO_INCREMENT</span><span style="color: #66cc66;">,</span>
  <span style="color: #ff0000;">`vendor_id`</span> <span style="color: #993333; font-weight: bold;">INT</span><span style="color: #66cc66;">(</span><span style="color: #cc66cc;">11</span><span style="color: #66cc66;">)</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
  <span style="color: #ff0000;">`ticker_id`</span> <span style="color: #993333; font-weight: bold;">INT</span><span style="color: #66cc66;">(</span><span style="color: #cc66cc;">11</span><span style="color: #66cc66;">)</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
  <span style="color: #ff0000;">`price_date`</span> <span style="color: #993333; font-weight: bold;">DATE</span> <span style="color: #993333; font-weight: bold;">NOT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
  <span style="color: #ff0000;">`open_price`</span> <span style="color: #993333; font-weight: bold;">DECIMAL</span><span style="color: #66cc66;">(</span><span style="color: #cc66cc;">11</span><span style="color: #66cc66;">,</span><span style="color: #cc66cc;">6</span><span style="color: #66cc66;">)</span> <span style="color: #993333; font-weight: bold;">NULL</span> <span style="color: #993333; font-weight: bold;">DEFAULT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
  <span style="color: #ff0000;">`high_price`</span> <span style="color: #993333; font-weight: bold;">DECIMAL</span><span style="color: #66cc66;">(</span><span style="color: #cc66cc;">11</span><span style="color: #66cc66;">,</span><span style="color: #cc66cc;">6</span><span style="color: #66cc66;">)</span> <span style="color: #993333; font-weight: bold;">NULL</span> <span style="color: #993333; font-weight: bold;">DEFAULT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
  <span style="color: #ff0000;">`low_price`</span> <span style="color: #993333; font-weight: bold;">DECIMAL</span><span style="color: #66cc66;">(</span><span style="color: #cc66cc;">11</span><span style="color: #66cc66;">,</span><span style="color: #cc66cc;">6</span><span style="color: #66cc66;">)</span> <span style="color: #993333; font-weight: bold;">NULL</span> <span style="color: #993333; font-weight: bold;">DEFAULT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
  <span style="color: #ff0000;">`close_price`</span> <span style="color: #993333; font-weight: bold;">DECIMAL</span><span style="color: #66cc66;">(</span><span style="color: #cc66cc;">11</span><span style="color: #66cc66;">,</span><span style="color: #cc66cc;">6</span><span style="color: #66cc66;">)</span> <span style="color: #993333; font-weight: bold;">NULL</span> <span style="color: #993333; font-weight: bold;">DEFAULT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
  <span style="color: #ff0000;">`adj_close_price`</span> <span style="color: #993333; font-weight: bold;">DECIMAL</span><span style="color: #66cc66;">(</span><span style="color: #cc66cc;">11</span><span style="color: #66cc66;">,</span><span style="color: #cc66cc;">6</span><span style="color: #66cc66;">)</span> <span style="color: #993333; font-weight: bold;">NULL</span> <span style="color: #993333; font-weight: bold;">DEFAULT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
  <span style="color: #ff0000;">`volume`</span> <span style="color: #993333; font-weight: bold;">BIGINT</span><span style="color: #66cc66;">(</span><span style="color: #cc66cc;">20</span><span style="color: #66cc66;">)</span> <span style="color: #993333; font-weight: bold;">NULL</span> <span style="color: #993333; font-weight: bold;">DEFAULT</span> <span style="color: #993333; font-weight: bold;">NULL</span><span style="color: #66cc66;">,</span>
  <span style="color: #ff0000;">`created_date`</span> DATETIME <span style="color: #993333; font-weight: bold;">NULL</span> <span style="color: #993333; font-weight: bold;">DEFAULT</span> <span style="color: #993333; font-weight: bold;">CURRENT_TIMESTAMP</span><span style="color: #66cc66;">(</span><span style="color: #66cc66;">)</span><span style="color: #66cc66;">,</span>
  <span style="color: #ff0000;">`last_updated`</span> DATETIME <span style="color: #993333; font-weight: bold;">NULL</span> <span style="color: #993333; font-weight: bold;">DEFAULT</span> <span style="color: #993333; font-weight: bold;">CURRENT_TIMESTAMP</span><span style="color: #66cc66;">(</span><span style="color: #66cc66;">)</span> <span style="color: #993333; font-weight: bold;">ON</span> <span style="color: #993333; font-weight: bold;">UPDATE</span> <span style="color: #993333; font-weight: bold;">CURRENT_TIMESTAMP</span><span style="color: #66cc66;">(</span><span style="color: #66cc66;">)</span><span style="color: #66cc66;">,</span>
  <span style="color: #993333; font-weight: bold;">PRIMARY</span> <span style="color: #993333; font-weight: bold;">KEY</span> <span style="color: #66cc66;">(</span><span style="color: #ff0000;">`id`</span><span style="color: #66cc66;">)</span><span style="color: #66cc66;">,</span>
  <span style="color: #993333; font-weight: bold;">INDEX</span> <span style="color: #ff0000;">`price_date`</span> <span style="color: #66cc66;">(</span><span style="color: #ff0000;">`price_date`</span> <span style="color: #993333; font-weight: bold;">ASC</span><span style="color: #66cc66;">)</span><span style="color: #66cc66;">,</span>
  <span style="color: #993333; font-weight: bold;">INDEX</span> <span style="color: #ff0000;">`ticker_id`</span> <span style="color: #66cc66;">(</span><span style="color: #ff0000;">`ticker_id`</span> <span style="color: #993333; font-weight: bold;">ASC</span><span style="color: #66cc66;">)</span><span style="color: #66cc66;">,</span>
  <span style="color: #993333; font-weight: bold;">CONSTRAINT</span> <span style="color: #ff0000;">`fk_ticker_id`</span>
    <span style="color: #993333; font-weight: bold;">FOREIGN</span> <span style="color: #993333; font-weight: bold;">KEY</span> <span style="color: #66cc66;">(</span><span style="color: #ff0000;">`ticker_id`</span><span style="color: #66cc66;">)</span>
    <span style="color: #993333; font-weight: bold;">REFERENCES</span> <span style="color: #ff0000;">`instrument`</span> <span style="color: #66cc66;">(</span><span style="color: #ff0000;">`id`</span><span style="color: #66cc66;">)</span>
    <span style="color: #993333; font-weight: bold;">ON</span> <span style="color: #993333; font-weight: bold;">DELETE</span> NO ACTION
    <span style="color: #993333; font-weight: bold;">ON</span> <span style="color: #993333; font-weight: bold;">UPDATE</span> NO ACTION<span style="color: #66cc66;">,</span>
  <span style="color: #993333; font-weight: bold;">CONSTRAINT</span> <span style="color: #ff0000;">`fk_vendor_id`</span>
    <span style="color: #993333; font-weight: bold;">FOREIGN</span> <span style="color: #993333; font-weight: bold;">KEY</span> <span style="color: #66cc66;">(</span><span style="color: #ff0000;">`vendor_id`</span><span style="color: #66cc66;">)</span>
    <span style="color: #993333; font-weight: bold;">REFERENCES</span> <span style="color: #ff0000;">`vendor`</span> <span style="color: #66cc66;">(</span><span style="color: #ff0000;">`id`</span><span style="color: #66cc66;">)</span>
    <span style="color: #993333; font-weight: bold;">ON</span> <span style="color: #993333; font-weight: bold;">DELETE</span> NO ACTION
    <span style="color: #993333; font-weight: bold;">ON</span> <span style="color: #993333; font-weight: bold;">UPDATE</span> NO ACTION<span style="color: #66cc66;">)</span>
  ENGINE <span style="color: #66cc66;">=</span> InnoDB
  <span style="color: #993333; font-weight: bold;">DEFAULT</span> <span style="color: #993333; font-weight: bold;">CHARACTER</span> <span style="color: #993333; font-weight: bold;">SET</span> <span style="color: #66cc66;">=</span> utf8;</pre>						</div>
				</div>
				<div class="elementor-element elementor-element-6081d52 elementor-widget elementor-widget-text-editor" data-id="6081d52" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p style="font-size: 15px; font-style: normal; font-weight: 400; text-align: justify;">Whereas the other tables mainly exist to keep some meta information about the companies in our asset universe, theÂ <span style="font-weight: bold;">price</span>Â table actually holds the time series data and will be by far the largest table in the SMD.</p><p style="font-size: 15px; font-weight: 400; text-align: justify;"><span style="font-style: normal;">To distinctly assign a history of price data for a specific security, listed on a specific exchange with data from a specific vendor, we keep three identifiers (<u><i>id</i></u>,Â <i>vendor_id</i>,Â <i>ticker_id</i>). We don&#8217;t need anotherÂ <i>exchange_id</i>, since it is already implicitly given due to theÂ <i>foreign key</i>Â onÂ <span style="font-weight: bold;">instrument</span>&#8216;sÂ <i>id</i>Â attribute. For the actual time series data, we keep </span><i>price_date</i> as <i>index</i>, <i>open_price</i>, <i>high_price</i>, <i>low_price</i>, <i>close_price</i>, <i>adj_close_price</i>, and <i>volume</i>. Yet again, we also store the <i>created_date</i> and <i>last_updated</i> date.</p>						</div>
				</div>
					</div>
		</div>
							</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-b175933 elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="b175933" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-ed11e72" data-id="ed11e72" data-element_type="column">
			<div class="elementor-widget-wrap elementor-element-populated">
								<div class="elementor-element elementor-element-bac33bc elementor-widget elementor-widget-heading" data-id="bac33bc" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-default">4. Populating the SMD</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-6a0f967 elementor-widget elementor-widget-text-editor" data-id="6a0f967" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>With the SMD now having well-defined tables for all information that we want to store, it is about time to actually populate the database. This chapter will deal with the initialization process, i.e. writing a list of exchanges and data vendors to the database and selecting our universe of tradable assets to work with. Then, we will download historical price data for all of these instruments and write them to the database. Once this step is done, we already have a working SMD that we could use in the next steps of the <a href="https://niklasbaier.github.io/me/roadmap-to-a-full-quant-tech-stack/">Full Quant Tech Stack</a>.Â </p><p>However, as the universe of tradable assets keeps changing everyday (new symbols get listed, old symbols get delisted) and new price data gets published daily, we are still not done yet. In the next chapter, we will upgrade the SMD with various update functionalities to keep our list of instruments up-to-date and always have the latest end-of-day price data available.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-02de792 elementor-widget elementor-widget-heading" data-id="02de792" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-medium">4.1. Optional: Story Time - Deciding on a Universe of Tradable Assets</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-2ea2799 elementor-widget elementor-widget-alert" data-id="2ea2799" data-element_type="widget" data-widget_type="alert.default">
				<div class="elementor-widget-container">
					<div class="elementor-alert elementor-alert-info" role="alert">
			<span class="elementor-alert-title">TL;DR</span>
							<span class="elementor-alert-description">I'm writing / ranting about my experience and approaches so far with trying to download a lot of corporate information from Yahoo Finance. Skip this section and go straight to '4.2. APIs for Data Retrieval' if you want to continue with the SMD population. Otherwise, have fun reading!</span>
										<button type="button" class="elementor-alert-dismiss">
					<span aria-hidden="true">&times;</span>
					<span class="elementor-screen-only">Dismiss alert</span>
				</button>
					</div>
				</div>
				</div>
				<div class="elementor-element elementor-element-deb139d elementor-widget elementor-widget-text-editor" data-id="deb139d" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Okay, this might get a bit lengthy, but it was still a very important lesson for me in the process of setting up my SMD. I learned quite a lot about data downloading / reading / transforming / writing as well as the importance of batch downloading and fetching exceptions.</p><p>So far, this guide has been relatively true to its sources. If you&#8217;re reading the aforementioned <a href="https://www.quantstart.com/articles/Securities-Master-Database-with-MySQL-and-Python/">QuantStart article</a> (please do) and the <a href="https://reasonabledeviations.com/2018/02/01/stock-price-database/#choosing-a-database-management-system">blog post on Reasonable Deviations</a> (please do), you&#8217;ll find that both suggest a very similar approach to the database scheme. In fact, I tried to unify both approaches, simplifying at some places (e.g. the <b>exchange</b> table) and adding more detail at others (e.g. <b>instrument</b> table).Â </p><p>I didn&#8217;t want to limit my SMD to only securities of a specific index such as the <a href="https://en.wikipedia.org/wiki/S%26P_500">S&amp;P 500</a>, thus I didn&#8217;t follow the QuantStart article anymore after the section on schema design. I liked <a href="https://reasonabledeviations.com/about/">Robert Andrew Martin</a>&#8216;s approach of downloading a .csv file of all securities listed on a certain exchange better. The <a href="https://www.nasdaq.com/market-activity/stocks/screener">NASDAQ&#8217;s website</a>Â makes it very easy to download .csv files of stocks listed on NYSE, NASDAQ, and AMEX.Â </p><p>So far, so good. After downloading and reading the .csv file of all NYSE-listed securities, I had to perform some manual transforms to the data to get it from this &#8230;</p>						</div>
				</div>
				<div class="elementor-element elementor-element-3e678e9 elementor-widget elementor-widget-image" data-id="3e678e9" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
															<img width="1024" height="121" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-22-at-16.13.48-1024x121.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-22-at-16.13.48-1024x121.png 1024w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-22-at-16.13.48-300x35.png 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-22-at-16.13.48-768x90.png 768w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-22-at-16.13.48.png 1266w" sizes="(max-width: 1024px) 100vw, 1024px" />															</div>
				</div>
				<div class="elementor-element elementor-element-dc04cdc elementor-widget elementor-widget-text-editor" data-id="dc04cdc" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>&#8230; to a more readable structure that will be accepted by the database (note that at that time, I followed a slightly different schema for the SMD).</p>						</div>
				</div>
				<div class="elementor-element elementor-element-e3ecae0 elementor-widget elementor-widget-image" data-id="e3ecae0" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
															<img width="791" height="147" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-22-at-16.14.32.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-22-at-16.14.32.png 791w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-22-at-16.14.32-300x56.png 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-22-at-16.14.32-768x143.png 768w" sizes="(max-width: 791px) 100vw, 791px" />															</div>
				</div>
				<div class="elementor-element elementor-element-0f927e1 elementor-widget elementor-widget-text-editor" data-id="0f927e1" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p style="font-size: 15px; font-style: normal; font-weight: 400; text-align: justify;"><span style="font-style: inherit; font-family: var( --e-global-typography-text-font-family ), Sans-serif; font-weight: inherit;">After writing this table to the database and addingÂ <a href="https://finance.yahoo.com/">Yahoo Finance</a>Â as data vendor, I was finally able to query my SMD for every ticker, send a request to the Yahoo Finance API for historical price data, and write the result to the database. Version 1.0 of my SMD was up and running!Â  I remember proudly sending screenshots of the 12 Mio. rows price table to some friends of mine ..</span></p><p style="font-size: 15px; font-style: normal; font-weight: 400; text-align: justify;"><span style="font-style: inherit; font-family: var( --e-global-typography-text-font-family ), Sans-serif; font-weight: inherit;">However, my initial joy did not last long, since after proceeding similarly with the .csv file of all NASDAQ-listed securities, my Yahoo Finance API calls kept crashing with some weirdÂ </span><span style="font-family: var( --e-global-typography-text-font-family ), Sans-serif; font-weight: inherit;"><i>JSONDecodeError</i></span><span style="font-style: inherit; font-family: var( --e-global-typography-text-font-family ), Sans-serif; font-weight: inherit;">. I hadn&#8217;t changed anything on the code and the same logic that worked so well before now raised an error &#8211; frustrating. Luckily, I soon found a newly raised issue on theÂ <a href="https://github.com/ranaroussi/yfinance">yfinance GitHub repository</a>Â with my exact error and it seemed that the problem actually was on the Yahoo server end.</span></p><p style="font-size: 15px; font-style: normal; font-weight: 400; text-align: justify;">While I was waiting for the servers to accept API calls again, I compiled a list of the biggest and most representative stock exchanges for each major region of the world. I did not only want to focus on US equities and therefore my list of exchanges looked as follows:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-a7a9aa4 eael-table-align-center eael-dt-th-align-left eael-dt-td-align-left elementor-widget elementor-widget-eael-data-table" data-id="a7a9aa4" data-element_type="widget" data-widget_type="eael-data-table.default">
				<div class="elementor-widget-container">
					<div class="eael-data-table-wrap" data-table_id="a7a9aa4" data-custom_responsive="false">
			<table class="tablesorter eael-data-table center" id="eael-data-table-a7a9aa4">
			    <thead>
			        <tr class="table-header">
									            <th class="" id="" colspan="">
														<span class="data-table-header-text">North America Exchanges</span></th>
			        				            <th class="" id="" colspan="">
														<span class="data-table-header-text"></span></th>
			        				            <th class="" id="" colspan="">
														<span class="data-table-header-text"></span></th>
			        				        </tr>
			    </thead>
			  	<tbody>
											<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XNGS</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Nasdaq Global Select</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">United States</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XNYS</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">New York Stock Exchange</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">United States</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XTSE</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Toronto Stock Exchange</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Canada</div></div>
											</td>
																										</tr>
			        			    </tbody>
			</table>
		</div>
	  			</div>
				</div>
				<div class="elementor-element elementor-element-3b6442c eael-table-align-center eael-dt-th-align-left eael-dt-td-align-left elementor-widget elementor-widget-eael-data-table" data-id="3b6442c" data-element_type="widget" data-widget_type="eael-data-table.default">
				<div class="elementor-widget-container">
					<div class="eael-data-table-wrap" data-table_id="3b6442c" data-custom_responsive="false">
			<table class="tablesorter eael-data-table center" id="eael-data-table-3b6442c">
			    <thead>
			        <tr class="table-header">
									            <th class="" id="" colspan="">
														<span class="data-table-header-text">South America Exchanges</span></th>
			        				            <th class="" id="" colspan="">
														<span class="data-table-header-text"></span></th>
			        				            <th class="" id="" colspan="">
														<span class="data-table-header-text"></span></th>
			        				        </tr>
			    </thead>
			  	<tbody>
											<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">BVMF</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">B3 S.A. - Brasil, Bolsa, Balcao</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Brazil</div></div>
											</td>
																										</tr>
			        			    </tbody>
			</table>
		</div>
	  			</div>
				</div>
				<div class="elementor-element elementor-element-f9964fd eael-table-align-center eael-dt-th-align-left eael-dt-td-align-left elementor-widget elementor-widget-eael-data-table" data-id="f9964fd" data-element_type="widget" data-widget_type="eael-data-table.default">
				<div class="elementor-widget-container">
					<div class="eael-data-table-wrap" data-table_id="f9964fd" data-custom_responsive="false">
			<table class="tablesorter eael-data-table center" id="eael-data-table-f9964fd">
			    <thead>
			        <tr class="table-header">
									            <th class="" id="" colspan="">
														<span class="data-table-header-text">Europe Exchanges</span></th>
			        				            <th class="" id="" colspan="">
														<span class="data-table-header-text"></span></th>
			        				            <th class="" id="" colspan="">
														<span class="data-table-header-text"></span></th>
			        				        </tr>
			    </thead>
			  	<tbody>
											<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XAMS</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Euronext Amsterdam</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Netherlands</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XBRU</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Euronext Brussels</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Belgium</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XDUB</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Euronext Dublin</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Ireland</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XLIS</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Euronext Lisbon</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Portugal</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XPAR</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Euronext Paris</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">France</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XLDN</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">London Stock Exchange</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">United Kingdom</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XNGM</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Nordic Growth Market</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Sweden</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XOSL</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Oslo Stock Exchange</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Norway</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XSWX</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">SIX Swiss Exchange</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Switzerland</div></div>
											</td>
																										</tr>
			        			    </tbody>
			</table>
		</div>
	  			</div>
				</div>
				<div class="elementor-element elementor-element-ac53211 eael-table-align-center eael-dt-th-align-left eael-dt-td-align-left elementor-widget elementor-widget-eael-data-table" data-id="ac53211" data-element_type="widget" data-widget_type="eael-data-table.default">
				<div class="elementor-widget-container">
					<div class="eael-data-table-wrap" data-table_id="ac53211" data-custom_responsive="false">
			<table class="tablesorter eael-data-table center" id="eael-data-table-ac53211">
			    <thead>
			        <tr class="table-header">
									            <th class="" id="" colspan="">
														<span class="data-table-header-text">Germany Exchanges</span></th>
			        				            <th class="" id="" colspan="">
														<span class="data-table-header-text"></span></th>
			        				            <th class="" id="" colspan="">
														<span class="data-table-header-text"></span></th>
			        				        </tr>
			    </thead>
			  	<tbody>
											<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XBER</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Berlin Stock Exchange</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Germany</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XGAT</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Deutsche Boerse Tradegate</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Germany</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XDUS</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Dusseldorf Stock Exchange</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Germany</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XFRA</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Frankfurt Stock Exchange</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Germany</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XHAM</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Hamburg Stock Exchange</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Germany</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XHAN</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Hanover Stock Exchange</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Germany</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XMUN</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Munich Stock Exchange</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Germany</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XSTU</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Stuttgart Stock Exchange</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Germany</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XETR</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Xetra</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Germany</div></div>
											</td>
																										</tr>
			        			    </tbody>
			</table>
		</div>
	  			</div>
				</div>
				<div class="elementor-element elementor-element-cfd32e3 eael-table-align-center eael-dt-th-align-left eael-dt-td-align-left elementor-widget elementor-widget-eael-data-table" data-id="cfd32e3" data-element_type="widget" data-widget_type="eael-data-table.default">
				<div class="elementor-widget-container">
					<div class="eael-data-table-wrap" data-table_id="cfd32e3" data-custom_responsive="false">
			<table class="tablesorter eael-data-table center" id="eael-data-table-cfd32e3">
			    <thead>
			        <tr class="table-header">
									            <th class="" id="" colspan="">
														<span class="data-table-header-text">Middle East Exchanges</span></th>
			        				            <th class="" id="" colspan="">
														<span class="data-table-header-text"></span></th>
			        				            <th class="" id="" colspan="">
														<span class="data-table-header-text"></span></th>
			        				        </tr>
			    </thead>
			  	<tbody>
											<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XADS</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Abu Dhabi Securities Exchange</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">United Arab Emirates</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XSAU</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Saudi Arabian Stock Exchange</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Saudi Arabia</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XTAE</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Tel Aviv Stock Exchange</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Israel</div></div>
											</td>
																										</tr>
			        			    </tbody>
			</table>
		</div>
	  			</div>
				</div>
				<div class="elementor-element elementor-element-9616203 eael-table-align-center eael-dt-th-align-left eael-dt-td-align-left elementor-widget elementor-widget-eael-data-table" data-id="9616203" data-element_type="widget" data-widget_type="eael-data-table.default">
				<div class="elementor-widget-container">
					<div class="eael-data-table-wrap" data-table_id="9616203" data-custom_responsive="false">
			<table class="tablesorter eael-data-table center" id="eael-data-table-9616203">
			    <thead>
			        <tr class="table-header">
									            <th class="" id="" colspan="">
														<span class="data-table-header-text">Africa Exchanges</span></th>
			        				            <th class="" id="" colspan="">
														<span class="data-table-header-text"></span></th>
			        				            <th class="" id="" colspan="">
														<span class="data-table-header-text"></span></th>
			        				        </tr>
			    </thead>
			  	<tbody>
											<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XJSE</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Johannesburg Stock Exchange</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">South Africa</div></div>
											</td>
																										</tr>
			        			    </tbody>
			</table>
		</div>
	  			</div>
				</div>
				<div class="elementor-element elementor-element-5b46f54 eael-table-align-center eael-dt-th-align-left eael-dt-td-align-left elementor-widget elementor-widget-eael-data-table" data-id="5b46f54" data-element_type="widget" data-widget_type="eael-data-table.default">
				<div class="elementor-widget-container">
					<div class="eael-data-table-wrap" data-table_id="5b46f54" data-custom_responsive="false">
			<table class="tablesorter eael-data-table center" id="eael-data-table-5b46f54">
			    <thead>
			        <tr class="table-header">
									            <th class="" id="" colspan="">
														<span class="data-table-header-text">Asia Pacific Exchanges</span></th>
			        				            <th class="" id="" colspan="">
														<span class="data-table-header-text"></span></th>
			        				            <th class="" id="" colspan="">
														<span class="data-table-header-text"></span></th>
			        				        </tr>
			    </thead>
			  	<tbody>
											<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XASX</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Australian Securities Exchange</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Australia</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XBOM</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Bombay Stock Exchange</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">India</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XHKG</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Hong Kong Stock Exchange</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Hong Kong</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XKRX</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Korea Exchange</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">South Korea</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XNSE</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">National Stock Exchange of India</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">India</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XSHG</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Shanghai Stock Exchange</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">China</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XSHE</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Shenzhen Stock Exchange</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">China</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XTAI</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Taiwan Stock Exchange</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Taiwan</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XTKS</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Tokyo Stock Exchange</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Japan</div></div>
											</td>
																										</tr>
			        			    </tbody>
			</table>
		</div>
	  			</div>
				</div>
				<div class="elementor-element elementor-element-dcaf9ef elementor-widget elementor-widget-text-editor" data-id="dcaf9ef" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p><span style="text-align: justify;">As you can probably already guess, this list of exchanges was not only thorough, but also a huge undertaking in getting ticker information for. The main problem that I faced was that not every exchange provided a handy, ready-to-download .csv file of their listed securities as the NASDAQ did. After some research, I stumbled across <a href="https://bsym.bloomberg.com/search#!?pageSize=20&amp;page=1&amp;facets=SECURITY_TYP:,,Common%20Stock~EXCH_CODE:,,JT&amp;marketSector=Equity">this site from Bloomberg</a> which let me enter the <a href="https://en.wikipedia.org/wiki/Market_Identifier_Code">MIC</a> of the exchange and then returned a table of max. 5000 entries of listed securities that could be downloaded as a .csv file.</span></p>						</div>
				</div>
				<div class="elementor-element elementor-element-e5fbefc elementor-widget elementor-widget-alert" data-id="e5fbefc" data-element_type="widget" data-widget_type="alert.default">
				<div class="elementor-widget-container">
					<div class="elementor-alert elementor-alert-info" role="alert">
			<span class="elementor-alert-title">Note to self</span>
							<span class="elementor-alert-description">To this date, I am still convinced that this data source is as high-quality and thorough as it can get for an unpaid service. Plus, it is hosted by Bloomberg itself. The limitation on only 5000 entries is a tad inconvenient, but being able to filter for any kind of financial instrument and not only common stock more than makes up for it. Maybe some time in the future, I will come back to this data source for another attempt at an all-encompassing multi-instrument, international SMD.</span>
										<button type="button" class="elementor-alert-dismiss">
					<span aria-hidden="true">&times;</span>
					<span class="elementor-screen-only">Dismiss alert</span>
				</button>
					</div>
				</div>
				</div>
				<div class="elementor-element elementor-element-62cbf5f elementor-widget elementor-widget-text-editor" data-id="62cbf5f" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p style="font-size: 15px; font-style: normal; font-weight: 400; text-align: justify;">This small success was yet again overshadowed by another problem. Besides the actual ticker and company name, the .csv did not really provide any other corporate information that I wanted for my SMD. Thus, for every exchange, I read the .csv, kept only the tickers and wrote them to a list. I would then use these lists in the next step to query the Yahoo Finance API for corporate information on all the tickers to eventually fill theÂ <span style="font-weight: bold;">instrument</span>Â table.</p><p style="font-size: 15px; font-style: normal; font-weight: 400; text-align: justify;">Querying Yahoo Finance for corporate information is straight-forward in theory:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-7af2630 elementor-widget elementor-widget-text-editor" data-id="7af2630" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #ff7700; font-weight: bold;">import</span> yfinance <span style="color: #ff7700; font-weight: bold;">as</span> yf
Â 
yf.<span style="color: black;">Ticker</span><span style="color: black;">(</span>ticker<span style="color: black;">)</span>.<span style="color: black;">info</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-6a7e5e5 elementor-widget elementor-widget-text-editor" data-id="6a7e5e5" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>The problem is that Yahoo Finance returns a dictionary of more than 150 key-value pairs for this call. Since I was only interested in a handful of those, I defined a constant list with my keys of interest (KOI) and filtered the returned dictionary for these pairs:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-8aed116 elementor-widget elementor-widget-text-editor" data-id="8aed116" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff; --darkreader-inline-color: #d1cdc7; --darkreader-inline-bgcolor: #181a1b;" data-darkreader-inline-color="" data-darkreader-inline-bgcolor="">KOI <span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">=</span> <span style="color: black; --darkreader-inline-color: #e8e6e3;" data-darkreader-inline-color="">[</span><span style="color: #483d8b; --darkreader-inline-color: #857ac5;" data-darkreader-inline-color="">'symbol'</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">,</span> <span style="color: #483d8b; --darkreader-inline-color: #857ac5;" data-darkreader-inline-color="">'longName'</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">,</span> <span style="color: #483d8b; --darkreader-inline-color: #857ac5;" data-darkreader-inline-color="">'sector'</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">,</span> <span style="color: #483d8b; --darkreader-inline-color: #857ac5;" data-darkreader-inline-color="">'industry'</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">,</span> <span style="color: #483d8b; --darkreader-inline-color: #857ac5;" data-darkreader-inline-color="">'country'</span><span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">,</span> <span style="color: #483d8b; --darkreader-inline-color: #857ac5;" data-darkreader-inline-color="">'website'</span><span style="color: black; --darkreader-inline-color: #e8e6e3;" data-darkreader-inline-color="">]</span>
Â 
tmp <span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">=</span> yf.<span style="color: black; --darkreader-inline-color: #e8e6e3;" data-darkreader-inline-color="">Ticker</span><span style="color: black; --darkreader-inline-color: #e8e6e3;" data-darkreader-inline-color="">(</span>ticker<span style="color: black; --darkreader-inline-color: #e8e6e3;" data-darkreader-inline-color="">)</span>.<span style="color: black; --darkreader-inline-color: #e8e6e3;" data-darkreader-inline-color="">info</span>
data <span style="color: #66cc66; --darkreader-inline-color: #6ecf6e;" data-darkreader-inline-color="">=</span> <span style="color: black; --darkreader-inline-color: #e8e6e3;" data-darkreader-inline-color="">{</span>key: tmp<span style="color: black; --darkreader-inline-color: #e8e6e3;" data-darkreader-inline-color="">[</span>key<span style="color: black; --darkreader-inline-color: #e8e6e3;" data-darkreader-inline-color="">]</span> <span style="color: #ff7700; font-weight: bold; --darkreader-inline-color: #ff851a;" data-darkreader-inline-color="">for</span> key <span style="color: #ff7700; font-weight: bold; --darkreader-inline-color: #ff851a;" data-darkreader-inline-color="">in</span> KOI<span style="color: black; --darkreader-inline-color: #e8e6e3;" data-darkreader-inline-color="">}</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-20f5b60 elementor-widget elementor-widget-text-editor" data-id="20f5b60" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p style="font-size: 15px; font-weight: 400; text-align: justify;"><span style="font-style: normal;">This approach worked well during the experimenting phase, and thus, I started the download of corporate information for my list of XNGS (NASDAQ Global Select) tickers (around 1500). Every iteration (request dictionary for current ticker and write to tmp variable, filter for KOI and write to data variable, append row to pandas dataframe) took around 6-7 seconds. After around 2 hours, my program froze (or at least the current iteration took more than 10 minutes), so I interrupted it. I probably encountered some timeout error on the Yahoo server side that was not caught in my </span><i>try except</i> block. It seemed that querying these large dictionaries for so many tickers at once was not an option.</p><p style="font-size: 15px; font-style: normal; font-weight: 400; text-align: justify;">Although a bit inconvenient (especially given the aggregated frustration from before), this problem made me familiarize myself with writing a batch download function that, as the name suggests, downloads the data in small batches rather than one big request. Once again, I took inspiration from <a href="https://reasonabledeviations.com/about/">Robert Andrew Martin</a>Â and wrote the following two functions:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-5728338 elementor-widget elementor-widget-text-editor" data-id="5728338" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff; --darkreader-inline-color: #d1cdc7; --darkreader-inline-bgcolor: #181a1b;" data-darkreader-inline-color="" data-darkreader-inline-bgcolor=""><span style="color: #ff7700; font-weight: bold; --darkreader-inline-color: #ff851a;" data-darkreader-inline-color="">import</span> <span style="color: #dc143c; --darkreader-inline-color: #ed365b;" data-darkreader-inline-color="">time</span>
<span style="color: #ff7700; font-weight: bold; --darkreader-inline-color: #ff851a;" data-darkreader-inline-color="">import</span> pandas <span style="color: #ff7700; font-weight: bold; --darkreader-inline-color: #ff851a;" data-darkreader-inline-color="">as</span> pd
<span style="color: #ff7700; font-weight: bold; --darkreader-inline-color: #ff851a;" data-darkreader-inline-color="">import</span> yfinance <span style="color: #ff7700; font-weight: bold; --darkreader-inline-color: #ff851a;" data-darkreader-inline-color="">as</span> yf
<span style="color: #ff7700; font-weight: bold; --darkreader-inline-color: #ff851a;" data-darkreader-inline-color="">from</span> tqdm.<span style="color: black; --darkreader-inline-color: #e8e6e3;" data-darkreader-inline-color="">auto</span> <span style="color: #ff7700; font-weight: bold; --darkreader-inline-color: #ff851a;" data-darkreader-inline-color="">import</span> tqdm <span style="color: #808080; font-style: italic; --darkreader-inline-color: #988f81;" data-darkreader-inline-color=""># to output nice progress bars for the data download</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-dc8d73d elementor-widget elementor-widget-text-editor" data-id="dc8d73d" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;" data-darkreader-inline-color="" data-darkreader-inline-bgcolor=""><span style="color: #ff7700; font-weight: bold;" data-darkreader-inline-color="">def</span> get_info_batch<span style="color: black;" data-darkreader-inline-color="">(</span>start_idx<span style="color: #66cc66;" data-darkreader-inline-color="">,</span> end_idx<span style="color: #66cc66;" data-darkreader-inline-color="">,</span> exchange<span style="color: #66cc66;" data-darkreader-inline-color="">,</span> koi<span style="color: black;" data-darkreader-inline-color="">)</span>:
  <span style="color: #483d8b;" data-darkreader-inline-color="">"""
  Batch-wise download of key corporate information for a list of tickers
  :param start_idx: defines window of tickers within the passed list
  :param end_idx: defines window of tickers within the passed list
  :param exchange: list of tickers to get corporate information for
  :koi: which dictionary items to add to the return dataframe
  :return: dataframe that holds key corporate information of all tickers, list of tickers for which data could not be downloaded
  """</span>
  exchange_batch <span style="color: #66cc66;" data-darkreader-inline-color="">=</span> pd.<span style="color: black;" data-darkreader-inline-color="">DataFrame</span><span style="color: black;" data-darkreader-inline-color="">(</span><span style="color: black;" data-darkreader-inline-color="">)</span>
  excepts <span style="color: #66cc66;" data-darkreader-inline-color="">=</span> <span style="color: black;" data-darkreader-inline-color="">[</span><span style="color: black;" data-darkreader-inline-color="">]</span>
Â 
  <span style="color: #ff7700; font-weight: bold;" data-darkreader-inline-color="">for</span> ticker <span style="color: #ff7700; font-weight: bold;" data-darkreader-inline-color="">in</span> tqdm<span style="color: black;" data-darkreader-inline-color="">(</span>exchange<span style="color: black;" data-darkreader-inline-color="">[</span>start_idx:end_idx<span style="color: black;" data-darkreader-inline-color="">]</span><span style="color: black;" data-darkreader-inline-color="">)</span>:
    <span style="color: #ff7700; font-weight: bold;" data-darkreader-inline-color="">try</span>:
      tmp <span style="color: #66cc66;" data-darkreader-inline-color="">=</span> yf.<span style="color: black;" data-darkreader-inline-color="">Ticker</span><span style="color: black;" data-darkreader-inline-color="">(</span>ticker<span style="color: black;" data-darkreader-inline-color="">)</span>.<span style="color: black;" data-darkreader-inline-color="">info</span>
      data <span style="color: #66cc66;" data-darkreader-inline-color="">=</span> <span style="color: black;" data-darkreader-inline-color="">{</span>key: tmp<span style="color: black;" data-darkreader-inline-color="">[</span>key<span style="color: black;" data-darkreader-inline-color="">]</span> <span style="color: #ff7700; font-weight: bold;" data-darkreader-inline-color="">for</span> key <span style="color: #ff7700; font-weight: bold;" data-darkreader-inline-color="">in</span> koi<span style="color: black;" data-darkreader-inline-color="">}</span>
      exchange_batch <span style="color: #66cc66;" data-darkreader-inline-color="">=</span> exchange_batch.<span style="color: black;" data-darkreader-inline-color="">append</span><span style="color: black;" data-darkreader-inline-color="">(</span>data<span style="color: #66cc66;" data-darkreader-inline-color="">,</span> ignore_index<span style="color: #66cc66;" data-darkreader-inline-color="">=</span><span style="color: #008000;" data-darkreader-inline-color="">True</span><span style="color: black;" data-darkreader-inline-color="">)</span>
    <span style="color: #ff7700; font-weight: bold;" data-darkreader-inline-color="">except</span> <span style="color: #008000;" data-darkreader-inline-color="">Exception</span> <span style="color: #ff7700; font-weight: bold;" data-darkreader-inline-color="">as</span> e:
      excepts.<span style="color: black;" data-darkreader-inline-color="">append</span><span style="color: black;" data-darkreader-inline-color="">(</span>ticker<span style="color: black;" data-darkreader-inline-color="">)</span>
      <span style="color: #ff7700; font-weight: bold;" data-darkreader-inline-color="">continue</span>
Â 
  <span style="color: #ff7700; font-weight: bold;" data-darkreader-inline-color="">return</span> exchange_batch<span style="color: #66cc66;" data-darkreader-inline-color="">,</span> excepts</pre>						</div>
				</div>
				<div class="elementor-element elementor-element-85b2aee elementor-widget elementor-widget-text-editor" data-id="85b2aee" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>This is the actual download function that loops over a predetermined range (as specified by <i>start_idx</i> and <i>end_idx</i>) of elements in a given list of tickers (<i>exchange</i>) and queries Yahoo Finance for corporate information on each of these elements. It then filters the returned dictionary for the keys of interest (<i>koi</i>) and appends the data to the return dataframe (<i>exchange_batch</i>). Elements that raise an exception are written to a list (<i>excepts</i>) which is also returned for later inspection.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-1545897 elementor-widget elementor-widget-text-editor" data-id="1545897" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #ff7700; font-weight: bold;">def</span> get_corporate_info<span style="color: black;">(</span>exchange<span style="color: #66cc66;">,</span> batch_size<span style="color: #66cc66;">,</span> koi<span style="color: black;">)</span>:
  <span style="color: #483d8b;">"""
  Wrapper function to start a batch-wise download of corporate information for a list of tickers
  :param exchange: list of tickers to get corporate information for
  :koi: which dictionary items to add to the return dataframe
  :return: dataframe that holds key corporate information of all tickers, list of tickers for which data could not be downloaded
  """</span>
  n_batches <span style="color: #66cc66;">=</span> -<span style="color: black;">(</span>-<span style="color: #008000;">len</span><span style="color: black;">(</span>exchange<span style="color: black;">)</span> // batch_size<span style="color: black;">)</span>
  exchange_df <span style="color: #66cc66;">=</span> pd.<span style="color: black;">DataFrame</span><span style="color: black;">(</span><span style="color: black;">)</span>
  excepts <span style="color: #66cc66;">=</span> <span style="color: black;">[</span><span style="color: black;">]</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">print</span><span style="color: black;">(</span><span style="color: #483d8b;">"Downloading data in {} batches of size {}."</span>.<span style="color: black;">format</span><span style="color: black;">(</span>n_batches<span style="color: #66cc66;">,</span> batch_size<span style="color: black;">)</span><span style="color: black;">)</span>
  <span style="color: #ff7700; font-weight: bold;">for</span> i <span style="color: #ff7700; font-weight: bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">(</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> n_batches * batch_size<span style="color: #66cc66;">,</span> batch_size<span style="color: black;">)</span>:
    exchange_batch<span style="color: #66cc66;">,</span> excepts_batch <span style="color: #66cc66;">=</span> get_info_batch<span style="color: black;">(</span>i<span style="color: #66cc66;">,</span> i + batch_size<span style="color: #66cc66;">,</span> exchange<span style="color: #66cc66;">,</span> koi<span style="color: black;">)</span>
    exchange_df <span style="color: #66cc66;">=</span> exchange_df.<span style="color: black;">append</span><span style="color: black;">(</span>exchange_batch<span style="color: black;">)</span>
    excepts.<span style="color: black;">append</span><span style="color: black;">(</span>excepts_batch<span style="color: black;">)</span>
    <span style="color: #dc143c;">time</span>.<span style="color: black;">sleep</span><span style="color: black;">(</span><span style="color: #ff4500;">10</span><span style="color: black;">)</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">return</span> exchange_df<span style="color: #66cc66;">,</span> excepts</pre>						</div>
				</div>
				<div class="elementor-element elementor-element-6e16ae5 elementor-widget elementor-widget-text-editor" data-id="6e16ae5" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>This is the wrapper function which is actually called by the main program. It takes a list of tickers (<i>exchange</i>), a predetermined <i>batch_size</i> (e.g. 50) as well as the keys of interest (<i>koi</i>). First, the amount of batches (<i>n_batches</i>) is determined, then the <i>get_info_batch()</i>Â download function is called in a loop that goes over the ticker list in fixed intervals of length <i>batch_size</i>. The returns from the <i>get_info_batch()</i> function are appended to the <i>exchange_df</i> and <i>excepts</i> list. After each major batch, the function pauses for 10 seconds to allow for some &#8216;breathing&#8217;. I&#8217;m still not quite sure about the last part, but since I probably encountered some kind of timeout error before, I wanted to give the Yahoo Finance API some moments to rest before getting new requests from my IP address.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-f091e99 elementor-widget elementor-widget-text-editor" data-id="f091e99" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>This approach seemed more promising and was also better designed, but I still ran into the same timeout issue as before. In a last desperate attempt, I decided to introduce another layer of batches by splitting the ticker list first into sub-arrays of roughly equal length but no more than 500 tickers max, then call the <i>get_corporate_info()Â </i>function and append its returned <i>exchange_batch</i> into a dataframe (<i>exchange_df</i>) outside of the function such that in case my program had to be interrupted again, at least some of the work had been already saved and I could restart the download from the current batch. I tried to visualize the process as such:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-dfe37b5 elementor-widget elementor-widget-image" data-id="dfe37b5" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
															<img width="1024" height="572" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/batch2.jpg-1024x572.jpg" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/batch2.jpg-1024x572.jpg 1024w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/batch2.jpg-300x168.jpg 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/batch2.jpg-768x429.jpg 768w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/batch2.jpg-1536x858.jpg 1536w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/batch2.jpg-2048x1144.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px" />															</div>
				</div>
				<div class="elementor-element elementor-element-8a263de elementor-widget elementor-widget-text-editor" data-id="8a263de" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p><span style="text-align: justify;">Finally, it worked! I didn&#8217;t even need my fallback option of restarting the download from some batch since splitting the exchange ticker list into several sub lists and then downloading the corporate information for the tickers in those sub lists in batches was enough to have a clean, constant download stream from Yahoo Finance. Downloading all of the ticker data for the XNGS (NASDAQ Global Select) now took around 3 hours and resulted, after some column renaming and adding theÂ </span><i style="text-align: justify;">exchange_id</i><span style="text-align: justify;">, in a dataframe like this:</span></p>						</div>
				</div>
				<div class="elementor-element elementor-element-94b6934 elementor-widget elementor-widget-image" data-id="94b6934" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
															<img width="1024" height="287" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-23-at-11.58.01-1024x287.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-23-at-11.58.01-1024x287.png 1024w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-23-at-11.58.01-300x84.png 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-23-at-11.58.01-768x215.png 768w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-23-at-11.58.01.png 1039w" sizes="(max-width: 1024px) 100vw, 1024px" />															</div>
				</div>
				<div class="elementor-element elementor-element-b82b5de elementor-widget elementor-widget-text-editor" data-id="b82b5de" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p><span style="text-align: justify;">Now that my download process was finally running well, I knew that getting all of the corporate information for all tickers of all 35 exchanges would be as brute force as it could possibly get. But after training deep learning models all night for the <i>Introduction to Deep Learning</i> course that I took last summer term, I was already comfortable with letting my machine run for hours in the background. So, I started the download for the B3 S.A. &#8211; Brasil, Bolsa, Balcao stock exchange and laid back &#8230;</span></p><p><span style="text-align: justify;">This whole story would not be complete with yet another issue. After another 2 hours, my program terminated and I eagerly inspected the resulting dataframe only to find it completely empty and the list of exceptions containing every single ticker. What happened? As it turns out, Yahoo Finance does not necessarily go by the same tickers as e.g. Bloomberg does. Whereas Bloomberg&#8217;s symbol for the company <i>Fleury</i> is simply FLRY3, Yahoo Finance lists it as FLRY3.SA. Therefore, every ticker in the list threw an exception. It was at this point that I finally threw in the towel and pushed the idea of an all-encompassing, international SMD way back into the future. I just didn&#8217;t have the nerve to yet again alter all the tickers to match Yahoo Finance&#8217;s schema, possibly for every exchange.</span></p>						</div>
				</div>
				<div class="elementor-element elementor-element-12a6616 elementor-widget elementor-widget-alert" data-id="12a6616" data-element_type="widget" data-widget_type="alert.default">
				<div class="elementor-widget-container">
					<div class="elementor-alert elementor-alert-info" role="alert">
			<span class="elementor-alert-title">Takeaway</span>
							<span class="elementor-alert-description">By writing all of this down, I could transform some of my frustration from the past weeks into a valuable lesson for the future. Looking back, it was not all bad - I couldn't just take the easy route but had to think a lot about how to approach a huge data download and I am quite proud on my final process which seems to be working. Since I don't want to spend the next weeks with tweaking the ticker symbols to suit the Yahoo Finance API and then bulk downloading the data, I will go on with a smaller universe of financial instruments, but might get back to this later when the Full Quant Tech Stack is completely finished.</span>
										<button type="button" class="elementor-alert-dismiss">
					<span aria-hidden="true">&times;</span>
					<span class="elementor-screen-only">Dismiss alert</span>
				</button>
					</div>
				</div>
				</div>
				<div class="elementor-element elementor-element-aa73bc9 elementor-widget elementor-widget-heading" data-id="aa73bc9" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-medium">4.2. APIs for Data Retrieval</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-e7245cf elementor-widget elementor-widget-text-editor" data-id="e7245cf" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Although <a href="https://finance.yahoo.com/">Yahoo Finance</a> offers a vast universe of financial instruments, having to manually tweak tickers to suit Yahoo Finance&#8217;s schema as well as depending on an unofficial library (<a href="https://github.com/ranaroussi/yfinance">yfinance</a> by <a href="https://github.com/ranaroussi">Ran Aroussi</a>) to interact with its API ultimately made me look for another, more streamlined data source.</p><p>During my research, I stumbled across <a href="https://www.youtube.com/watch?v=OFnOEIyqSRg&amp;list=PLvzuUVysUFOuoRna8KhschkVVUo2E2g6G">this YouTube series</a> by <a href="https://www.youtube.com/results?search_query=part+time+larry">parttimelarry</a> from <a href="https://hackingthemarkets.com/author/parttimelarry/">Hacking the Markets</a>. Larry is not only a funny and easy-to-listen-to guy, but he also explains very well how the different components of a full stack trading app play together. I highly recommend to check out his channel and website!</p><p>It was due to Larry&#8217;s videos that I came across the <a href="https://alpaca.markets/">Alpaca Markets Trade API</a>. Alpaca is an actual broker and thus does not only offer high quality data on stocks, ETFs and crypto, but also nicely integrates with popular strategy backtesting tools such as <a href="https://www.backtrader.com/">Backtrader</a> and even offers an interface for paper and live trading. As I already noted down in <a href="https://niklasbaier.github.io/me/roadmap-to-a-full-quant-tech-stack/">thisÂ blog post</a>, Alpaca seems to be a perfect companion all the way from data collection to live trading.</p><p>What ultimately convinced me to try out Alpaca is the fact that its API offers a function <i>list_assets()</i> that always returns an up-to-date JSON dictionary of active and tradable assets which makes it dead easy to keep up with new company / ETF listings and delistings. Otherwise, I would have had to handcraft a script that re-downloads static .csv files of exchange listings and compare those against the database over and over again &#8211; how tedious!</p><p>In a perfect world, we would just consider the Alpaca API from now on and discard Yahoo Finance for good. While that surely is a solution, it would have the following drawbacks:</p><ol><li>The Alpaca API does not provide additional corporate information such as sector or industry on its tickers</li><li>The Alpaca API only provides a max. of 1000 trading days for historical prices and does not provide closing prices adjusted for corporate actions (adj. close)</li></ol><div>Thus, we will keep using a combination of both, Yahoo Finance and Alpaca, trying to leverage Alpaca&#8217;s streamlined simplicity and Yahoo Finance&#8217;s vast amounts of data.</div><div>Â </div><div><p style="font-size: 15px; font-style: normal; font-weight: 400;">Before you can actually use the Alpaca API, you&#8217;ll first have to register on theÂ <a href="https://app.alpaca.markets/signup">platform</a>Â and open up a free individual account. After that&#8217;s done, switch from Live Trading to Paper Trading in the dashboard and generate your API keypair (<i>private key</i>Â &amp;Â <i>secret key</i>). To use the API together with Python, make sure toÂ <i>pip install alpaca-trade-api</i>Â in your project environment.</p><p style="font-size: 15px; font-style: normal; font-weight: 400;">For any unclarities, refer to theÂ <a href="https://alpaca.markets/docs/api-documentation/api-v2/">official documentation</a>.</p></div>						</div>
				</div>
				<div class="elementor-element elementor-element-5d5d33a elementor-widget elementor-widget-heading" data-id="5d5d33a" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-medium">4.3 Roadmap for Database Population</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-44e594d elementor-widget elementor-widget-text-editor" data-id="44e594d" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Going forward, I suggest to split the code into the following files:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-ab08acd eael-table-align-center eael-dt-th-align-left eael-dt-td-align-left elementor-widget elementor-widget-eael-data-table" data-id="ab08acd" data-element_type="widget" data-widget_type="eael-data-table.default">
				<div class="elementor-widget-container">
					<div class="eael-data-table-wrap" data-table_id="ab08acd" data-custom_responsive="false">
			<table class="tablesorter eael-data-table center" id="eael-data-table-ab08acd">
			    <thead>
			        <tr class="table-header">
									            <th class="" id="" colspan="">
														<span class="data-table-header-text"></span></th>
			        				            <th class="" id="" colspan="">
														<span class="data-table-header-text"></span></th>
			        				        </tr>
			    </thead>
			  	<tbody>
											<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">init.ipynb</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Jupyter Notebook to go through the initial population cell by cell.</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">config.py</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Python file to store constants such as URLs, API keys, etc.</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">utils.py</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Python file to store function definitions.</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">update.py</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Python file to regularly update the SMD (later via cronjobs).</div></div>
											</td>
																										</tr>
			        			    </tbody>
			</table>
		</div>
	  			</div>
				</div>
				<div class="elementor-element elementor-element-5415da5 elementor-widget elementor-widget-text-editor" data-id="5415da5" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Which results in the <i>backend</i> directory to look something like this (with the data folder storing important interim results):</p>						</div>
				</div>
				<div class="elementor-element elementor-element-a8b4da7 elementor-widget elementor-widget-text-editor" data-id="a8b4da7" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">backend/
â”œâ”€ init.<span style="color: black;">ipynb</span>
â”œâ”€ config.<span style="color: black;">py</span>
â”œâ”€ utils.<span style="color: black;">py</span>
â”œâ”€ update.<span style="color: black;">py</span>
â”œâ”€ data/
â”‚  â”œâ”€ ..
Â </pre>						</div>
				</div>
				<div class="elementor-element elementor-element-514d83c elementor-widget elementor-widget-heading" data-id="514d83c" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h6 class="elementor-heading-title elementor-size-medium">config.py</h6>		</div>
				</div>
				<div class="elementor-element elementor-element-f44599a elementor-widget elementor-widget-text-editor" data-id="f44599a" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Throughout the initialization and later the updating steps, our program will need certain constant information such as the login details for the database connection, as well as the Alpaca API keys. Let&#8217;s store this information in the <i>config.py</i> file:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-332babc elementor-widget elementor-widget-text-editor" data-id="332babc" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #808080; font-style: italic;"># Database</span>
DB_HOST <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'localhost'</span>
DB_USER <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'root'</span>
DB_PASSWORD <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'yourpassword'</span>
DB_DATABASE <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'securities_master'</span>
Â 
Â 
<span style="color: #808080; font-style: italic;"># Alpaca API</span>
API_URL <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'https://paper-api.alpaca.markets/'</span>
API_KEY <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'yourprivatekey'</span>
API_SECRET <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'yoursecretkey'</span>
Â 
Â 
<span style="color: #808080; font-style: italic;"># Yahoo Finance</span>
KOI <span style="color: #66cc66;">=</span> <span style="color: black;">[</span><span style="color: #483d8b;">'symbol'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'sector'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'industry'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'country'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'website'</span><span style="color: black;">]</span> <span style="color: #808080; font-style: italic;"># keys of interest</span>
BATCH_SIZE <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">500</span> <span style="color: #808080; font-style: italic;"># max. number of tickers to be included in one batch</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-53a4ff2 elementor-widget elementor-widget-heading" data-id="53a4ff2" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h6 class="elementor-heading-title elementor-size-medium">utils.py</h6>		</div>
				</div>
				<div class="elementor-element elementor-element-92819fe elementor-widget elementor-widget-text-editor" data-id="92819fe" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>I tried to generalize as much functionality for the initialization &amp; updating process within the <i>utils.py</i> file. Throughout the <i>init.ipynb</i> and <i>update.py</i> file, we will call various functions from here. Let&#8217;s start with importing our <i>config.py</i> file and the packages needed for the functions:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-ee76168 elementor-widget elementor-widget-text-editor" data-id="ee76168" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #ff7700; font-weight: bold;">import</span> config <span style="color: #ff7700; font-weight: bold;">as</span> cf
Â 
<span style="color: #ff7700; font-weight: bold;">import</span> pymysql.<span style="color: black;">cursors</span>
<span style="color: #ff7700; font-weight: bold;">import</span> alpaca_trade_api <span style="color: #ff7700; font-weight: bold;">as</span> tradeapi
<span style="color: #ff7700; font-weight: bold;">import</span> yfinance <span style="color: #ff7700; font-weight: bold;">as</span> yf
Â 
<span style="color: #ff7700; font-weight: bold;">import</span> pandas <span style="color: #ff7700; font-weight: bold;">as</span> pd
<span style="color: #ff7700; font-weight: bold;">from</span> pandas_datareader <span style="color: #ff7700; font-weight: bold;">import</span> data <span style="color: #ff7700; font-weight: bold;">as</span> pdr
yf.<span style="color: black;">pdr_override</span><span style="color: black;">(</span><span style="color: black;">)</span> <span style="color: #808080; font-style: italic;"># let pandas_datareader override yfinance for faster downloads (use pdr prefix instead of yf)</span>
Â 
<span style="color: #ff7700; font-weight: bold;">from</span> tqdm.<span style="color: black;">auto</span> <span style="color: #ff7700; font-weight: bold;">import</span> tqdm <span style="color: #808080; font-style: italic;"># to output nice progress bars for the data download</span>
<span style="color: #ff7700; font-weight: bold;">import</span> lxml.<span style="color: black;">html</span> <span style="color: #ff7700; font-weight: bold;">as</span> lh
<span style="color: #ff7700; font-weight: bold;">import</span> requests
<span style="color: #ff7700; font-weight: bold;">import</span> <span style="color: #dc143c;">datetime</span>
<span style="color: #ff7700; font-weight: bold;">import</span> <span style="color: #dc143c;">time</span>
<span style="color: #ff7700; font-weight: bold;">import</span> <span style="color: #dc143c;">sys</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-39866fb elementor-widget elementor-widget-text-editor" data-id="39866fb" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Next, let&#8217;s write some simple functions to connect with our SMD and to retrieve the <i><u>id</u></i> of a specific exchange. We will need this functionality later when populating the <b>instrument</b> table.&nbsp;</p>						</div>
				</div>
				<div class="elementor-element elementor-element-c9fc71a elementor-widget elementor-widget-text-editor" data-id="c9fc71a" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #ff7700; font-weight: bold;">def</span> connect_db<span style="color: black;">(</span><span style="color: black;">)</span>:
  <span style="color: #483d8b;">"""
  Connect to a MySQL database
  :return: connection object
  """</span>
  conn <span style="color: #66cc66;">=</span> pymysql.<span style="color: black;">connect</span><span style="color: black;">(</span>
    host <span style="color: #66cc66;">=</span> cf.<span style="color: black;">DB_HOST</span><span style="color: #66cc66;">,</span>
    <span style="color: #dc143c;">user</span> <span style="color: #66cc66;">=</span> cf.<span style="color: black;">DB_USER</span><span style="color: #66cc66;">,</span>
    password <span style="color: #66cc66;">=</span> cf.<span style="color: black;">DB_PASSWORD</span><span style="color: #66cc66;">,</span>
    database <span style="color: #66cc66;">=</span> cf.<span style="color: black;">DB_DATABASE</span><span style="color: black;">)</span>
  <span style="color: #ff7700; font-weight: bold;">print</span><span style="color: black;">(</span><span style="color: #483d8b;">"|---------------| Successfully connected to {}. |---------------|"</span>.<span style="color: black;">format</span><span style="color: black;">(</span>cf.<span style="color: black;">DB_DATABASE</span><span style="color: black;">)</span><span style="color: black;">)</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">return</span> conn
Â 
Â 
<span style="color: #ff7700; font-weight: bold;">def</span> get_exchange_id<span style="color: black;">(</span>acronym<span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>:
  <span style="color: #483d8b;">"""
  Given a MySQL database connection, query for the exchange id of a specified exchange
  :param acronym: acronym of exchange that id needs to be retrieved for
  :param conn: MySQL database connection
  :return: exchange id
  """</span>
  <span style="color: #ff7700; font-weight: bold;">return</span> pd.<span style="color: black;">read_sql</span><span style="color: black;">(</span><span style="color: #483d8b;">"SELECT id FROM exchange WHERE acronym = '{}'"</span>.<span style="color: black;">format</span><span style="color: black;">(</span>acronym<span style="color: black;">)</span><span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>.<span style="color: black;">astype</span><span style="color: black;">(</span><span style="color: #008000;">int</span><span style="color: black;">)</span>.<span style="color: black;">iloc</span><span style="color: black;">[</span><span style="color: #ff4500;">0</span><span style="color: black;">]</span><span style="color: black;">[</span><span style="color: #483d8b;">'id'</span><span style="color: black;">]</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-fd3faa9 elementor-widget elementor-widget-text-editor" data-id="fd3faa9" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Similarly, we&#8217;ll need some functions to interact with the Alpaca API. See their descriptions for an explanation of what they do:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-4e7be36 elementor-widget elementor-widget-text-editor" data-id="4e7be36" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #ff7700; font-weight: bold;">def</span> connect_api<span style="color: black;">(</span><span style="color: black;">)</span>:
  <span style="color: #483d8b;">"""
  Connect to Alpaca API
  :return: api object
  """</span>
  api <span style="color: #66cc66;">=</span> tradeapi.<span style="color: black;">REST</span><span style="color: black;">(</span>cf.<span style="color: black;">API_KEY</span><span style="color: #66cc66;">,</span> cf.<span style="color: black;">API_SECRET</span><span style="color: #66cc66;">,</span> cf.<span style="color: black;">API_URL</span><span style="color: black;">)</span>
  <span style="color: #ff7700; font-weight: bold;">print</span><span style="color: black;">(</span><span style="color: #483d8b;">"|---------------| Successfully connected to Alpaca API. |---------------|"</span><span style="color: black;">)</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">return</span> api
Â 
Â 
<span style="color: #ff7700; font-weight: bold;">def</span> populate_exchange_list<span style="color: black;">(</span>acronym<span style="color: #66cc66;">,</span> assets<span style="color: black;">)</span>:
  <span style="color: #483d8b;">"""
  Query the active and tradable asset universe for tickers of a specific exchange
  :param acronym: acronym of exchange that the assets should be queried for
  :param assets: list of asset objects to be queried
  :return: list of tickers listed on the given exchange
  """</span>
  exchange <span style="color: #66cc66;">=</span> <span style="color: black;">[</span><span style="color: black;">]</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">for</span> asset <span style="color: #ff7700; font-weight: bold;">in</span> assets:
    <span style="color: #ff7700; font-weight: bold;">try</span>:
      <span style="color: #ff7700; font-weight: bold;">if</span> asset.<span style="color: black;">status</span> <span style="color: #66cc66;">==</span> <span style="color: #483d8b;">'active'</span> <span style="color: #ff7700; font-weight: bold;">and</span> asset.<span style="color: black;">tradable</span> <span style="color: #ff7700; font-weight: bold;">and</span> asset.<span style="color: black;">exchange</span> <span style="color: #66cc66;">==</span> acronym:
        exchange.<span style="color: black;">append</span><span style="color: black;">(</span>asset.<span style="color: #dc143c;">symbol</span><span style="color: black;">)</span>
    <span style="color: #ff7700; font-weight: bold;">except</span> <span style="color: #008000;">Exception</span> <span style="color: #ff7700; font-weight: bold;">as</span> e:
      <span style="color: #ff7700; font-weight: bold;">continue</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">return</span> exchange
Â 
Â 
<span style="color: #ff7700; font-weight: bold;">def</span> populate_exchange_df<span style="color: black;">(</span>acronym<span style="color: #66cc66;">,</span> assets<span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>:
  <span style="color: #483d8b;">"""
  Query the active and tradable asset universe for ticker data of a specific exchange
  :param acronym: acronym of exchange that the assets should be queried for
  :param assets: list of asset objects to be queried
  :param conn: MySQL database connection
  :return: dataframe of tickers with their corresponding exchange_id, symbol, and name of the given exchange
  """</span>
  exchange_df <span style="color: #66cc66;">=</span> pd.<span style="color: black;">DataFrame</span><span style="color: black;">(</span>columns <span style="color: #66cc66;">=</span> <span style="color: black;">[</span><span style="color: #483d8b;">'exchange_id'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'ticker'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'name'</span><span style="color: black;">]</span><span style="color: black;">)</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">for</span> asset <span style="color: #ff7700; font-weight: bold;">in</span> assets:
    <span style="color: #ff7700; font-weight: bold;">try</span>:
      <span style="color: #ff7700; font-weight: bold;">if</span> asset.<span style="color: black;">status</span> <span style="color: #66cc66;">==</span> <span style="color: #483d8b;">'active'</span> <span style="color: #ff7700; font-weight: bold;">and</span> asset.<span style="color: black;">tradable</span> <span style="color: #ff7700; font-weight: bold;">and</span> asset.<span style="color: black;">exchange</span> <span style="color: #66cc66;">==</span> acronym:
        tmp <span style="color: #66cc66;">=</span> <span style="color: black;">{</span><span style="color: #483d8b;">'exchange_id'</span> : get_exchange_id<span style="color: black;">(</span>acronym<span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'ticker'</span> : asset.<span style="color: #dc143c;">symbol</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'name'</span> : asset.<span style="color: black;">name</span><span style="color: black;">}</span>
        exchange_df <span style="color: #66cc66;">=</span> exchange_df.<span style="color: black;">append</span><span style="color: black;">(</span>tmp<span style="color: #66cc66;">,</span> ignore_index <span style="color: #66cc66;">=</span> <span style="color: #008000;">True</span><span style="color: black;">)</span>
    <span style="color: #ff7700; font-weight: bold;">except</span> <span style="color: #008000;">Exception</span> <span style="color: #ff7700; font-weight: bold;">as</span> e:
      <span style="color: #ff7700; font-weight: bold;">continue</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">return</span> exchange_df</pre>						</div>
				</div>
				<div class="elementor-element elementor-element-0bdde31 elementor-widget elementor-widget-heading" data-id="0bdde31" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h6 class="elementor-heading-title elementor-size-medium">init.ipynb</h6>		</div>
				</div>
				<div class="elementor-element elementor-element-d77b34e elementor-widget elementor-widget-heading" data-id="d77b34e" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-small">4.3.1. Imports</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-42ca321 elementor-widget elementor-widget-text-editor" data-id="42ca321" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>We need to import the <i>config.py</i> and <i>utils.py</i> files, as well as some other packages:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-dcef93c elementor-widget elementor-widget-text-editor" data-id="dcef93c" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #ff7700; font-weight: bold;">import</span> config <span style="color: #ff7700; font-weight: bold;">as</span> cf
<span style="color: #ff7700; font-weight: bold;">import</span> utils <span style="color: #ff7700; font-weight: bold;">as</span> ut
Â 
<span style="color: #ff7700; font-weight: bold;">import</span> numpy <span style="color: #ff7700; font-weight: bold;">as</span> np
<span style="color: #ff7700; font-weight: bold;">import</span> pandas <span style="color: #ff7700; font-weight: bold;">as</span> pd
<span style="color: #ff7700; font-weight: bold;">import</span> <span style="color: #dc143c;">datetime</span>
<span style="color: #ff7700; font-weight: bold;">import</span> <span style="color: #dc143c;">pickle</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-c8f29ca elementor-widget elementor-widget-heading" data-id="c8f29ca" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-small">4.3.2. Connections</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-e064a5a elementor-widget elementor-widget-text-editor" data-id="e064a5a" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Then, we need to connect to our SMD as well as the Alpaca API. Be aware that the MySQL server has to be running already (<i>mysql.server start</i>)! The package <i>pymysql</i> allows us to save the connection in a variable and create a cursor object to execute SQL queries via Python. If we want to make lasting changes to the database, we need to call <i>conn.commit()</i>. To close the connection, we call <i>cursor.close()</i> and <i>conn.close()</i>.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-099f913 elementor-widget elementor-widget-text-editor" data-id="099f913" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #808080; font-style: italic;"># Connect to DB</span>
conn <span style="color: #66cc66;">=</span> ut.<span style="color: black;">connect_db</span><span style="color: black;">(</span><span style="color: black;">)</span>
cursor <span style="color: #66cc66;">=</span> conn.<span style="color: black;">cursor</span><span style="color: black;">(</span><span style="color: black;">)</span>
Â 
<span style="color: #808080; font-style: italic;"># Connect to Alpaca API</span>
api <span style="color: #66cc66;">=</span> ut.<span style="color: black;">connect_api</span><span style="color: black;">(</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-cd55948 elementor-widget elementor-widget-heading" data-id="cd55948" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-small">4.3.3. Write Exchanges to SMD</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-d1dbdc1 elementor-widget elementor-widget-text-editor" data-id="d1dbdc1" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>In the first step of our initial database population, we&#8217;ll add all exchanges to our SMD that Alpaca provides data for. To find out which ones they are, we can simply call:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-c46aefe elementor-widget elementor-widget-text-editor" data-id="c46aefe" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;" data-darkreader-inline-color="" data-darkreader-inline-bgcolor="">exchanges <span style="color: #66cc66;" data-darkreader-inline-color="">=</span> <span style="color: black;" data-darkreader-inline-color="">{</span>asset.<span style="color: black;" data-darkreader-inline-color="">exchange</span> <span style="color: #ff7700; font-weight: bold;" data-darkreader-inline-color="">for</span> asset <span style="color: #ff7700; font-weight: bold;" data-darkreader-inline-color="">in</span> assets<span style="color: black;" data-darkreader-inline-color="">}</span>
<span style="color: #ff7700; font-weight: bold;" data-darkreader-inline-color="">print</span><span style="color: black;" data-darkreader-inline-color="">(</span>exchanges<span style="color: black;" data-darkreader-inline-color="">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-bfe71d7 elementor-widget elementor-widget-text-editor" data-id="bfe71d7" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="text" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">{'AMEX', 'OTC', 'NYSE', 'ARCA', 'BATS', 'NASDAQ'}</pre>						</div>
				</div>
				<div class="elementor-element elementor-element-084c621 elementor-widget elementor-widget-text-editor" data-id="084c621" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>I decided to drop the OTC market, since only a handful of active and tradable assets are actually listed on here which leaves us with the following exchanges (get MIC Codes &amp; Acronyms <a href="https://www.iso20022.org/market-identifier-codes">here</a>):</p>						</div>
				</div>
				<div class="elementor-element elementor-element-7840aa4 eael-table-align-center eael-dt-th-align-left eael-dt-td-align-left elementor-widget elementor-widget-eael-data-table" data-id="7840aa4" data-element_type="widget" data-widget_type="eael-data-table.default">
				<div class="elementor-widget-container">
					<div class="eael-data-table-wrap" data-table_id="7840aa4" data-custom_responsive="false">
			<table class="tablesorter eael-data-table center" id="eael-data-table-7840aa4">
			    <thead>
			        <tr class="table-header">
									            <th class="" id="" colspan="">
														<span class="data-table-header-text">North America Exchanges</span></th>
			        				            <th class="" id="" colspan="">
														<span class="data-table-header-text"></span></th>
			        				            <th class="" id="" colspan="">
														<span class="data-table-header-text"></span></th>
			        				        </tr>
			    </thead>
			  	<tbody>
											<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XNAS</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">NASDAQ</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Nasdaq - All Markets</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XNYS</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">NYSE</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">New York Stock Exchange</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">XASE</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">AMEX</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">NYSE American</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">ARCX </div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">ARCA</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">NYSE Arca</div></div>
											</td>
																										</tr>
			        						<tr>
																   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">BATS</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">BATS</div></div>
											</td>
																													   											<td colspan="" rowspan="" class="" id="">
												<div class="td-content-wrapper"><div class="td-content">Bats Global Markets</div></div>
											</td>
																										</tr>
			        						<tr>
													</tr>
			        			    </tbody>
			</table>
		</div>
	  			</div>
				</div>
				<div class="elementor-element elementor-element-dacb0f6 elementor-widget elementor-widget-text-editor" data-id="dacb0f6" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Now, we can add the exchanges to the SMD simply by calling:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-70bb259 elementor-widget elementor-widget-text-editor" data-id="70bb259" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">sql <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">"""
  INSERT INTO exchange (mic_code, acronym, name, region, country, city, currency) VALUES 
  ('XNAS', 'NASDAQ', 'Nasdaq - All Markets', 'North America', 'United States', 'New York', 'USD'),
  ('XNYS', 'NYSE', 'New York Stock Exchange', 'North America', 'United States', 'New York', 'USD'),
  ('XASE', 'AMEX', 'NYSE American', 'North America', 'United States', 'New York', 'USD'),
  ('ARCX', 'ARCA', 'NYSE Arca', 'North America', 'United States', 'New York', 'USD'),
  ('BATS', 'BATS', 'Bats Global Markets', 'North America', 'United States', 'Chicago', 'USD');"""</span>
cursor.<span style="color: black;">execute</span><span style="color: black;">(</span>sql<span style="color: black;">)</span>
conn.<span style="color: black;">commit</span><span style="color: black;">(</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-2b54497 elementor-widget elementor-widget-text-editor" data-id="2b54497" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>A quick check via MySQL Workbench (<i>SELECT * FROM exchange;</i>) shows that everything worked well and we just successfully added the first data tuples to our SMD!</p>						</div>
				</div>
				<div class="elementor-element elementor-element-6ac2056 elementor-widget elementor-widget-image" data-id="6ac2056" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
												<figure class="wp-caption">
										<img width="820" height="126" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-24-at-15.40.53.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-24-at-15.40.53.png 820w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-24-at-15.40.53-300x46.png 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-24-at-15.40.53-768x118.png 768w" sizes="(max-width: 820px) 100vw, 820px" />											<figcaption class="widget-image-caption wp-caption-text">MySQL Workbench view of the exchange table.</figcaption>
										</figure>
									</div>
				</div>
				<div class="elementor-element elementor-element-4f9ffb6 elementor-widget elementor-widget-heading" data-id="4f9ffb6" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-small">4.3.4. Write Instruments to SMD</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-9513be4 elementor-widget elementor-widget-text-editor" data-id="9513be4" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p style="font-size: 15px; font-style: normal; font-weight: 400; text-align: justify;">As convenient as the Alpaca API is, it unfortunately does not provide a lot of meta information on its tradable assets. Besides the ticker and name, we don&#8217;t really get much more corporate information on the financial instrument. You&#8217;ll notice that the database schema for the instrument table as defined in the very beginning, asks for more information than just the ticker and name. It would be very convenient to additionally store theÂ <i>sector</i>Â andÂ <i>industry</i>, as well as theÂ <i>country</i>Â andÂ <i>website</i>Â of each asset such that we can filter the instruments in a more detailed fashion. For instance, we could later on try to scan for supertrends, i.e. whole sectors or industries showing momentum effects or we could try to access an interesting company&#8217;s website for further webscraping.</p><p style="font-size: 15px; font-weight: 400; text-align: justify;"><span style="font-style: normal;">This is where the Yahoo Finance API comes in. I went into much detail about getting corporate information via Yahoo Finance in the optional readÂ <i>4.1. Story Time &#8211; Deciding on a Universe of Tradable Assets</i>, so if not done already you might want to go back and skim through the chapter after all. Basically though, we will write some functions to query Yahoo Finance for a list of tickers of an exchange, filter the returned dictionaries for our keys of interest (</span><i>sector</i>, <i>industry</i>, <i>country</i>, <i>website</i>) and write the result into an <i>exchange_info</i> dataframe. We will then combine the <i>exchange_alpaca</i> dataframe of tickers and names that we got from the Alpaca API with the <i>exchange_info</i> dataframe from Yahoo Finance via an outer join on the ticker, leaving us with an <i>exchange_df</i> dataframe that contains all active and tradable tickers of that exchange that Alpaca provides historical pricing data for, with most of them being refined with additional, corporate information from Yahoo Finance. Easy-peasy right?</p>						</div>
				</div>
				<div class="elementor-element elementor-element-8c99fc1 elementor-widget elementor-widget-image" data-id="8c99fc1" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
															<img width="1024" height="619" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/dataframes-1024x619.jpg" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/dataframes-1024x619.jpg 1024w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/dataframes-300x181.jpg 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/dataframes-768x464.jpg 768w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/dataframes-1536x928.jpg 1536w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/dataframes-2048x1237.jpg 2048w" sizes="(max-width: 1024px) 100vw, 1024px" />															</div>
				</div>
				<div class="elementor-element elementor-element-60fb566 elementor-widget elementor-widget-text-editor" data-id="60fb566" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Back in the <i>utils.py</i> file, let us write the functions needed for the Yahoo Finance API calls. To understand the logic behind the <i>get_corporate_info()</i> and <i>get_info_batch()</i> batch-downloading functions, feel free to go back to the optional read.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-e1f7364 elementor-widget elementor-widget-text-editor" data-id="e1f7364" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #ff7700; font-weight: bold;">def</span> determine_splits<span style="color: black;">(</span>exchange<span style="color: #66cc66;">,</span> batch_size<span style="color: black;">)</span>:
  <span style="color: #483d8b;">"""
  Determines the amount of splits for a list, given a batch_size
  :param exchange: list for which splits should be determined
  :param batch_size: max. amount of tickers to be included in one batch
  :return: amount of splits
  """</span>
  <span style="color: #ff7700; font-weight: bold;">return</span> -<span style="color: black;">(</span>-<span style="color: #008000;">len</span><span style="color: black;">(</span>exchange<span style="color: black;">)</span> // batch_size<span style="color: black;">)</span>
Â 
Â 
<span style="color: #ff7700; font-weight: bold;">def</span> get_corporate_info<span style="color: black;">(</span>exchange<span style="color: #66cc66;">,</span> batch_size<span style="color: #66cc66;">,</span> koi<span style="color: black;">)</span>:
  <span style="color: #483d8b;">"""
  Wrapper function to start a batch-wise download of corporate information for a list of tickers
  :param exchange: list of tickers to get corporate information for
  :param batch_size: max. amount of tickers to be included in one batch
  :koi: which dictionary items to add to the return dataframe
  :return: dataframe that holds key corporate information of all tickers
  """</span>
  n_batches <span style="color: #66cc66;">=</span> determine_splits<span style="color: black;">(</span>exchange<span style="color: #66cc66;">,</span> batch_size<span style="color: black;">)</span>
  exchange_df <span style="color: #66cc66;">=</span> pd.<span style="color: black;">DataFrame</span><span style="color: black;">(</span><span style="color: black;">)</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">print</span><span style="color: black;">(</span><span style="color: #483d8b;">"Downloading data in {} batches of size {}."</span>.<span style="color: black;">format</span><span style="color: black;">(</span>n_batches<span style="color: #66cc66;">,</span> batch_size<span style="color: black;">)</span><span style="color: black;">)</span>
  <span style="color: #ff7700; font-weight: bold;">for</span> i <span style="color: #ff7700; font-weight: bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">(</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> n_batches * batch_size<span style="color: #66cc66;">,</span> batch_size<span style="color: black;">)</span>:
    exchange_batch <span style="color: #66cc66;">=</span> get_info_batch<span style="color: black;">(</span>i<span style="color: #66cc66;">,</span> i + batch_size<span style="color: #66cc66;">,</span> exchange<span style="color: #66cc66;">,</span> koi<span style="color: black;">)</span>
    exchange_df <span style="color: #66cc66;">=</span> exchange_df.<span style="color: black;">append</span><span style="color: black;">(</span>exchange_batch<span style="color: black;">)</span>
    <span style="color: #dc143c;">time</span>.<span style="color: black;">sleep</span><span style="color: black;">(</span><span style="color: #ff4500;">10</span><span style="color: black;">)</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">return</span> exchange_df
Â 
Â 
<span style="color: #ff7700; font-weight: bold;">def</span> get_info_batch<span style="color: black;">(</span>start_idx<span style="color: #66cc66;">,</span> end_idx<span style="color: #66cc66;">,</span> exchange<span style="color: #66cc66;">,</span> koi<span style="color: black;">)</span>:
  <span style="color: #483d8b;">"""
  Batch-wise download of key corporate information for a list of tickers
  :param start_idx: defines window of tickers within the passed list
  :param end_idx: defines window of tickers within the passed list
  :param exchange: list of tickers to get corporate information for
  :koi: which dictionary items to add to the return dataframe
  :return: dataframe that holds key corporate information of all tickers
  """</span>
  exchange_batch <span style="color: #66cc66;">=</span> pd.<span style="color: black;">DataFrame</span><span style="color: black;">(</span><span style="color: black;">)</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">for</span> ticker <span style="color: #ff7700; font-weight: bold;">in</span> tqdm<span style="color: black;">(</span>exchange<span style="color: black;">[</span>start_idx:end_idx<span style="color: black;">]</span><span style="color: black;">)</span>:
    <span style="color: #ff7700; font-weight: bold;">try</span>:
      tmp <span style="color: #66cc66;">=</span> yf.<span style="color: black;">Ticker</span><span style="color: black;">(</span>ticker<span style="color: black;">)</span>.<span style="color: black;">info</span>
      data <span style="color: #66cc66;">=</span> <span style="color: black;">{</span>key: tmp<span style="color: black;">[</span>key<span style="color: black;">]</span> <span style="color: #ff7700; font-weight: bold;">for</span> key <span style="color: #ff7700; font-weight: bold;">in</span> koi<span style="color: black;">}</span>
      exchange_batch <span style="color: #66cc66;">=</span> exchange_batch.<span style="color: black;">append</span><span style="color: black;">(</span>data<span style="color: #66cc66;">,</span> ignore_index <span style="color: #66cc66;">=</span> <span style="color: #008000;">True</span><span style="color: black;">)</span>
    <span style="color: #ff7700; font-weight: bold;">except</span> <span style="color: #008000;">Exception</span> <span style="color: #ff7700; font-weight: bold;">as</span> e:
      <span style="color: #ff7700; font-weight: bold;">continue</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">return</span> exchange_batch</pre>						</div>
				</div>
				<div class="elementor-element elementor-element-5234549 elementor-widget elementor-widget-text-editor" data-id="5234549" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Before we can start with populating the <b>instrument</b> table, we first have to get our universe of assets from Alpaca via my favorite function:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-322590c elementor-widget elementor-widget-text-editor" data-id="322590c" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">assets <span style="color: #66cc66;">=</span> api.<span style="color: black;">list_assets</span><span style="color: black;">(</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-b2e6954 elementor-widget elementor-widget-text-editor" data-id="b2e6954" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Then, we can put our <i>populate_exchange_list()</i> function to use and store the tickers of all active and tradable assets by exchange:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-23f4eb4 elementor-widget elementor-widget-text-editor" data-id="23f4eb4" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">nasdaq <span style="color: #66cc66;">=</span> ut.<span style="color: black;">populate_exchange_list</span><span style="color: black;">(</span><span style="color: #483d8b;">'NASDAQ'</span><span style="color: #66cc66;">,</span> assets<span style="color: black;">)</span>
nyse <span style="color: #66cc66;">=</span> ut.<span style="color: black;">populate_exchange_list</span><span style="color: black;">(</span><span style="color: #483d8b;">'NYSE'</span><span style="color: #66cc66;">,</span> assets<span style="color: black;">)</span>
amex <span style="color: #66cc66;">=</span> ut.<span style="color: black;">populate_exchange_list</span><span style="color: black;">(</span><span style="color: #483d8b;">'AMEX'</span><span style="color: #66cc66;">,</span> assets<span style="color: black;">)</span>
arca <span style="color: #66cc66;">=</span> ut.<span style="color: black;">populate_exchange_list</span><span style="color: black;">(</span><span style="color: #483d8b;">'ARCA'</span><span style="color: #66cc66;">,</span> assets<span style="color: black;">)</span>
bats <span style="color: #66cc66;">=</span> ut.<span style="color: black;">populate_exchange_list</span><span style="color: black;">(</span><span style="color: #483d8b;">'BATS'</span><span style="color: #66cc66;">,</span> assets<span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-e978b0e elementor-widget elementor-widget-text-editor" data-id="e978b0e" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Lastly, we need to cast these lists of tickers to a format that is accepted by Yahoo Finance. As I&#8217;ve already had to learn the hard way (see optional read), tickers are not completely unambiguous and different data vendors have different semantics for them. For instance, while Alpaca handles different tranches via a dot followed by the tranche identifier (e.g. <i>.A</i>), Yahoo Finance does so via a hyphen (e.g. <i>-A</i>). Thus, if we do not account for those peculiarities, we will get much less data from Yahoo Finance. Let&#8217;s quickly write two functions, one to cast the tickers to Yahoo Finance format, and the other to cast them back to Alpaca format:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-1994ee5 elementor-widget elementor-widget-text-editor" data-id="1994ee5" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #ff7700; font-weight: bold;">def</span> cast_to_alpaca<span style="color: black;">(</span>exchange<span style="color: black;">)</span>:
  <span style="color: #483d8b;">"""
  Cast tickers from Yahoo Finance format to Alpaca format
  :param exchange: list of tickers to be casted
  :return: list of tickers in Alpaca format
  """</span>
  <span style="color: #ff7700; font-weight: bold;">for</span> i <span style="color: #ff7700; font-weight: bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">(</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">len</span><span style="color: black;">(</span>exchange<span style="color: black;">)</span><span style="color: black;">)</span>:
    <span style="color: #808080; font-style: italic;"># Strings are immutable, we therefore need new assignment</span>
    exchange<span style="color: black;">[</span>i<span style="color: black;">]</span> <span style="color: #66cc66;">=</span> exchange<span style="color: black;">[</span>i<span style="color: black;">]</span>.<span style="color: black;">replace</span><span style="color: black;">(</span><span style="color: #483d8b;">'-UN'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'.U'</span><span style="color: black;">)</span>
    exchange<span style="color: black;">[</span>i<span style="color: black;">]</span> <span style="color: #66cc66;">=</span> exchange<span style="color: black;">[</span>i<span style="color: black;">]</span>.<span style="color: black;">replace</span><span style="color: black;">(</span><span style="color: #483d8b;">'-'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'.'</span><span style="color: black;">)</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">return</span> exchange
Â 
Â 
<span style="color: #ff7700; font-weight: bold;">def</span> cast_to_yf<span style="color: black;">(</span>exchange<span style="color: black;">)</span>:
  <span style="color: #483d8b;">"""
  Cast tickers from Alpaca format to Yahoo Finance format
  :param exchange: list of tickers to be casted
  :return: list of tickers in Yahoo Finance format
  """</span>
  <span style="color: #ff7700; font-weight: bold;">for</span> i <span style="color: #ff7700; font-weight: bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">(</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">len</span><span style="color: black;">(</span>exchange<span style="color: black;">)</span><span style="color: black;">)</span>:
    <span style="color: #808080; font-style: italic;"># Strings are immutable, we therefore need new assignment</span>
    exchange<span style="color: black;">[</span>i<span style="color: black;">]</span> <span style="color: #66cc66;">=</span> exchange<span style="color: black;">[</span>i<span style="color: black;">]</span>.<span style="color: black;">replace</span><span style="color: black;">(</span><span style="color: #483d8b;">'.U'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'-UN'</span><span style="color: black;">)</span>
    exchange<span style="color: black;">[</span>i<span style="color: black;">]</span> <span style="color: #66cc66;">=</span> exchange<span style="color: black;">[</span>i<span style="color: black;">]</span>.<span style="color: black;">replace</span><span style="color: black;">(</span><span style="color: #483d8b;">'.'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'-'</span><span style="color: black;">)</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">return</span> exchange</pre>						</div>
				</div>
				<div class="elementor-element elementor-element-f43ebb6 elementor-widget elementor-widget-text-editor" data-id="f43ebb6" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Let&#8217;s use these functions to update our ticker lists to Yahoo Finance format:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-14a2ab7 elementor-widget elementor-widget-text-editor" data-id="14a2ab7" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">nasdaq <span style="color: #66cc66;">=</span> <span style="color: #008000;">sorted</span><span style="color: black;">(</span>ut.<span style="color: black;">cast_to_yf</span><span style="color: black;">(</span>nasdaq<span style="color: black;">)</span><span style="color: black;">)</span>
nyse <span style="color: #66cc66;">=</span> <span style="color: #008000;">sorted</span><span style="color: black;">(</span>ut.<span style="color: black;">cast_to_yf</span><span style="color: black;">(</span>nyse<span style="color: black;">)</span><span style="color: black;">)</span>
amex <span style="color: #66cc66;">=</span> <span style="color: #008000;">sorted</span><span style="color: black;">(</span>ut.<span style="color: black;">cast_to_yf</span><span style="color: black;">(</span>amex<span style="color: black;">)</span><span style="color: black;">)</span>
arca <span style="color: #66cc66;">=</span> <span style="color: #008000;">sorted</span><span style="color: black;">(</span>ut.<span style="color: black;">cast_to_yf</span><span style="color: black;">(</span>arca<span style="color: black;">)</span><span style="color: black;">)</span>
bats <span style="color: #66cc66;">=</span> <span style="color: #008000;">sorted</span><span style="color: black;">(</span>ut.<span style="color: black;">cast_to_yf</span><span style="color: black;">(</span>bats<span style="color: black;">)</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-6c13cd5 elementor-widget elementor-widget-heading" data-id="6c13cd5" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h6 class="elementor-heading-title elementor-size-small">Exemplary Process on AMEX</h6>		</div>
				</div>
				<div class="elementor-element elementor-element-146bd19 elementor-widget elementor-widget-text-editor" data-id="146bd19" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>With all of the preparations being done, the following will demonstrate in detail how to populate the AMEX exchange dataframe.Â </p><p>From the <i>init.ipynb</i> file, call the <i>populate_exchange_df()</i> function from <i>utils.py</i> and pass it the acronym <i>AMEX</i>, the Alpaca stock universe <i>assets</i>, as well as the connection object <i>conn</i> (needed to get the correct <i>exchange_id</i>).</p>						</div>
				</div>
				<div class="elementor-element elementor-element-7c8fc49 elementor-widget elementor-widget-text-editor" data-id="7c8fc49" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">amex_alpaca <span style="color: #66cc66;">=</span> ut.<span style="color: black;">populate_exchange_df</span><span style="color: black;">(</span><span style="color: #483d8b;">'AMEX'</span><span style="color: #66cc66;">,</span> assets<span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>
amex_alpaca</pre>						</div>
				</div>
				<div class="elementor-element elementor-element-fbf3d4c elementor-widget elementor-widget-image" data-id="fbf3d4c" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
												<figure class="wp-caption">
										<img width="356" height="288" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-27-at-11.05.45.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-27-at-11.05.45.png 356w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-27-at-11.05.45-300x243.png 300w" sizes="(max-width: 356px) 100vw, 356px" />											<figcaption class="widget-image-caption wp-caption-text">amex_alpaca dataframe</figcaption>
										</figure>
									</div>
				</div>
				<div class="elementor-element elementor-element-7ca7183 elementor-widget elementor-widget-text-editor" data-id="7ca7183" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Then, call the following cell to start the download process of corporate information from Yahoo Finance for the AMEX tickers. In order not to overload the Yahoo server with too many requests at once, we first split the list of tickers into several sub-arrays of roughly the same size (max. of 500). For each of those sub-arrays, we then call the <i>get_corporate_info()</i> function which then calls the <i>get_info_batch()</i> function to download corporate information from Yahoo Finance in batches of 50 for the current sub-array. All of the resulting sub-dataframes are then appended to the <i>amex_info</i> dataframe.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-f0d7f1a elementor-widget elementor-widget-alert" data-id="f0d7f1a" data-element_type="widget" data-widget_type="alert.default">
				<div class="elementor-widget-container">
					<div class="elementor-alert elementor-alert-warning" role="alert">
			<span class="elementor-alert-title">Caution</span>
							<span class="elementor-alert-description">Depending on the amount of tickers listed in the exchange, this process can take up to several hours!</span>
										<button type="button" class="elementor-alert-dismiss">
					<span aria-hidden="true">&times;</span>
					<span class="elementor-screen-only">Dismiss alert</span>
				</button>
					</div>
				</div>
				</div>
				<div class="elementor-element elementor-element-f05215b elementor-widget elementor-widget-text-editor" data-id="f05215b" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">splits <span style="color: #66cc66;">=</span> ut.<span style="color: black;">determine_splits</span><span style="color: black;">(</span>amex<span style="color: #66cc66;">,</span> cf.<span style="color: black;">BATCH_SIZE</span><span style="color: black;">)</span>
split_arr <span style="color: #66cc66;">=</span> np.<span style="color: black;">array_split</span><span style="color: black;">(</span>amex<span style="color: #66cc66;">,</span> splits<span style="color: black;">)</span>
amex_info <span style="color: #66cc66;">=</span> pd.<span style="color: black;">DataFrame</span><span style="color: black;">(</span><span style="color: black;">)</span>
Â 
count <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span>
<span style="color: #ff7700; font-weight: bold;">for</span> <span style="color: #dc143c;">array</span> <span style="color: #ff7700; font-weight: bold;">in</span> split_arr:
  <span style="color: #ff7700; font-weight: bold;">print</span><span style="color: black;">(</span><span style="color: #483d8b;">"|---------------| Split {} of {} |---------------|"</span>.<span style="color: black;">format</span><span style="color: black;">(</span>count<span style="color: #66cc66;">,</span> splits<span style="color: black;">)</span><span style="color: black;">)</span>
  tmp <span style="color: #66cc66;">=</span> ut.<span style="color: black;">get_corporate_info</span><span style="color: black;">(</span><span style="color: #dc143c;">array</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">50</span><span style="color: #66cc66;">,</span> cf.<span style="color: black;">KOI</span><span style="color: black;">)</span>
  amex_info <span style="color: #66cc66;">=</span> amex_info.<span style="color: black;">append</span><span style="color: black;">(</span>tmp<span style="color: black;">)</span>
  count +<span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-6618396 elementor-widget elementor-widget-image" data-id="6618396" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
															<img width="363" height="216" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/amex_download.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/amex_download.png 363w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/amex_download-300x179.png 300w" sizes="(max-width: 363px) 100vw, 363px" />															</div>
				</div>
				<div class="elementor-element elementor-element-b7a81a3 elementor-widget elementor-widget-text-editor" data-id="b7a81a3" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>After the download is done, let&#8217;s view the resulting <i>amex_info</i> dataframe:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-2bcb311 elementor-widget elementor-widget-image" data-id="2bcb311" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
												<figure class="wp-caption">
										<img width="797" height="290" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-27-at-12.22.57.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-27-at-12.22.57.png 797w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-27-at-12.22.57-300x109.png 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-27-at-12.22.57-768x279.png 768w" sizes="(max-width: 797px) 100vw, 797px" />											<figcaption class="widget-image-caption wp-caption-text">untreated amex_info dataframe</figcaption>
										</figure>
									</div>
				</div>
				<div class="elementor-element elementor-element-6efd251 elementor-widget elementor-widget-text-editor" data-id="6efd251" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Everything seems to have worked, although some tickers are obviously missing. These tickers must have thrown an exception when trying to query the API for them and have thus been dropped. But since we will do an outer join later with the <i>amex_alpaca</i> dataframe anyways, we will not lose these tickers &#8211; just don&#8217;t have additional information for them. Next, let&#8217;s re-cast the tickers to Alpaca format and rename the column <i>symbol</i> to <i>ticker</i>.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-9b776e2 elementor-widget elementor-widget-text-editor" data-id="9b776e2" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">tmp <span style="color: #66cc66;">=</span> ut.<span style="color: black;">cast_to_alpaca</span><span style="color: black;">(</span>amex_info<span style="color: black;">[</span><span style="color: #483d8b;">'symbol'</span><span style="color: black;">]</span>.<span style="color: black;">tolist</span><span style="color: black;">(</span><span style="color: black;">)</span><span style="color: black;">)</span>
amex_info.<span style="color: black;">drop</span><span style="color: black;">(</span><span style="color: #483d8b;">'symbol'</span><span style="color: #66cc66;">,</span> axis <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> inplace <span style="color: #66cc66;">=</span> <span style="color: #008000;">True</span><span style="color: black;">)</span>
amex_info.<span style="color: black;">insert</span><span style="color: black;">(</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'ticker'</span><span style="color: #66cc66;">,</span> tmp<span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-f37424a elementor-widget elementor-widget-image" data-id="f37424a" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
												<figure class="wp-caption">
										<img width="788" height="291" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-27-at-12.24.34.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-27-at-12.24.34.png 788w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-27-at-12.24.34-300x111.png 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-27-at-12.24.34-768x284.png 768w" sizes="(max-width: 788px) 100vw, 788px" />											<figcaption class="widget-image-caption wp-caption-text">clean amex_info dataframe</figcaption>
										</figure>
									</div>
				</div>
				<div class="elementor-element elementor-element-5f39af9 elementor-widget elementor-widget-text-editor" data-id="5f39af9" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Lastly, we&#8217;ll join the two dataframes <i>amex_alpaca</i> and <i>amex_info</i> on <i>ticker</i> and sort the resulting <i>amex_df</i> dataframe.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-e8ce830 elementor-widget elementor-widget-text-editor" data-id="e8ce830" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">amex_df <span style="color: #66cc66;">=</span> pd.<span style="color: black;">merge</span><span style="color: black;">(</span>amex_alpaca<span style="color: #66cc66;">,</span> amex_info<span style="color: #66cc66;">,</span> on <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'ticker'</span><span style="color: #66cc66;">,</span> how <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'outer'</span><span style="color: black;">)</span>
amex_df <span style="color: #66cc66;">=</span> amex_df.<span style="color: black;">sort_values</span><span style="color: black;">(</span>by <span style="color: #66cc66;">=</span> <span style="color: black;">[</span><span style="color: #483d8b;">'ticker'</span><span style="color: black;">]</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-1b4c97b elementor-widget elementor-widget-image" data-id="1b4c97b" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
												<figure class="wp-caption">
										<img width="1024" height="281" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-27-at-12.28.46-1024x281.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-27-at-12.28.46-1024x281.png 1024w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-27-at-12.28.46-300x82.png 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-27-at-12.28.46-768x211.png 768w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-27-at-12.28.46.png 1054w" sizes="(max-width: 1024px) 100vw, 1024px" />											<figcaption class="widget-image-caption wp-caption-text">complete &amp; clean amex_df dataframe</figcaption>
										</figure>
									</div>
				</div>
				<div class="elementor-element elementor-element-aeaf00f elementor-widget elementor-widget-text-editor" data-id="aeaf00f" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>We can now save our progress by writing the dataframe to a .csv file. Downloading all the ticker data for every exchange takes a lot of time, so you might want to distribute the process over several days. Before actually adding the data to the SMD, we will read the .csv files back in again.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-c86df0b elementor-widget elementor-widget-text-editor" data-id="c86df0b" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">amex_df.<span style="color: black;">to_csv</span><span style="color: black;">(</span><span style="color: #483d8b;">'data/AMEX.csv'</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-451d72d elementor-widget elementor-widget-heading" data-id="451d72d" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h6 class="elementor-heading-title elementor-size-small">Rinse &amp; Repeat with the other exchanges</h6>		</div>
				</div>
				<div class="elementor-element elementor-element-26440d9 elementor-widget elementor-widget-text-editor" data-id="26440d9" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p><span style="text-align: justify;">Repeat the process described above for AMEX for every other exchange. Altogether, the corporate information downloads from Yahoo Finance took around pretty much exactly 20 hours for me.</span></p>						</div>
				</div>
				<div class="elementor-element elementor-element-2e1798e elementor-arrows-position-inside elementor-pagination-position-outside elementor-widget elementor-widget-image-carousel" data-id="2e1798e" data-element_type="widget" data-settings="{&quot;slides_to_show&quot;:&quot;1&quot;,&quot;navigation&quot;:&quot;both&quot;,&quot;autoplay&quot;:&quot;yes&quot;,&quot;pause_on_hover&quot;:&quot;yes&quot;,&quot;pause_on_interaction&quot;:&quot;yes&quot;,&quot;autoplay_speed&quot;:5000,&quot;infinite&quot;:&quot;yes&quot;,&quot;effect&quot;:&quot;slide&quot;,&quot;speed&quot;:500}" data-widget_type="image-carousel.default">
				<div class="elementor-widget-container">
					<div class="elementor-image-carousel-wrapper swiper-container" dir="ltr">
			<div class="elementor-image-carousel swiper-wrapper">
								<div class="swiper-slide"><figure class="swiper-slide-inner"><img class="swiper-slide-image" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/nasdaq_download.png" alt="NASDAQ" /><figcaption class="elementor-image-carousel-caption">NASDAQ</figcaption></figure></div><div class="swiper-slide"><figure class="swiper-slide-inner"><img class="swiper-slide-image" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-26-at-17.40.43.png" alt="NYSE" /><figcaption class="elementor-image-carousel-caption">NYSE</figcaption></figure></div><div class="swiper-slide"><figure class="swiper-slide-inner"><img class="swiper-slide-image" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/arca_download.png" alt="ARCA" /><figcaption class="elementor-image-carousel-caption">ARCA</figcaption></figure></div><div class="swiper-slide"><figure class="swiper-slide-inner"><img class="swiper-slide-image" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/bats_download.png" alt="BATS" /><figcaption class="elementor-image-carousel-caption">BATS</figcaption></figure></div>			</div>
												<div class="swiper-pagination"></div>
													<div class="elementor-swiper-button elementor-swiper-button-prev">
						<i class="eicon-chevron-left" aria-hidden="true"></i>
						<span class="elementor-screen-only">Previous</span>
					</div>
					<div class="elementor-swiper-button elementor-swiper-button-next">
						<i class="eicon-chevron-right" aria-hidden="true"></i>
						<span class="elementor-screen-only">Next</span>
					</div>
									</div>
				</div>
				</div>
				<div class="elementor-element elementor-element-6a6ea8b elementor-widget elementor-widget-text-editor" data-id="6a6ea8b" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>In exchange for that, I got additional information on around 90% of AMEX and NYSE tickers, as well as 75% of NASDAQ tickers, which, in my opinion, was well worth the effort. Unfortunately, for ARCA and BATS, I only got additional information on less than 1% of tickers. My educated guess is that Yahoo Finance does not hold any corporate information on ETFs and other non-common-stock instruments that are mainly listed in these two exchanges.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-365de06 elementor-widget elementor-widget-progress" data-id="365de06" data-element_type="widget" data-widget_type="progress.default">
				<div class="elementor-widget-container">
						<span class="elementor-title">Corporate Information on Tickers</span>
		
		<div class="elementor-progress-wrapper" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="90" aria-valuetext="AMEX">
			<div class="elementor-progress-bar" data-max="90">
				<span class="elementor-progress-text">AMEX</span>
									<span class="elementor-progress-percentage">90%</span>
							</div>
		</div>
				</div>
				</div>
				<div class="elementor-element elementor-element-af480b4 elementor-widget elementor-widget-progress" data-id="af480b4" data-element_type="widget" data-widget_type="progress.default">
				<div class="elementor-widget-container">
			
		<div class="elementor-progress-wrapper" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="90" aria-valuetext="NYSE">
			<div class="elementor-progress-bar" data-max="90">
				<span class="elementor-progress-text">NYSE</span>
									<span class="elementor-progress-percentage">90%</span>
							</div>
		</div>
				</div>
				</div>
				<div class="elementor-element elementor-element-7194507 elementor-widget elementor-widget-progress" data-id="7194507" data-element_type="widget" data-widget_type="progress.default">
				<div class="elementor-widget-container">
			
		<div class="elementor-progress-wrapper" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="75" aria-valuetext="NASDAQ">
			<div class="elementor-progress-bar" data-max="75">
				<span class="elementor-progress-text">NASDAQ</span>
									<span class="elementor-progress-percentage">75%</span>
							</div>
		</div>
				</div>
				</div>
				<div class="elementor-element elementor-element-e76b4aa elementor-widget elementor-widget-heading" data-id="e76b4aa" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h6 class="elementor-heading-title elementor-size-small">Actually Writing to the SMD</h6>		</div>
				</div>
				<div class="elementor-element elementor-element-4a547fa elementor-widget elementor-widget-text-editor" data-id="4a547fa" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Once you&#8217;ve got all your .csv files, it is about time to read them back in and finally add the contained information to the SMD. Note that when reading from .csv, we need to drop the <i>Unnamed: 0</i> column, as well as replace <i>NaN</i> values with <i>None</i> for MySQL to work with:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-a87cbb4 elementor-widget elementor-widget-text-editor" data-id="a87cbb4" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">amex_df <span style="color: #66cc66;">=</span> pd.<span style="color: black;">read_csv</span><span style="color: black;">(</span><span style="color: #483d8b;">'data/AMEX.csv'</span><span style="color: black;">)</span>
amex_df <span style="color: #66cc66;">=</span> amex_df.<span style="color: black;">loc</span><span style="color: black;">[</span>:<span style="color: #66cc66;">,</span> amex_df.<span style="color: black;">columns</span> <span style="color: #66cc66;">!=</span> <span style="color: #483d8b;">'Unnamed: 0'</span><span style="color: black;">]</span>
amex_df <span style="color: #66cc66;">=</span> amex_df.<span style="color: black;">replace</span><span style="color: black;">(</span><span style="color: black;">{</span>np.<span style="color: black;">nan</span>: <span style="color: #008000;">None</span><span style="color: black;">}</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-daa44b4 elementor-widget elementor-widget-text-editor" data-id="daa44b4" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>After reading all .csv files back in and post-processing them as described above, we add them to a dictionary &#8230;</p>						</div>
				</div>
				<div class="elementor-element elementor-element-fd689bd elementor-widget elementor-widget-text-editor" data-id="fd689bd" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">exchanges <span style="color: #66cc66;">=</span> <span style="color: black;">{</span>
  <span style="color: #483d8b;">'NASDAQ'</span>: nasdaq_df<span style="color: #66cc66;">,</span>
  <span style="color: #483d8b;">'NYSE'</span>: nyse_df<span style="color: #66cc66;">,</span>
  <span style="color: #483d8b;">'AMEX'</span>: amex_df<span style="color: #66cc66;">,</span>
  <span style="color: #483d8b;">'ARCA'</span>: arca_df<span style="color: #66cc66;">,</span>
  <span style="color: #483d8b;">'BATS'</span>: bats_df<span style="color: #66cc66;">,</span>
<span style="color: black;">}</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-b6e72ce elementor-widget elementor-widget-text-editor" data-id="b6e72ce" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>&#8230; and then simply iterate over every row of every exchange to add it to the database. This process might seem daunting at first, but it actually takes less than a second to execute! By replacing all <i>NaN</i> cells with <i>None</i> before, we made sure that each row can be inserted into the table, even if it does not have complete information for every cell.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-939c1ed elementor-widget elementor-widget-text-editor" data-id="939c1ed" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #ff7700; font-weight: bold;">for</span> key<span style="color: #66cc66;">,</span> exchange <span style="color: #ff7700; font-weight: bold;">in</span> exchanges.<span style="color: black;">items</span><span style="color: black;">(</span><span style="color: black;">)</span>:
  <span style="color: #ff7700; font-weight: bold;">for</span> row <span style="color: #ff7700; font-weight: bold;">in</span> exchange.<span style="color: black;">itertuples</span><span style="color: black;">(</span>index <span style="color: #66cc66;">=</span> <span style="color: #008000;">False</span><span style="color: black;">)</span>:
    cursor.<span style="color: black;">execute</span><span style="color: black;">(</span><span style="color: #483d8b;">"INSERT INTO instrument (exchange_id, ticker, name, sector, industry, country, website) VALUES (%s, %s, %s, %s, %s, %s, %s)"</span><span style="color: #66cc66;">,</span> row<span style="color: black;">)</span>
conn.<span style="color: black;">commit</span><span style="color: black;">(</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-683657b elementor-widget elementor-widget-text-editor" data-id="683657b" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Now, we have more than 10,000 financial instruments (equities and ETFs) from five different US exchanges in our database and for most of them, we even got additional information such as the sector and industry, country and website.Â </p><p>Additionally, if we ever need to setup the SMD from scratch again, we already have the .csv files which let us initialize the database within minutes!</p><p>Great success!</p>						</div>
				</div>
				<div class="elementor-element elementor-element-72ac2ef elementor-widget elementor-widget-image" data-id="72ac2ef" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
												<figure class="wp-caption">
										<img width="1024" height="809" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-29-at-15.10.19-1024x809.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-29-at-15.10.19-1024x809.png 1024w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-29-at-15.10.19-300x237.png 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-29-at-15.10.19-768x607.png 768w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-29-at-15.10.19-500x395.png 500w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-29-at-15.10.19-800x632.png 800w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-29-at-15.10.19.png 1197w" sizes="(max-width: 1024px) 100vw, 1024px" />											<figcaption class="widget-image-caption wp-caption-text">MySQL Workbench view of the instrument table.</figcaption>
										</figure>
									</div>
				</div>
				<div class="elementor-element elementor-element-b7f1c4e elementor-widget elementor-widget-heading" data-id="b7f1c4e" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-small">4.3.5. Write Vendor to SMD</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-2f3da55 elementor-widget elementor-widget-text-editor" data-id="2f3da55" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>We will be using a combination of the Yahoo Finance and Alpaca APIs for populating the price table. Let&#8217;s quickly add these two manually to the vendor table:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-3e02e83 elementor-widget elementor-widget-text-editor" data-id="3e02e83" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #808080; font-style: italic;"># Yahoo Finance</span>
sql <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">"INSERT INTO vendor (name, website) VALUES ('Yahoo Finance', 'https://finance.yahoo.com/')"</span>
cursor.<span style="color: black;">execute</span><span style="color: black;">(</span>sql<span style="color: black;">)</span>
conn.<span style="color: black;">commit</span><span style="color: black;">(</span><span style="color: black;">)</span>
Â 
<span style="color: #808080; font-style: italic;"># Alpaca</span>
sql <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">"INSERT INTO vendor (name, website) VALUES ('Alpaca', 'https://alpaca.markets/')"</span>
cursor.<span style="color: black;">execute</span><span style="color: black;">(</span>sql<span style="color: black;">)</span>
conn.<span style="color: black;">commit</span><span style="color: black;">(</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-025f551 elementor-widget elementor-widget-image" data-id="025f551" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
												<figure class="wp-caption">
										<img width="518" height="76" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-30-at-19.06.28.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-30-at-19.06.28.png 518w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-30-at-19.06.28-300x44.png 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-30-at-19.06.28-500x73.png 500w" sizes="(max-width: 518px) 100vw, 518px" />											<figcaption class="widget-image-caption wp-caption-text">MySQL Workbench view of the vendor table.</figcaption>
										</figure>
									</div>
				</div>
				<div class="elementor-element elementor-element-0ab277f elementor-widget elementor-widget-heading" data-id="0ab277f" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-small">4.3.6. Write Prices to SMD</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-8e578be elementor-widget elementor-widget-text-editor" data-id="8e578be" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>We have finally arrived at the last step of the initial database population! All that&#8217;s left to do, is to download as much historical pricing data as possible for every ticker in the <b>instruments</b> table. As already foreshadowed before, we will yet again combine the Yahoo Finance and Alpaca APIs, trying to download as much data for as many tickers as possible via Yahoo Finance and then fill in the blanks with data from Alpaca. The <i><u>id</u></i> of the vendor table will help us in distinguishing between the two data sources.</p><p>To make sure not to accidentally download intraday pricing data for the current day, we will download historical data only up to yesterday&#8217;s date:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-6e86a98 elementor-widget elementor-widget-text-editor" data-id="6e86a98" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">today <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">datetime</span>.<span style="color: black;">date</span>.<span style="color: black;">today</span><span style="color: black;">(</span><span style="color: black;">)</span>
yesterday <span style="color: #66cc66;">=</span> <span style="color: #008000;">str</span><span style="color: black;">(</span>today - <span style="color: #dc143c;">datetime</span>.<span style="color: black;">timedelta</span><span style="color: black;">(</span>days <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span><span style="color: black;">)</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-6096eaa elementor-widget elementor-widget-text-editor" data-id="6096eaa" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Before we can start, we need to add some more functions to our <i>utils.py</i> file. First, let&#8217;s write some quick functions to retrieve a list of all tickers of a specific exchange, as well as the vendor id from the database:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-a47f4e8 elementor-widget elementor-widget-text-editor" data-id="a47f4e8" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #ff7700; font-weight: bold;">def</span> get_exchange_tickers<span style="color: black;">(</span>acronym<span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>:
  <span style="color: #483d8b;">"""
  Given a MySQL database connection, query for the tickers of a specified exchange
  :param acronym: acronym of exchange that tickers needs to be retrieved for
  :param conn: MySQL database connection
  :return: dataframe of tickers with their corresponding ids
  """</span>
  exchange_id <span style="color: #66cc66;">=</span> get_exchange_id<span style="color: black;">(</span>acronym<span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>
  <span style="color: #ff7700; font-weight: bold;">return</span> pd.<span style="color: black;">read_sql</span><span style="color: black;">(</span><span style="color: #483d8b;">"SELECT ticker, id FROM instrument WHERE exchange_id = '{}'"</span>.<span style="color: black;">format</span><span style="color: black;">(</span>exchange_id<span style="color: black;">)</span><span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>
Â 
Â 
<span style="color: #ff7700; font-weight: bold;">def</span> get_vendor_id<span style="color: black;">(</span>name<span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>:
  <span style="color: #483d8b;">"""
  Given a MySQL database connection, query for the vendor id of a specified vendor
  :param name: name of vendor that id needs to be retrieved for
  :param conn: MySQL database connection
  :return: vendor id
  """</span>
  <span style="color: #ff7700; font-weight: bold;">return</span> pd.<span style="color: black;">read_sql</span><span style="color: black;">(</span><span style="color: #483d8b;">"SELECT id FROM vendor WHERE name = '{}'"</span>.<span style="color: black;">format</span><span style="color: black;">(</span>name<span style="color: black;">)</span><span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>.<span style="color: black;">astype</span><span style="color: black;">(</span><span style="color: #008000;">int</span><span style="color: black;">)</span>.<span style="color: black;">iloc</span><span style="color: black;">[</span><span style="color: #ff4500;">0</span><span style="color: black;">]</span><span style="color: black;">[</span><span style="color: #483d8b;">'id'</span><span style="color: black;">]</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-a9e4ea0 elementor-widget elementor-widget-text-editor" data-id="a9e4ea0" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Next is the function for querying the Yahoo Finance API for a set of tickers and write their pricing history directly to the database. We will keep track of those tickers for which Yahoo Finance either returns an empty dataframe or an exception such that we can later query the Alpaca API for those instruments:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-3f6bac5 elementor-widget elementor-widget-text-editor" data-id="3f6bac5" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #ff7700; font-weight: bold;">def</span> write_historical_prices_yf<span style="color: black;">(</span>tickers<span style="color: #66cc66;">,</span> conn<span style="color: #66cc66;">,</span> cursor<span style="color: #66cc66;">,</span> start_date<span style="color: #66cc66;">,</span> end_date<span style="color: black;">)</span>:
  <span style="color: #483d8b;">"""
  Retrieves historical prices for a set of tickers from Yahoo Finance and writes them directly to the database
  :param tickers: list of tickers for which prices should be written
  :param conn: MySQL database connection
  :param cursor: MySQL database cursor for query execution
  :param start_date: earliest price date
  :param end_date: latest price date
  :return: list of tickers that no data could be retrieved for, casted to Alpaca format
  """</span>
  ticker_index <span style="color: #66cc66;">=</span> <span style="color: #008000;">dict</span><span style="color: black;">(</span>tickers.<span style="color: black;">to_dict</span><span style="color: black;">(</span><span style="color: #483d8b;">'split'</span><span style="color: black;">)</span><span style="color: black;">[</span><span style="color: #483d8b;">'data'</span><span style="color: black;">]</span><span style="color: black;">)</span>
  ticker_list <span style="color: #66cc66;">=</span> cast_to_yf<span style="color: black;">(</span><span style="color: #008000;">list</span><span style="color: black;">(</span>ticker_index.<span style="color: black;">keys</span><span style="color: black;">(</span><span style="color: black;">)</span><span style="color: black;">)</span><span style="color: black;">)</span>
  vendor <span style="color: #66cc66;">=</span> get_vendor_id<span style="color: black;">(</span><span style="color: #483d8b;">'Yahoo Finance'</span><span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>
  excepts <span style="color: #66cc66;">=</span> <span style="color: black;">[</span><span style="color: black;">]</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">for</span> ticker <span style="color: #ff7700; font-weight: bold;">in</span> tqdm<span style="color: black;">(</span>ticker_list<span style="color: black;">)</span>:
    <span style="color: #ff7700; font-weight: bold;">try</span>:
      tmp <span style="color: #66cc66;">=</span> pdr.<span style="color: black;">get_data_yahoo</span><span style="color: black;">(</span>ticker<span style="color: #66cc66;">,</span> start <span style="color: #66cc66;">=</span> start_date<span style="color: #66cc66;">,</span> end <span style="color: #66cc66;">=</span> end_date<span style="color: #66cc66;">,</span> progress <span style="color: #66cc66;">=</span> <span style="color: #008000;">False</span><span style="color: black;">)</span>
Â 
      <span style="color: #ff7700; font-weight: bold;">if</span> tmp.<span style="color: black;">empty</span>:
        excepts.<span style="color: black;">append</span><span style="color: black;">(</span>ticker<span style="color: black;">)</span> <span style="color: #808080; font-style: italic;"># tickers that no exception was raised but no data was found</span>
        <span style="color: #ff7700; font-weight: bold;">continue</span>
Â 
      <span style="color: #ff7700; font-weight: bold;">for</span> row <span style="color: #ff7700; font-weight: bold;">in</span> tmp.<span style="color: black;">itertuples</span><span style="color: black;">(</span><span style="color: black;">)</span>:
        values <span style="color: #66cc66;">=</span> <span style="color: black;">[</span>vendor<span style="color: #66cc66;">,</span> ticker_index<span style="color: black;">[</span>ticker<span style="color: black;">]</span><span style="color: black;">]</span> + <span style="color: #008000;">list</span><span style="color: black;">(</span>row<span style="color: black;">)</span>
        sql <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">"INSERT INTO price (vendor_id, ticker_id, price_date, open_price, high_price, low_price, close_price, adj_close_price, volume) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s)"</span>
        cursor.<span style="color: black;">execute</span><span style="color: black;">(</span>sql<span style="color: #66cc66;">,</span> <span style="color: #008000;">tuple</span><span style="color: black;">(</span>values<span style="color: black;">)</span><span style="color: black;">)</span>
    <span style="color: #ff7700; font-weight: bold;">except</span> <span style="color: #008000;">Exception</span> <span style="color: #ff7700; font-weight: bold;">as</span> e:
      excepts.<span style="color: black;">append</span><span style="color: black;">(</span>ticker<span style="color: black;">)</span> <span style="color: #808080; font-style: italic;"># tickers for which an exception was thrown</span>
      <span style="color: #ff7700; font-weight: bold;">continue</span>
Â 
  conn.<span style="color: black;">commit</span><span style="color: black;">(</span><span style="color: black;">)</span>
  <span style="color: #ff7700; font-weight: bold;">print</span><span style="color: black;">(</span><span style="color: #483d8b;">"|---------------| Data successfully written to database. |---------------|"</span><span style="color: black;">)</span>
  <span style="color: #ff7700; font-weight: bold;">return</span> cast_to_alpaca<span style="color: black;">(</span>excepts<span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-df1a970 elementor-widget elementor-widget-text-editor" data-id="df1a970" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Since we will be calling the <i>write_historical_prices_yf()</i> function batch-wise, similarly to when we were querying Yahoo Finance for corporate information on the tickers, the resulting excepts list will consist of several lists of excepts itself. We therefore need a function to &#8216;flatten&#8217; the list such that we can pass it to the Alpaca API:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-a76bd7d elementor-widget elementor-widget-text-editor" data-id="a76bd7d" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #ff7700; font-weight: bold;">def</span> flatten_exceptions<span style="color: black;">(</span>excepts<span style="color: black;">)</span>:
  <span style="color: #483d8b;">"""
  Flattens a list with 2 levels.
  :param excepts: list of lists to be flattened
  :return: flattened list
  """</span>
  <span style="color: #ff7700; font-weight: bold;">return</span> <span style="color: black;">[</span><span style="color: black;">[</span>item <span style="color: #ff7700; font-weight: bold;">for</span> sublist <span style="color: #ff7700; font-weight: bold;">in</span> excepts <span style="color: #ff7700; font-weight: bold;">for</span> item <span style="color: #ff7700; font-weight: bold;">in</span> sublist<span style="color: black;">]</span><span style="color: black;">]</span><span style="color: black;">[</span><span style="color: #ff4500;">0</span><span style="color: black;">]</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-3d8abb8 elementor-widget elementor-widget-text-editor" data-id="3d8abb8" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Lastly, to get pricing data for the Yahoo Finance excepts, we&#8217;ll write a very similar function that queries the Alpaca API and writes the data directly to the SMD. Since we are querying for the maximum amount of data, it doesn&#8217;t really matter which start and end dates we&#8217;re passing to the function. In a later chapter, I will talk a bit more about <a href="https://forum.alpaca.markets/t/get-barset-ignore-start-and-end-dates/2961/2">Alpaca&#8217;s peculiarities for start and end dates</a>, but for now, it suffices to query for the whole history (<i>limit = 1000</i>) of prices and manually dropping the row for the current date.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-14f0650 elementor-widget elementor-widget-text-editor" data-id="14f0650" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #ff7700; font-weight: bold;">def</span> write_historical_prices_alpaca<span style="color: black;">(</span>tickers<span style="color: #66cc66;">,</span> api<span style="color: #66cc66;">,</span> conn<span style="color: #66cc66;">,</span> cursor<span style="color: #66cc66;">,</span> start_date<span style="color: #66cc66;">,</span> end_date<span style="color: black;">)</span>:
  <span style="color: #483d8b;">"""
  Retrieves historical prices for a set of tickers from Alpaca and writes them directly to the database
  :param tickers: list of tickers for which prices should be written
  :param api: Alpaca api object
  :param conn: MySQL database connection
  :param cursor: MySQL database cursor for query execution
  :param start_date: earliest price date
  :param end_date: latest price date
  """</span>
  ticker_index <span style="color: #66cc66;">=</span> <span style="color: #008000;">dict</span><span style="color: black;">(</span>tickers.<span style="color: black;">to_dict</span><span style="color: black;">(</span><span style="color: #483d8b;">'split'</span><span style="color: black;">)</span><span style="color: black;">[</span><span style="color: #483d8b;">'data'</span><span style="color: black;">]</span><span style="color: black;">)</span>
  ticker_list <span style="color: #66cc66;">=</span> <span style="color: #008000;">list</span><span style="color: black;">(</span>ticker_index.<span style="color: black;">keys</span><span style="color: black;">(</span><span style="color: black;">)</span><span style="color: black;">)</span>
  vendor <span style="color: #66cc66;">=</span> get_vendor_id<span style="color: black;">(</span><span style="color: #483d8b;">'Alpaca'</span><span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">for</span> ticker <span style="color: #ff7700; font-weight: bold;">in</span> tqdm<span style="color: black;">(</span>ticker_list<span style="color: black;">)</span>:
    <span style="color: #ff7700; font-weight: bold;">try</span>:
      tmp <span style="color: #66cc66;">=</span> api.<span style="color: black;">get_barset</span><span style="color: black;">(</span>ticker<span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'day'</span><span style="color: #66cc66;">,</span> limit <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1000</span><span style="color: #66cc66;">,</span> start <span style="color: #66cc66;">=</span> start_date<span style="color: #66cc66;">,</span> end <span style="color: #66cc66;">=</span> end_date<span style="color: black;">)</span>.<span style="color: black;">df</span>
      tmp.<span style="color: black;">drop</span><span style="color: black;">(</span>tmp.<span style="color: black;">tail</span><span style="color: black;">(</span><span style="color: #ff4500;">1</span><span style="color: black;">)</span>.<span style="color: black;">index</span><span style="color: #66cc66;">,</span> inplace <span style="color: #66cc66;">=</span> <span style="color: #008000;">True</span><span style="color: black;">)</span> <span style="color: #808080; font-style: italic;"># drop row for 'today' as long as end_date is not working</span>
Â 
      <span style="color: #ff7700; font-weight: bold;">for</span> row <span style="color: #ff7700; font-weight: bold;">in</span> tmp.<span style="color: black;">itertuples</span><span style="color: black;">(</span><span style="color: black;">)</span>:
        values <span style="color: #66cc66;">=</span> <span style="color: black;">[</span>vendor<span style="color: #66cc66;">,</span> ticker_index<span style="color: black;">[</span>ticker<span style="color: black;">]</span><span style="color: black;">]</span> + <span style="color: #008000;">list</span><span style="color: black;">(</span>row<span style="color: black;">)</span>
        sql <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">"INSERT INTO price (vendor_id, ticker_id, price_date, open_price, high_price, low_price, close_price, volume) VALUES (%s, %s, %s, %s, %s, %s, %s, %s)"</span>
        cursor.<span style="color: black;">execute</span><span style="color: black;">(</span>sql<span style="color: #66cc66;">,</span> <span style="color: #008000;">tuple</span><span style="color: black;">(</span>values<span style="color: black;">)</span><span style="color: black;">)</span>
    <span style="color: #ff7700; font-weight: bold;">except</span> <span style="color: #008000;">Exception</span> <span style="color: #ff7700; font-weight: bold;">as</span> e:
      <span style="color: #ff7700; font-weight: bold;">continue</span>
Â 
  conn.<span style="color: black;">commit</span><span style="color: black;">(</span><span style="color: black;">)</span>
  <span style="color: #ff7700; font-weight: bold;">print</span><span style="color: black;">(</span><span style="color: #483d8b;">"|---------------| Data successfully written to database. |---------------|"</span><span style="color: black;">)</span>
  <span style="color: #ff7700; font-weight: bold;">return</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-e1c6d71 elementor-widget elementor-widget-text-editor" data-id="e1c6d71" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>To get started, let&#8217;s read in all tickers from our database by exchange:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-5404c1f elementor-widget elementor-widget-text-editor" data-id="5404c1f" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">nasdaq_tickers <span style="color: #66cc66;">=</span> ut.<span style="color: black;">get_exchange_tickers</span><span style="color: black;">(</span><span style="color: #483d8b;">'NASDAQ'</span><span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>
nyse_tickers <span style="color: #66cc66;">=</span> ut.<span style="color: black;">get_exchange_tickers</span><span style="color: black;">(</span><span style="color: #483d8b;">'NYSE'</span><span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>
amex_tickers <span style="color: #66cc66;">=</span> ut.<span style="color: black;">get_exchange_tickers</span><span style="color: black;">(</span><span style="color: #483d8b;">'AMEX'</span><span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>
arca_tickers <span style="color: #66cc66;">=</span> ut.<span style="color: black;">get_exchange_tickers</span><span style="color: black;">(</span><span style="color: #483d8b;">'ARCA'</span><span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>
bats_tickers <span style="color: #66cc66;">=</span> ut.<span style="color: black;">get_exchange_tickers</span><span style="color: black;">(</span><span style="color: #483d8b;">'BATS'</span><span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-693ff74 elementor-widget elementor-widget-heading" data-id="693ff74" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h6 class="elementor-heading-title elementor-size-small">Exemplary Process on AMEX</h6>		</div>
				</div>
				<div class="elementor-element elementor-element-2e73f2e elementor-widget elementor-widget-text-editor" data-id="2e73f2e" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>As before, I will go through the price population process in detail for the AMEX exchange.</p><p>First, we split up the dataframe of AMEX tickers (ticker and corresponding id) into several sub-dataframes of roughly equal length (max. 500) and store those in a list (<i>amex_tickers_list</i>) to iterate over. For each of those sub-dataframes, we then call the <i>write_historical_prices_yf()</i> function to download price data from Yahoo Finance for the current sub-dataframe and store its list of excepts in a temporary variable. Over the course of the loop, we append this temporary list of excepts to the <i>amex_excepts</i> list which, at the end, is flattened and then pickled to a .txt file in case we need to read in the excepts again sometime in the future.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-168e156 elementor-widget elementor-widget-text-editor" data-id="168e156" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">splits <span style="color: #66cc66;">=</span> ut.<span style="color: black;">determine_splits</span><span style="color: black;">(</span>amex_tickers<span style="color: black;">[</span><span style="color: #483d8b;">'ticker'</span><span style="color: black;">]</span>.<span style="color: black;">to_list</span><span style="color: black;">(</span><span style="color: black;">)</span><span style="color: #66cc66;">,</span> cf.<span style="color: black;">BATCH_SIZE</span><span style="color: black;">)</span>
amex_tickers_list <span style="color: #66cc66;">=</span> <span style="color: black;">[</span>amex_tickers.<span style="color: black;">loc</span><span style="color: black;">[</span>i : i + cf.<span style="color: black;">BATCH_SIZE</span> - <span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> : <span style="color: black;">]</span> <span style="color: #ff7700; font-weight: bold;">for</span> i <span style="color: #ff7700; font-weight: bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">(</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">len</span><span style="color: black;">(</span>amex_tickers<span style="color: black;">)</span><span style="color: #66cc66;">,</span> cf.<span style="color: black;">BATCH_SIZE</span><span style="color: black;">)</span><span style="color: black;">]</span>
amex_excepts <span style="color: #66cc66;">=</span> <span style="color: black;">[</span><span style="color: black;">]</span>
Â 
count <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span>
<span style="color: #ff7700; font-weight: bold;">for</span> batch <span style="color: #ff7700; font-weight: bold;">in</span> amex_tickers_list:
  <span style="color: #ff7700; font-weight: bold;">print</span><span style="color: black;">(</span><span style="color: #483d8b;">"|---------------| Split {} of {} |---------------|"</span>.<span style="color: black;">format</span><span style="color: black;">(</span>count<span style="color: #66cc66;">,</span> splits<span style="color: black;">)</span><span style="color: black;">)</span>
  tmp <span style="color: #66cc66;">=</span> ut.<span style="color: black;">write_historical_prices_yf</span><span style="color: black;">(</span>batch<span style="color: #66cc66;">,</span> conn<span style="color: #66cc66;">,</span> cursor<span style="color: #66cc66;">,</span> <span style="color: #008000;">None</span><span style="color: #66cc66;">,</span> yesterday<span style="color: black;">)</span>
  amex_excepts.<span style="color: black;">append</span><span style="color: black;">(</span>tmp<span style="color: black;">)</span>
  count +<span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span>
Â 
<span style="color: #dc143c;">pickle</span>.<span style="color: black;">dump</span><span style="color: black;">(</span>ut.<span style="color: black;">flatten_exceptions</span><span style="color: black;">(</span>amex_excepts<span style="color: black;">)</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">open</span><span style="color: black;">(</span><span style="color: #483d8b;">"data/AMEX.txt"</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">"wb"</span><span style="color: black;">)</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-45cc7f5 elementor-widget elementor-widget-image" data-id="45cc7f5" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
															<img width="552" height="595" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/AMEX-prices.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/AMEX-prices.png 552w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/AMEX-prices-278x300.png 278w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/AMEX-prices-500x539.png 500w" sizes="(max-width: 552px) 100vw, 552px" />															</div>
				</div>
				<div class="elementor-element elementor-element-a4cc2cd elementor-widget elementor-widget-text-editor" data-id="a4cc2cd" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>You might get some failed download warnings as I did above but don&#8217;t worry &#8211; our <i>amex_excepts</i> list keeps track of those tickers such that we can query the Alpaca API for their price history later.</p><p>Depending on whether you had to stop your coding session after the data download, you might want to read the exceptions back in again via:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-a7dd7f1 elementor-widget elementor-widget-text-editor" data-id="a7dd7f1" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">amex_excepts <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">pickle</span>.<span style="color: black;">load</span><span style="color: black;">(</span><span style="color: #008000;">open</span><span style="color: black;">(</span><span style="color: #483d8b;">"data/AMEX.txt"</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">"rb"</span><span style="color: black;">)</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-77f7471 elementor-widget elementor-widget-text-editor" data-id="77f7471" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: black;">[</span><span style="color: #483d8b;">'ADRA.U'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'ARMP'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'BTTR'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'CEI'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'GLTA.U'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'PHGE.U'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'VHAQ.RT'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'VHAQ.U'</span><span style="color: black;">]</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-5c91a25 elementor-widget elementor-widget-text-editor" data-id="5c91a25" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>We iterate over this list of tickers to populate the <i>amex_alpaca</i> dataframe with their tickers and ids and finally call the <i>write_historical_prices_alpaca()</i> function to download their price history from the Alpaca API.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-95cb3e4 elementor-widget elementor-widget-text-editor" data-id="95cb3e4" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">amex_alpaca <span style="color: #66cc66;">=</span> pd.<span style="color: black;">DataFrame</span><span style="color: black;">(</span><span style="color: black;">)</span>
<span style="color: #ff7700; font-weight: bold;">for</span> ticker <span style="color: #ff7700; font-weight: bold;">in</span> amex_excepts:
  amex_alpaca <span style="color: #66cc66;">=</span> amex_alpaca.<span style="color: black;">append</span><span style="color: black;">(</span>amex_tickers<span style="color: black;">[</span>amex_tickers<span style="color: black;">[</span><span style="color: #483d8b;">'ticker'</span><span style="color: black;">]</span> <span style="color: #66cc66;">==</span> ticker<span style="color: black;">]</span><span style="color: black;">)</span>
ut.<span style="color: black;">write_historical_prices_alpaca</span><span style="color: black;">(</span>amex_alpaca<span style="color: #66cc66;">,</span> api<span style="color: #66cc66;">,</span> conn<span style="color: #66cc66;">,</span> cursor<span style="color: #66cc66;">,</span> <span style="color: #008000;">None</span><span style="color: #66cc66;">,</span> yesterday<span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-d75bc08 elementor-widget elementor-widget-image" data-id="d75bc08" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
															<img width="552" height="85" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/AMEX-alpaca.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/AMEX-alpaca.png 552w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/AMEX-alpaca-300x46.png 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/AMEX-alpaca-500x77.png 500w" sizes="(max-width: 552px) 100vw, 552px" />															</div>
				</div>
				<div class="elementor-element elementor-element-2dceae4 elementor-widget elementor-widget-heading" data-id="2dceae4" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h6 class="elementor-heading-title elementor-size-small">Rinse &amp; Repeat with the other exchanges</h6>		</div>
				</div>
				<div class="elementor-element elementor-element-901f3c9 elementor-widget elementor-widget-text-editor" data-id="901f3c9" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p><span style="text-align: justify;">Repeat the process described above for every other exchange. Luckily, populating the prices takes just a fraction of the time needed for downloading corporate information. For me, it took a bit more than 3 hours in total.</span></p>
<p><span style="text-align: justify;">As a result, our price table now holds close to 30 Mio. rows of historical price data for every ticker in the database! For 97% of those tickers, pricing history goes back as far as possible thanks to Yahoo Finance&#8217;s insane data pool, and for the remaining 3%, we got at least four years of data from the Alpaca API.</span></p><p><span style="text-align: justify;">With that, we finally have a first, working version of a Securities Master Database! Hooray!</span></p>						</div>
				</div>
				<div class="elementor-element elementor-element-e7edb4b elementor-widget elementor-widget-image" data-id="e7edb4b" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
												<figure class="wp-caption">
										<img width="866" height="643" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-10.48.56.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-10.48.56.png 866w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-10.48.56-300x223.png 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-10.48.56-768x570.png 768w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-10.48.56-500x371.png 500w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-10.48.56-800x594.png 800w" sizes="(max-width: 866px) 100vw, 866px" />											<figcaption class="widget-image-caption wp-caption-text">MySQL Workbench view of the price table.</figcaption>
										</figure>
									</div>
				</div>
					</div>
		</div>
							</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-60c5b4b elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="60c5b4b" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-a63f8f2" data-id="a63f8f2" data-element_type="column">
			<div class="elementor-widget-wrap elementor-element-populated">
								<div class="elementor-element elementor-element-d14b862 elementor-widget elementor-widget-heading" data-id="d14b862" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-default">5. Updating the SMD</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-fc8d63f elementor-widget elementor-widget-text-editor" data-id="fc8d63f" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>With all of the above taken care of, there is only one thing left to implement: an update mechanism. Companies get IPO-ed regularly, and new, exiting ETFs get launched all the time. But the opposite is also true, with tickers getting delisted, either for insolvency or M&amp;A activity. And as we&#8217;ve recently seen with Facebook&#8217;s rebranding to Meta, even companies&#8217; names are not safe from change. Also, given that we have around 10,000 tickers in our <b>instrument</b> table, we can expect to get 10,000 rows of new price data every single weekday!</p><p>Since we want our SMD to be an always-up-to date data source, we need to make sure to update it regularly. For now, we&#8217;ll write an <i>update.py</i> script that we need to execute manually to check for newly listed tickers, get corporate information for them, load their entire price history, preferably from Yahoo Finance, and add new price rows for the existing tickers. In the future, I&#8217;m planning on automating this process via a <a href="https://en.wikipedia.org/wiki/Cron">cronjob</a> &#8211; but it only makes sense to do so once the database is not hosted locally on my Mac anymore, but either on a cloud service such as <a href="https://aws.amazon.com/?aws-products-analytics.sort-by=item.additionalFields.productNameLowercase&amp;aws-products-analytics.sort-order=asc&amp;aws-products-business-apps.sort-by=item.additionalFields.productNameLowercase&amp;aws-products-business-apps.sort-order=asc&amp;aws-products-containers.sort-by=item.additionalFields.productNameLowercase&amp;aws-products-containers.sort-order=asc&amp;aws-products-compute.sort-by=item.additionalFields.productNameLowercase&amp;aws-products-compute.sort-order=asc&amp;aws-products-databases.sort-by=item.additionalFields.productNameLowercase&amp;aws-products-databases.sort-order=asc&amp;aws-products-iot.sort-by=item.additionalFields.productNameLowercase&amp;aws-products-iot.sort-order=asc&amp;aws-products-ml.sort-by=item.additionalFields.productNameLowercase&amp;aws-products-ml.sort-order=asc&amp;aws-products-mgmt-govern.sort-by=item.additionalFields.productNameLowercase&amp;aws-products-mgmt-govern.sort-order=asc&amp;aws-products-migration.sort-by=item.additionalFields.productNameLowercase&amp;aws-products-migration.sort-order=asc&amp;aws-products-network.sort-by=item.additionalFields.productNameLowercase&amp;aws-products-network.sort-order=asc&amp;aws-products-security.sort-by=item.additionalFields.productNameLowercase&amp;aws-products-security.sort-order=asc&amp;aws-products-storage.sort-by=item.additionalFields.productNameLowercase&amp;aws-products-storage.sort-order=asc">AWS</a>,Â <a href="https://www.linode.com/">Linode</a> or <a href="https://www.digitalocean.com/">Digital Ocean</a>, or even better on a personal, always-on Raspberry Pi Server.</p><p>I&#8217;m also thinking about writing a <i>cleanup.py</i> script to run on weekends that identifies and deletes data for those tickers that have been delisted or are nothing more than <a href="https://en.wikipedia.org/wiki/Special-purpose_acquisition_company">SPACs</a>, and alters instrument records where name changes have occurred. But since this functionality is more icing on the cake than anything else, I&#8217;ll skip it for now and add it to the ever-expanding backlog of possible SMD upgrades (I&#8217;m looking at you, Chapter <i>7. Open Issues</i>).</p>						</div>
				</div>
				<div class="elementor-element elementor-element-312debd elementor-widget elementor-widget-text-editor" data-id="312debd" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Before we actually get going, let&#8217;s create an <i>update.py</i> file, import what we&#8217;ll need and connect to the endpoints:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-83e8727 elementor-widget elementor-widget-text-editor" data-id="83e8727" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #808080; font-style: italic;"># Imports</span>
<span style="color: #ff7700; font-weight: bold;">import</span> config <span style="color: #ff7700; font-weight: bold;">as</span> cf
<span style="color: #ff7700; font-weight: bold;">import</span> utils <span style="color: #ff7700; font-weight: bold;">as</span> ut
Â 
<span style="color: #ff7700; font-weight: bold;">import</span> numpy <span style="color: #ff7700; font-weight: bold;">as</span> np
<span style="color: #ff7700; font-weight: bold;">import</span> pandas <span style="color: #ff7700; font-weight: bold;">as</span> pd
pd.<span style="color: black;">options</span>.<span style="color: black;">mode</span>.<span style="color: black;">chained_assignment</span> <span style="color: #66cc66;">=</span> <span style="color: #008000;">None</span>  <span style="color: #808080; font-style: italic;"># default = 'warn'</span>
Â 
<span style="color: #ff7700; font-weight: bold;">import</span> <span style="color: #dc143c;">time</span> <span style="color: #808080; font-style: italic;"># optional: if you want to use some time.sleep() statements for better output readability</span>
Â 
Â 
<span style="color: #808080; font-style: italic;"># Connections</span>
conn <span style="color: #66cc66;">=</span> ut.<span style="color: black;">connect_db</span><span style="color: black;">(</span><span style="color: black;">)</span>
cursor <span style="color: #66cc66;">=</span> conn.<span style="color: black;">cursor</span><span style="color: black;">(</span><span style="color: black;">)</span>
api <span style="color: #66cc66;">=</span> ut.<span style="color: black;">connect_api</span><span style="color: black;">(</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-8d6cadf elementor-widget elementor-widget-heading" data-id="8d6cadf" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-medium">5.1. New Instruments</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-246e22f elementor-widget elementor-widget-text-editor" data-id="246e22f" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>In this first part of the <i>update.py</i> script, we&#8217;ll check for tickers that have been newly added to the Alpaca API and try to download additional corporate information from Yahoo Finance for as many as possible of them. After adding these to the <b>instrument</b> table, we&#8217;ll download their entire price history via Yahoo Finance, collect those tickers that return an empty dataframe or throw an exception and query the Alpaca API for them, just as when we were initializing the SMD in the first place.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-2771173 elementor-widget elementor-widget-heading" data-id="2771173" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-small">5.1.1. Adding New Instruments</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-dd8a395 elementor-widget elementor-widget-text-editor" data-id="dd8a395" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p><span style="text-align: justify;">As before, let&#8217;s put as much functionality as possible into someÂ </span><i style="text-align: justify;">utils.py</i><span style="text-align: justify;">Â functions. First, we need to query the SMD for every contained ticker and return the result as a list (</span><i style="text-align: justify;">get_all_tickers()</i><span style="text-align: justify;">). Second, we need to compare those tickers against the current universe of active and tradable assets from Alpaca, identify the tickers that we don&#8217;t already have in the database and write them with their corresponding exchange and name into a dataframe for further usage (</span><i style="text-align: justify;">get_new_tickers()</i><span style="text-align: justify;">). This function also makes sure that we only consider new instruments from exchanges that are already in our database (remember, we left out the OTC market for instance), and hence needs theÂ </span><i style="text-align: justify;">get_all_exchanges()</i><span style="text-align: justify;">Â function. Finally, we write another functionÂ </span><i style="text-align: justify;">get_yesterday()</i><span style="text-align: justify;">Â that gives back yesterday&#8217;s date in datetime format, or, if yesterday would be either Sunday or Saturday where no new prices get published anyways, the date of the last past weekday (= Friday).</span></p>						</div>
				</div>
				<div class="elementor-element elementor-element-c8e52aa elementor-widget elementor-widget-text-editor" data-id="c8e52aa" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #ff7700; font-weight: bold;">def</span> get_all_exchanges<span style="color: black;">(</span>conn<span style="color: black;">)</span>:
  <span style="color: #483d8b;">"""
  Queries the database for every existing exchange and returns their acronym as a list
  :param conn: MySQL database connection
  :return: list of all exchange acronyms
  """</span>
  <span style="color: #ff7700; font-weight: bold;">return</span> pd.<span style="color: black;">read_sql</span><span style="color: black;">(</span><span style="color: #483d8b;">'SELECT acronym FROM exchange'</span><span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span><span style="color: black;">[</span><span style="color: #483d8b;">'acronym'</span><span style="color: black;">]</span>.<span style="color: black;">to_list</span><span style="color: black;">(</span><span style="color: black;">)</span>
Â 
Â 
<span style="color: #ff7700; font-weight: bold;">def</span> get_all_tickers<span style="color: black;">(</span>conn<span style="color: black;">)</span>:
  <span style="color: #483d8b;">"""
  Queries the database for every existing ticker and returns them as a list
  :param conn: MySQL database connection
  :return: list of all tickers
  """</span>
  <span style="color: #ff7700; font-weight: bold;">return</span> pd.<span style="color: black;">read_sql</span><span style="color: black;">(</span><span style="color: #483d8b;">'SELECT ticker FROM instrument'</span><span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span><span style="color: black;">[</span><span style="color: #483d8b;">'ticker'</span><span style="color: black;">]</span>.<span style="color: black;">to_list</span><span style="color: black;">(</span><span style="color: black;">)</span>
Â 
Â 
<span style="color: #ff7700; font-weight: bold;">def</span> get_new_tickers<span style="color: black;">(</span>assets<span style="color: #66cc66;">,</span> tickers<span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>:
  <span style="color: #483d8b;">"""
  Compares an asset universe from the Alpaca API against a list of tickers and returns a dataframe of new tickers to be added to the database
  :param assets: list of asset objects to be queried
  :param tickers: list of tickers to compare against
  :param conn: MySQL database connection
  :return: dataframe of all newly identified tickers with their corresponding exchange, symbol and name
  """</span>
  new_tickers_df <span style="color: #66cc66;">=</span> pd.<span style="color: black;">DataFrame</span><span style="color: black;">(</span><span style="color: black;">)</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">for</span> asset <span style="color: #ff7700; font-weight: bold;">in</span> assets:
    <span style="color: #ff7700; font-weight: bold;">try</span>:
      <span style="color: #ff7700; font-weight: bold;">if</span> asset.<span style="color: black;">status</span> <span style="color: #66cc66;">==</span> <span style="color: #483d8b;">'active'</span> <span style="color: #ff7700; font-weight: bold;">and</span> asset.<span style="color: black;">tradable</span> <span style="color: #ff7700; font-weight: bold;">and</span> asset.<span style="color: black;">exchange</span> <span style="color: #ff7700; font-weight: bold;">in</span> get_all_exchanges<span style="color: black;">(</span>conn<span style="color: black;">)</span> <span style="color: #ff7700; font-weight: bold;">and</span> asset.<span style="color: #dc143c;">symbol</span> <span style="color: #ff7700; font-weight: bold;">not</span> <span style="color: #ff7700; font-weight: bold;">in</span> tickers:
        data <span style="color: #66cc66;">=</span> <span style="color: black;">[</span><span style="color: black;">]</span>
        data.<span style="color: black;">append</span><span style="color: black;">(</span><span style="color: black;">[</span>asset.<span style="color: black;">exchange</span><span style="color: #66cc66;">,</span> asset.<span style="color: #dc143c;">symbol</span><span style="color: #66cc66;">,</span> asset.<span style="color: black;">name</span><span style="color: black;">]</span><span style="color: black;">)</span>
Â 
        tmp <span style="color: #66cc66;">=</span> pd.<span style="color: black;">DataFrame</span><span style="color: black;">(</span>data<span style="color: #66cc66;">,</span> columns <span style="color: #66cc66;">=</span> <span style="color: black;">[</span><span style="color: #483d8b;">'exchange_id'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'ticker'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'name'</span><span style="color: black;">]</span><span style="color: black;">)</span>
        new_tickers_df <span style="color: #66cc66;">=</span> new_tickers_df.<span style="color: black;">append</span><span style="color: black;">(</span>tmp<span style="color: #66cc66;">,</span> ignore_index <span style="color: #66cc66;">=</span> <span style="color: #008000;">True</span><span style="color: black;">)</span>
        <span style="color: #ff7700; font-weight: bold;">print</span><span style="color: black;">(</span><span style="color: #483d8b;">'Identified a new instrument: {}, {} ({})'</span>.<span style="color: black;">format</span><span style="color: black;">(</span>asset.<span style="color: #dc143c;">symbol</span><span style="color: #66cc66;">,</span> asset.<span style="color: black;">name</span><span style="color: #66cc66;">,</span> asset.<span style="color: black;">exchange</span><span style="color: black;">)</span><span style="color: black;">)</span>
    <span style="color: #ff7700; font-weight: bold;">except</span> <span style="color: #008000;">Exception</span> <span style="color: #ff7700; font-weight: bold;">as</span> e:
      <span style="color: #ff7700; font-weight: bold;">continue</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">return</span> new_tickers_df
Â 
Â 
<span style="color: #ff7700; font-weight: bold;">def</span> get_yesterday<span style="color: black;">(</span><span style="color: black;">)</span>:
  <span style="color: #483d8b;">"""
  Determines 'yesterday', i.e. the last past weekday to today's date
  :return: 'yesterday' in datetime format
  """</span>
  today <span style="color: #66cc66;">=</span> <span style="color: #dc143c;">datetime</span>.<span style="color: black;">date</span>.<span style="color: black;">today</span><span style="color: black;">(</span><span style="color: black;">)</span>
  yesterday <span style="color: #66cc66;">=</span> today - <span style="color: #dc143c;">datetime</span>.<span style="color: black;">timedelta</span><span style="color: black;">(</span>days <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span><span style="color: black;">)</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">if</span> yesterday.<span style="color: black;">weekday</span><span style="color: black;">(</span><span style="color: black;">)</span> <span style="color: #66cc66;">==</span> <span style="color: #ff4500;">5</span>:
    <span style="color: #808080; font-style: italic;"># yesterday was Saturday -&gt; go back to Friday</span>
    yesterday -<span style="color: #66cc66;">=</span> <span style="color: #dc143c;">datetime</span>.<span style="color: black;">timedelta</span><span style="color: black;">(</span>days <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span><span style="color: black;">)</span>
  <span style="color: #ff7700; font-weight: bold;">elif</span> yesterday.<span style="color: black;">weekday</span><span style="color: black;">(</span><span style="color: black;">)</span> <span style="color: #66cc66;">==</span> <span style="color: #ff4500;">6</span>:
    <span style="color: #808080; font-style: italic;"># yesterday was Sunday -&gt; go back to Friday</span>
    yesterday -<span style="color: #66cc66;">=</span> <span style="color: #dc143c;">datetime</span>.<span style="color: black;">timedelta</span><span style="color: black;">(</span>days <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">2</span><span style="color: black;">)</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">return</span> yesterday</pre>						</div>
				</div>
				<div class="elementor-element elementor-element-74bfc25 elementor-widget elementor-widget-text-editor" data-id="74bfc25" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>With these new functions, we can start off the <i>update.py</i> script as follows:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-e240725 elementor-widget elementor-widget-text-editor" data-id="e240725" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">assets <span style="color: #66cc66;">=</span> api.<span style="color: black;">list_assets</span><span style="color: black;">(</span><span style="color: black;">)</span>
tickers <span style="color: #66cc66;">=</span> ut.<span style="color: black;">get_all_tickers</span><span style="color: black;">(</span>conn<span style="color: black;">)</span>
yesterday <span style="color: #66cc66;">=</span> <span style="color: #008000;">str</span><span style="color: black;">(</span>ut.<span style="color: black;">get_yesterday</span><span style="color: black;">(</span><span style="color: black;">)</span><span style="color: black;">)</span>
new_tickers_alpaca <span style="color: #66cc66;">=</span> ut.<span style="color: black;">get_new_tickers</span><span style="color: black;">(</span>assets<span style="color: #66cc66;">,</span> tickers<span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-585e1bc elementor-widget elementor-widget-text-editor" data-id="585e1bc" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>You could imagine the <i>new_tickers_alpaca</i> dataframe to look something like this, given that new instruments have been identified:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-3c5bc7d elementor-widget elementor-widget-image" data-id="3c5bc7d" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
												<figure class="wp-caption">
										<img width="512" height="284" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-11.44.21.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-11.44.21.png 512w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-11.44.21-300x166.png 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-11.44.21-500x277.png 500w" sizes="(max-width: 512px) 100vw, 512px" />											<figcaption class="widget-image-caption wp-caption-text">Exemplary newly identified tickers for a test database consisting only of AMEX instruments.</figcaption>
										</figure>
									</div>
				</div>
				<div class="elementor-element elementor-element-7936292 elementor-widget elementor-widget-text-editor" data-id="7936292" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>If no new tickers can be identified, our SMD is already up-to-date and we can directly skip to the next sub-chapter. If not, we need to transform the <i>new_tickers_alpaca</i> dataframe a bit and later merge it with the <i>new_tickers_info</i> dataframe that holds additional corporate information from Yahoo Finance.</p><p>So far, the <i>exchange_id</i> column of the <i>new_tickers_alpaca</i> dataframe holds the <i>acronyms</i> of the new instruments&#8217; exchanges. Let&#8217;s switch those out with the correct ids from the SMD:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-ce09364 elementor-widget elementor-widget-text-editor" data-id="ce09364" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #ff7700; font-weight: bold;">if</span> new_tickers_alpaca.<span style="color: black;">empty</span>:
  new_tickers <span style="color: #66cc66;">=</span> <span style="color: black;">[</span><span style="color: black;">]</span> <span style="color: #808080; font-style: italic;"># no new tickers</span>
<span style="color: #ff7700; font-weight: bold;">else</span>:
  exchanges <span style="color: #66cc66;">=</span> new_tickers_alpaca<span style="color: black;">[</span><span style="color: #483d8b;">'exchange_id'</span><span style="color: black;">]</span>.<span style="color: black;">to_list</span><span style="color: black;">(</span><span style="color: black;">)</span>
Â 
  tmp <span style="color: #66cc66;">=</span> <span style="color: black;">[</span><span style="color: black;">]</span>
  <span style="color: #ff7700; font-weight: bold;">for</span> exchange <span style="color: #ff7700; font-weight: bold;">in</span> exchanges:
    tmp.<span style="color: black;">append</span><span style="color: black;">(</span>ut.<span style="color: black;">get_exchange_id</span><span style="color: black;">(</span>exchange<span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span><span style="color: black;">)</span>
Â 
  new_tickers_alpaca.<span style="color: black;">drop</span><span style="color: black;">(</span><span style="color: #483d8b;">'exchange_id'</span><span style="color: #66cc66;">,</span> axis <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> inplace <span style="color: #66cc66;">=</span> <span style="color: #008000;">True</span><span style="color: black;">)</span>
  new_tickers_alpaca.<span style="color: black;">insert</span><span style="color: black;">(</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'exchange_id'</span><span style="color: #66cc66;">,</span> tmp<span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-8dd15ff elementor-widget elementor-widget-image" data-id="8dd15ff" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
												<figure class="wp-caption">
										<img width="512" height="287" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-11.50.01.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-11.50.01.png 512w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-11.50.01-300x168.png 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-11.50.01-500x280.png 500w" sizes="(max-width: 512px) 100vw, 512px" />											<figcaption class="widget-image-caption wp-caption-text">Exemplary newly identified tickers with correct exchange_id column.</figcaption>
										</figure>
									</div>
				</div>
				<div class="elementor-element elementor-element-34621b8 elementor-widget elementor-widget-text-editor" data-id="34621b8" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>The remaining process is now very similar to the initial price population. First, cast all the tickers of the <i>new_tickers_alpaca</i> dataframe to Yahoo Finance format, then split this list into several sublists (probably not needed since there will hardly be more than 500 newly identified tickers) and iterate over each of them to download corporate information from Yahoo Finance. Then, transform the resulting <i>new_tickers_info</i> dataframe to suit the database schema, recast the tickers to Alpaca format and merge it with the <i>new_tickers_alpaca</i> dataframe. After replacing all <i>NaN</i> values with <i>None</i>, we can add the new instruments to the database:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-c6d7586 elementor-widget elementor-widget-text-editor" data-id="c6d7586" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">  <span style="color: #808080; font-style: italic;"># still within the else clause</span>
  new_tickers <span style="color: #66cc66;">=</span> <span style="color: #008000;">sorted</span><span style="color: black;">(</span>ut.<span style="color: black;">cast_to_yf</span><span style="color: black;">(</span>new_tickers_alpaca<span style="color: black;">[</span><span style="color: #483d8b;">'ticker'</span><span style="color: black;">]</span>.<span style="color: black;">to_list</span><span style="color: black;">(</span><span style="color: black;">)</span><span style="color: black;">)</span><span style="color: black;">)</span> <span style="color: #808080; font-style: italic;"># cast tickers to YF format</span>
Â 
  <span style="color: #808080; font-style: italic;"># Starting Corporate Information download from Yahoo Finance</span>
  splits <span style="color: #66cc66;">=</span> ut.<span style="color: black;">determine_splits</span><span style="color: black;">(</span>new_tickers<span style="color: #66cc66;">,</span> cf.<span style="color: black;">BATCH_SIZE</span><span style="color: black;">)</span>
  split_arr <span style="color: #66cc66;">=</span> np.<span style="color: black;">array_split</span><span style="color: black;">(</span>new_tickers<span style="color: #66cc66;">,</span> splits<span style="color: black;">)</span>
  new_tickers_info <span style="color: #66cc66;">=</span> pd.<span style="color: black;">DataFrame</span><span style="color: black;">(</span><span style="color: black;">)</span>
Â 
  count <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span>
  <span style="color: #ff7700; font-weight: bold;">for</span> <span style="color: #dc143c;">array</span> <span style="color: #ff7700; font-weight: bold;">in</span> split_arr:
    <span style="color: #ff7700; font-weight: bold;">print</span><span style="color: black;">(</span><span style="color: #483d8b;">"|---------------| Split {} of {} |---------------|"</span>.<span style="color: black;">format</span><span style="color: black;">(</span>count<span style="color: #66cc66;">,</span> splits<span style="color: black;">)</span><span style="color: black;">)</span>
    tmp <span style="color: #66cc66;">=</span> ut.<span style="color: black;">get_corporate_info</span><span style="color: black;">(</span><span style="color: #dc143c;">array</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">25</span><span style="color: #66cc66;">,</span> cf.<span style="color: black;">KOI</span><span style="color: black;">)</span>
    new_tickers_info <span style="color: #66cc66;">=</span> new_tickers_info.<span style="color: black;">append</span><span style="color: black;">(</span>tmp<span style="color: black;">)</span>
    count +<span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span>
Â 
  new_tickers <span style="color: #66cc66;">=</span> ut.<span style="color: black;">cast_to_alpaca</span><span style="color: black;">(</span>new_tickers<span style="color: black;">)</span>
  tmp <span style="color: #66cc66;">=</span> ut.<span style="color: black;">cast_to_alpaca</span><span style="color: black;">(</span>new_tickers_info<span style="color: black;">[</span><span style="color: #483d8b;">'symbol'</span><span style="color: black;">]</span>.<span style="color: black;">tolist</span><span style="color: black;">(</span><span style="color: black;">)</span><span style="color: black;">)</span> <span style="color: #808080; font-style: italic;"># cast tickers back to Alpaca format</span>
  new_tickers_info.<span style="color: black;">drop</span><span style="color: black;">(</span><span style="color: #483d8b;">'symbol'</span><span style="color: #66cc66;">,</span> axis <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> inplace <span style="color: #66cc66;">=</span> <span style="color: #008000;">True</span><span style="color: black;">)</span>
  new_tickers_info.<span style="color: black;">insert</span><span style="color: black;">(</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'ticker'</span><span style="color: #66cc66;">,</span> tmp<span style="color: black;">)</span>
Â 
  new_tickers_df <span style="color: #66cc66;">=</span> pd.<span style="color: black;">merge</span><span style="color: black;">(</span>new_tickers_alpaca<span style="color: #66cc66;">,</span> new_tickers_info<span style="color: #66cc66;">,</span> on <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'ticker'</span><span style="color: #66cc66;">,</span> how <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'outer'</span><span style="color: black;">)</span>
  new_tickers_df <span style="color: #66cc66;">=</span> new_tickers_df.<span style="color: black;">sort_values</span><span style="color: black;">(</span>by <span style="color: #66cc66;">=</span> <span style="color: black;">[</span><span style="color: #483d8b;">'ticker'</span><span style="color: black;">]</span><span style="color: black;">)</span>
  new_tickers_df <span style="color: #66cc66;">=</span> new_tickers_df.<span style="color: black;">replace</span><span style="color: black;">(</span><span style="color: black;">{</span>np.<span style="color: black;">nan</span>: <span style="color: #008000;">None</span><span style="color: black;">}</span><span style="color: black;">)</span>
Â 
 <span style="color: #808080; font-style: italic;"># Writing to database</span>
  <span style="color: #ff7700; font-weight: bold;">for</span> row <span style="color: #ff7700; font-weight: bold;">in</span> new_tickers_df.<span style="color: black;">itertuples</span><span style="color: black;">(</span>index <span style="color: #66cc66;">=</span> <span style="color: #008000;">False</span><span style="color: black;">)</span>:
    cursor.<span style="color: black;">execute</span><span style="color: black;">(</span><span style="color: #483d8b;">"INSERT INTO instrument (exchange_id, ticker, name, sector, industry, country, website) VALUES (%s, %s, %s, %s, %s, %s, %s)"</span><span style="color: #66cc66;">,</span> row<span style="color: black;">)</span>
  conn.<span style="color: black;">commit</span><span style="color: black;">(</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-3999d25 elementor-widget elementor-widget-image" data-id="3999d25" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
												<figure class="wp-caption">
										<img width="1024" height="240" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-12.13.41-1024x240.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-12.13.41-1024x240.png 1024w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-12.13.41-300x70.png 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-12.13.41-768x180.png 768w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-12.13.41-500x117.png 500w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-12.13.41-800x188.png 800w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-12.13.41.png 1223w" sizes="(max-width: 1024px) 100vw, 1024px" />											<figcaption class="widget-image-caption wp-caption-text">Exemplary new_tickers_df dataframe to be added to database.</figcaption>
										</figure>
									</div>
				</div>
				<div class="elementor-element elementor-element-69ab449 elementor-widget elementor-widget-text-editor" data-id="69ab449" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>In my case, updating the SMD six days after its initial population already yielded 42 new instruments for 16 of which the Yahoo Finance detour was able to pull additional corporate information. Notice how the <i>ids</i> seamlessly increased thanks to the <i>AUTO_INCREMENT</i> constraint in the table schema. Also, the <i>created_date</i> now allows us to easily select those new entries, if need be (<i>SELECT * FROM instrument WHERE created_date &gt; &#8216;2021-12-05 00:00:00&#8217;;</i>).</p>						</div>
				</div>
				<div class="elementor-element elementor-element-2b19530 elementor-widget elementor-widget-image" data-id="2b19530" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
												<figure class="wp-caption">
										<img width="1024" height="751" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-12.15.27-1024x751.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-12.15.27-1024x751.png 1024w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-12.15.27-300x220.png 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-12.15.27-768x563.png 768w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-12.15.27-500x366.png 500w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-12.15.27-800x586.png 800w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-12.15.27.png 1112w" sizes="(max-width: 1024px) 100vw, 1024px" />											<figcaption class="widget-image-caption wp-caption-text">MySQL Workbench view of the updated instrument table.</figcaption>
										</figure>
									</div>
				</div>
				<div class="elementor-element elementor-element-8de762e elementor-widget elementor-widget-heading" data-id="8de762e" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-small">5.1.2. Downloading Price Histories</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-144dbd7 elementor-widget elementor-widget-text-editor" data-id="144dbd7" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Downloading the price histories of the newly added tickers is exactly the same as during the initialization phase, we just need to read in these new tickers with their corresponding <i>ids</i> from the database first.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-ff5a83b elementor-widget elementor-widget-text-editor" data-id="ff5a83b" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #ff7700; font-weight: bold;">def</span> get_tickers_from_list<span style="color: black;">(</span>tickers<span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>:
  <span style="color: #483d8b;">"""
  Queries the database for a given list of tickers and returns a dataframe of their symbols and ids
  :param tickers: list of tickers to be queried for
  :conn: MySQL database connection
  :return: dataframe of tickers and ids
  """</span>
  ticker_df <span style="color: #66cc66;">=</span> pd.<span style="color: black;">DataFrame</span><span style="color: black;">(</span><span style="color: black;">)</span>
  <span style="color: #ff7700; font-weight: bold;">for</span> ticker <span style="color: #ff7700; font-weight: bold;">in</span> tickers:
    <span style="color: #ff7700; font-weight: bold;">try</span>:
      tmp <span style="color: #66cc66;">=</span> pd.<span style="color: black;">read_sql</span><span style="color: black;">(</span><span style="color: #483d8b;">"SELECT ticker, id FROM instrument WHERE ticker = '{}'"</span>.<span style="color: black;">format</span><span style="color: black;">(</span>ticker<span style="color: black;">)</span><span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>
      ticker_df <span style="color: #66cc66;">=</span> ticker_df.<span style="color: black;">append</span><span style="color: black;">(</span>tmp<span style="color: #66cc66;">,</span> ignore_index <span style="color: #66cc66;">=</span> <span style="color: #008000;">True</span><span style="color: black;">)</span>
    <span style="color: #ff7700; font-weight: bold;">except</span> <span style="color: #008000;">Exception</span> <span style="color: #ff7700; font-weight: bold;">as</span> e:
      <span style="color: #ff7700; font-weight: bold;">continue</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">return</span> ticker_df</pre>						</div>
				</div>
				<div class="elementor-element elementor-element-57ee938 elementor-widget elementor-widget-text-editor" data-id="57ee938" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">  <span style="color: #808080; font-style: italic;"># still within the else clause</span>
  new_tickers_df <span style="color: #66cc66;">=</span> ut.<span style="color: black;">get_tickers_from_list</span><span style="color: black;">(</span>new_tickers<span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span> <span style="color: #808080; font-style: italic;"># read in new tickers with their ids</span>
Â 
  <span style="color: #808080; font-style: italic;"># Starting Price download from Yahoo Finance</span>
  splits <span style="color: #66cc66;">=</span> ut.<span style="color: black;">determine_splits</span><span style="color: black;">(</span>new_tickers<span style="color: #66cc66;">,</span> cf.<span style="color: black;">BATCH_SIZE</span><span style="color: black;">)</span>
  new_tickers_list <span style="color: #66cc66;">=</span> <span style="color: black;">[</span>new_tickers_df.<span style="color: black;">loc</span><span style="color: black;">[</span>i : i + cf.<span style="color: black;">BATCH_SIZE</span> - <span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> : <span style="color: black;">]</span> <span style="color: #ff7700; font-weight: bold;">for</span> i <span style="color: #ff7700; font-weight: bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">(</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">len</span><span style="color: black;">(</span>new_tickers_df<span style="color: black;">)</span><span style="color: #66cc66;">,</span> cf.<span style="color: black;">BATCH_SIZE</span><span style="color: black;">)</span><span style="color: black;">]</span>
  new_excepts <span style="color: #66cc66;">=</span> <span style="color: black;">[</span><span style="color: black;">]</span>
Â 
  count <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span>
  <span style="color: #ff7700; font-weight: bold;">for</span> batch <span style="color: #ff7700; font-weight: bold;">in</span> new_tickers_list:
    <span style="color: #ff7700; font-weight: bold;">print</span><span style="color: black;">(</span><span style="color: #483d8b;">"|---------------| Split {} of {} |---------------|"</span>.<span style="color: black;">format</span><span style="color: black;">(</span>count<span style="color: #66cc66;">,</span> splits<span style="color: black;">)</span><span style="color: black;">)</span>
    tmp <span style="color: #66cc66;">=</span> ut.<span style="color: black;">write_historical_prices_yf</span><span style="color: black;">(</span>batch<span style="color: #66cc66;">,</span> conn<span style="color: #66cc66;">,</span> cursor<span style="color: #66cc66;">,</span> <span style="color: #008000;">None</span><span style="color: #66cc66;">,</span> yesterday<span style="color: black;">)</span>
    new_excepts.<span style="color: black;">append</span><span style="color: black;">(</span>tmp<span style="color: black;">)</span>
    count +<span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span>
Â 
  new_excepts <span style="color: #66cc66;">=</span> ut.<span style="color: black;">flatten_exceptions</span><span style="color: black;">(</span>new_excepts<span style="color: black;">)</span>
  new_alpaca <span style="color: #66cc66;">=</span> pd.<span style="color: black;">DataFrame</span><span style="color: black;">(</span><span style="color: black;">)</span>
Â 
  <span style="color: #808080; font-style: italic;"># Starting Price download from Alpaca</span>
  <span style="color: #ff7700; font-weight: bold;">for</span> ticker <span style="color: #ff7700; font-weight: bold;">in</span> new_excepts:
    new_alpaca <span style="color: #66cc66;">=</span> new_alpaca.<span style="color: black;">append</span><span style="color: black;">(</span>new_tickers_df<span style="color: black;">[</span>new_tickers_df<span style="color: black;">[</span><span style="color: #483d8b;">'ticker'</span><span style="color: black;">]</span> <span style="color: #66cc66;">==</span> ticker<span style="color: black;">]</span><span style="color: black;">)</span>
  ut.<span style="color: black;">write_historical_prices_alpaca</span><span style="color: black;">(</span>new_alpaca<span style="color: #66cc66;">,</span> api<span style="color: #66cc66;">,</span> conn<span style="color: #66cc66;">,</span> cursor<span style="color: #66cc66;">,</span> <span style="color: #008000;">None</span><span style="color: #66cc66;">,</span> yesterday<span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-0d03b3a elementor-widget elementor-widget-text-editor" data-id="0d03b3a" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>One of my newly added tickers was YUMY, the <a href="https://www.vaneck.com/us/en/investments/future-of-food-etf-yumy/">VanEck Future of Food ETF</a>. Querying the SMD shows that its price history, starting from its inception on December 1st, has been correctly downloaded.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-1af1aef elementor-widget elementor-widget-text-editor" data-id="1af1aef" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="sql" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #993333; font-weight: bold;">SELECT</span> ins<span style="color: #66cc66;">.</span>ticker<span style="color: #66cc66;">,</span> p<span style="color: #66cc66;">.*</span> <br /><span style="color: #993333; font-weight: bold;">FROM</span> instrument <span style="color: #993333; font-weight: bold;">AS</span> ins <br /><span style="color: #993333; font-weight: bold;">INNER</span> <span style="color: #993333; font-weight: bold;">JOIN</span> price <span style="color: #993333; font-weight: bold;">AS</span> p <br /><span style="color: #993333; font-weight: bold;">ON</span> ins<span style="color: #66cc66;">.</span>id <span style="color: #66cc66;">=</span> p<span style="color: #66cc66;">.</span>ticker_id <br /><span style="color: #993333; font-weight: bold;">WHERE</span> ins<span style="color: #66cc66;">.</span>ticker <span style="color: #66cc66;">=</span> <span style="color: #ff0000;">'YUMY'</span>;</pre>						</div>
				</div>
				<div class="elementor-element elementor-element-424b76e elementor-widget elementor-widget-image" data-id="424b76e" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
												<figure class="wp-caption">
										<img width="894" height="64" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-12.48.12.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-12.48.12.png 894w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-12.48.12-300x21.png 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-12.48.12-768x55.png 768w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-12.48.12-500x36.png 500w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-12.48.12-800x57.png 800w" sizes="(max-width: 894px) 100vw, 894px" />											<figcaption class="widget-image-caption wp-caption-text">MySQL Workbench view of the updated price table for instrument 'YUMY'.</figcaption>
										</figure>
									</div>
				</div>
				<div class="elementor-element elementor-element-c68a47b elementor-widget elementor-widget-heading" data-id="c68a47b" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-medium">5.2. Existing Instruments</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-74d50ac elementor-widget elementor-widget-text-editor" data-id="74d50ac" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>So far, the <i>update.py</i> script neatly checks for new instruments and adds them and their complete price history to the database. But what about the already existing &gt; 10,000 tickers? In this second part of the script, we&#8217;ll query the database for all tickers, excluding those that have just been added and therefore already have an up-to-date price history. Instead of assuming that the latest <i>price_date</i> in the database applies to all tickers as it has been the case in <a href="https://reasonabledeviations.com/about/">Robert Andrew Martin</a>&#8216;s update function, we&#8217;ll go the extra mile and determine the <i>last_price</i> for each ticker individually. We&#8217;ll then split these tickers into those that got their data from Yahoo Finance and those that got their data from Alpaca up until now to ensure consistency in the price histories. Finally, we&#8217;ll download price data to fill in the gaps between each ticker&#8217;s last <i>price_date</i> and yesterday&#8217;s (last past weekday&#8217;s) date.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-c98d7af elementor-widget elementor-widget-text-editor" data-id="c98d7af" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>In order to get the last <i>price_date</i> for each ticker, we need to do some more advanced SQL. My first and arguably naÃ¯ve approach was to iterate over every ticker and join its <b>instrument</b> and <b>price</b> table entries such that I could determine the latest date for which pricing data was available for that ticker. Though this approach worked, it took around seven minutes to get a result from the function for the whole list of existing tickers!</p>						</div>
				</div>
				<div class="elementor-element elementor-element-b726d9c elementor-widget elementor-widget-text-editor" data-id="b726d9c" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #808080; font-style: italic;"># Don't do this</span>
<span style="color: #ff7700; font-weight: bold;">def</span> get_update_info_from_list<span style="color: black;">(</span>tickers<span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>:
  ticker_df <span style="color: #66cc66;">=</span> pd.<span style="color: black;">DataFrame</span><span style="color: black;">(</span><span style="color: black;">)</span>
  <span style="color: #ff7700; font-weight: bold;">for</span> ticker <span style="color: #ff7700; font-weight: bold;">in</span> tickers:
    <span style="color: #ff7700; font-weight: bold;">try</span>:
      sql <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">"""
        SELECT ins.ticker, ins.id, p.vendor_id, p.price_date
        FROM instrument AS ins
        INNER JOIN price AS p
        ON ins.id = p.ticker_id
        WHERE ins.ticker = '{}' and p.price_date = (SELECT MAX(price_date) FROM price WHERE ticker_id = ins.id);"""</span>.<span style="color: black;">format</span><span style="color: black;">(</span>ticker<span style="color: black;">)</span>
      tmp <span style="color: #66cc66;">=</span> pd.<span style="color: black;">read_sql</span><span style="color: black;">(</span>sql<span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>
      ticker_df <span style="color: #66cc66;">=</span> ticker_df.<span style="color: black;">append</span><span style="color: black;">(</span>tmp<span style="color: #66cc66;">,</span> ignore_index <span style="color: #66cc66;">=</span> <span style="color: #008000;">True</span><span style="color: black;">)</span>
    <span style="color: #ff7700; font-weight: bold;">except</span> <span style="color: #008000;">Exception</span> <span style="color: #ff7700; font-weight: bold;">as</span> e:
      <span style="color: #ff7700; font-weight: bold;">continue</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">return</span> ticker_df</pre>						</div>
				</div>
				<div class="elementor-element elementor-element-a399164 elementor-widget elementor-widget-text-editor" data-id="a399164" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>In hindsight, it is no wonder that this took so long. Instead of joining the <b>instrument</b> and <b>price</b> tables once, it does so more than 10,000 times &#8211; once for each ticker. That can&#8217;t be efficient!</p><p>Thus, my second approach used a <i>nested</i> SQL statement to first join the <b>instrument</b> and <b>price</b> tables on the ticker <i>ids</i> and then select the maximum of the <i>price_date</i>, grouped by ticker. This approach was not only written more elegantly, but also only took around a third of the time. Waiting an additional two minutes in exchange for detailed last <i>price_date</i> information for each ticker in the database is well worth in my opinion.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-4ffa1fb elementor-widget elementor-widget-text-editor" data-id="4ffa1fb" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #808080; font-style: italic;"># Do this instead</span>
<span style="color: #ff7700; font-weight: bold;">def</span> get_update_info_from_list<span style="color: black;">(</span>conn<span style="color: #66cc66;">,</span> cursor<span style="color: black;">)</span>:
  <span style="color: #483d8b;">"""
  Gets latest price_date for every ticker in the database and returns it together with some other information
  :param conn: MySQL database connection
  :param cursor: MySQL database cursor for query execution
  :return: dataframe of tickers with their corresponding ids, vendor_ids and last price_dates
  """</span>
  cursor.<span style="color: black;">execute</span><span style="color: black;">(</span><span style="color: #483d8b;">"SET sql_mode = (SELECT REPLACE(@@sql_mode,'ONLY_FULL_GROUP_BY',''));"</span><span style="color: black;">)</span> <span style="color: #808080; font-style: italic;"># to use group by with an aggregated column</span>
Â 
  sql <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">"""
    SELECT j.ticker, j.id, j.vendor_id, MAX(j.price_date) last_date
    FROM
      (SELECT ins.ticker, ins.id, p.vendor_id, p.price_date
      FROM instrument AS ins
      INNER JOIN price AS p
      ON ins.id = p.ticker_id) AS j
    GROUP BY j.id;"""</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">return</span> pd.<span style="color: black;">read_sql</span><span style="color: black;">(</span>sql<span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-bc5d3cb elementor-widget elementor-widget-text-editor" data-id="bc5d3cb" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>You could imagine the returned dataframe to look something like this:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-641f4b8 elementor-widget elementor-widget-image" data-id="641f4b8" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
												<figure class="wp-caption">
										<img width="314" height="288" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-13.40.09.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-13.40.09.png 314w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-13.40.09-300x275.png 300w" sizes="(max-width: 314px) 100vw, 314px" />											<figcaption class="widget-image-caption wp-caption-text">Exemplary returned dataframe.</figcaption>
										</figure>
									</div>
				</div>
				<div class="elementor-element elementor-element-a54b426 elementor-widget elementor-widget-text-editor" data-id="a54b426" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Before we pass this dataframe to the price update functions, we&#8217;ll just quickly remove those entries that belong to the newly added tickers whose price history is already up-to-date by definition, and those entries whose last <i>price_date</i> (= <i>last_date</i>) is equal to yesterday (note, that we need an additional <i>yesterday_dt</i> variableÂ in datetime format, since we cannot compare <i>last_date</i> with a string). This assures that if we have to run the script again, e.g. due to some error on the API server side, the script will skip over those tickers that have just been updated and naturally do not have any new price data posted yet.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-c245515 elementor-widget elementor-widget-text-editor" data-id="c245515" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">yesterday_dt <span style="color: #66cc66;">=</span> ut.<span style="color: black;">get_yesterday</span><span style="color: black;">(</span><span style="color: black;">)</span>
tickers_df <span style="color: #66cc66;">=</span> ut.<span style="color: black;">get_update_info_from_list</span><span style="color: black;">(</span>conn<span style="color: #66cc66;">,</span> cursor<span style="color: black;">)</span>
tickers_df <span style="color: #66cc66;">=</span> tickers_df<span style="color: black;">[</span><span style="color: #66cc66;">~</span>tickers_df<span style="color: black;">[</span><span style="color: #483d8b;">'ticker'</span><span style="color: black;">]</span>.<span style="color: black;">isin</span><span style="color: black;">(</span>new_tickers<span style="color: black;">)</span><span style="color: black;">]</span> <span style="color: #808080; font-style: italic;"># filter out newly added tickers that are already up to date</span>
tickers_df <span style="color: #66cc66;">=</span> tickers_df<span style="color: black;">[</span>tickers_df<span style="color: black;">[</span><span style="color: #483d8b;">'last_date'</span><span style="color: black;">]</span> <span style="color: #66cc66;">!=</span> yesterday_dt<span style="color: black;">]</span> <span style="color: #808080; font-style: italic;"># filter out those tickers whose last_price date is equal to yesterday's date</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-8af2f35 elementor-widget elementor-widget-image" data-id="8af2f35" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
												<figure class="wp-caption">
										<img width="314" height="290" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-13.42.34.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-13.42.34.png 314w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-13.42.34-300x277.png 300w" sizes="(max-width: 314px) 100vw, 314px" />											<figcaption class="widget-image-caption wp-caption-text">Exemplary clean tickers_df dataframe.</figcaption>
										</figure>
									</div>
				</div>
				<div class="elementor-element elementor-element-f323397 elementor-widget elementor-widget-text-editor" data-id="f323397" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>In the next step, we split the clean <i>tickers_df</i> dataframe into a <i>yahoo_tickers_df</i> (cast tickers to Yahoo Finance format again) and an <i>alpaca_tickers_df</i>, as well as get the corresponding <i>vendor_ids</i> from the database:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-0bb0ab3 elementor-widget elementor-widget-text-editor" data-id="0bb0ab3" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #ff7700; font-weight: bold;">if</span> tickers_df.<span style="color: black;">empty</span>:
  <span style="color: #ff7700; font-weight: bold;">continue</span> <span style="color: #808080; font-style: italic;"># prices are already up to date</span>
<span style="color: #ff7700; font-weight: bold;">else</span>:
  yahoo_tickers_df <span style="color: #66cc66;">=</span> tickers_df<span style="color: black;">[</span>tickers_df<span style="color: black;">[</span><span style="color: #483d8b;">'vendor_id'</span><span style="color: black;">]</span> <span style="color: #66cc66;">==</span> ut.<span style="color: black;">get_vendor_id</span><span style="color: black;">(</span><span style="color: #483d8b;">'Yahoo Finance'</span><span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span><span style="color: black;">]</span>
  yahoo_tickers_df.<span style="color: black;">drop</span><span style="color: black;">(</span><span style="color: #483d8b;">'vendor_id'</span><span style="color: #66cc66;">,</span> axis <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> inplace <span style="color: #66cc66;">=</span> <span style="color: #008000;">True</span><span style="color: black;">)</span>
Â 
  <span style="color: #808080; font-style: italic;"># Casting tickers to yf format</span>
  tmp <span style="color: #66cc66;">=</span> ut.<span style="color: black;">cast_to_yf</span><span style="color: black;">(</span>yahoo_tickers_df<span style="color: black;">[</span><span style="color: #483d8b;">'ticker'</span><span style="color: black;">]</span>.<span style="color: black;">tolist</span><span style="color: black;">(</span><span style="color: black;">)</span><span style="color: black;">)</span>
  yahoo_tickers_df.<span style="color: black;">drop</span><span style="color: black;">(</span><span style="color: #483d8b;">'ticker'</span><span style="color: #66cc66;">,</span> axis <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> inplace <span style="color: #66cc66;">=</span> <span style="color: #008000;">True</span><span style="color: black;">)</span>
  yahoo_tickers_df.<span style="color: black;">insert</span><span style="color: black;">(</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'ticker'</span><span style="color: #66cc66;">,</span> tmp<span style="color: black;">)</span>
Â 
  alpaca_tickers_df <span style="color: #66cc66;">=</span> tickers_df<span style="color: black;">[</span>tickers_df<span style="color: black;">[</span><span style="color: #483d8b;">'vendor_id'</span><span style="color: black;">]</span> <span style="color: #66cc66;">==</span> ut.<span style="color: black;">get_vendor_id</span><span style="color: black;">(</span><span style="color: #483d8b;">'Alpaca'</span><span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span><span style="color: black;">]</span>
  alpaca_tickers_df.<span style="color: black;">drop</span><span style="color: black;">(</span><span style="color: #483d8b;">'vendor_id'</span><span style="color: #66cc66;">,</span> axis <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> inplace <span style="color: #66cc66;">=</span> <span style="color: #008000;">True</span><span style="color: black;">)</span>
Â 
  yf <span style="color: #66cc66;">=</span> ut.<span style="color: black;">get_vendor_id</span><span style="color: black;">(</span><span style="color: #483d8b;">'Yahoo Finance'</span><span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>
  alp <span style="color: #66cc66;">=</span> ut.<span style="color: black;">get_vendor_id</span><span style="color: black;">(</span><span style="color: #483d8b;">'Alpaca'</span><span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-b0eab06 elementor-arrows-position-inside elementor-pagination-position-outside elementor-widget elementor-widget-image-carousel" data-id="b0eab06" data-element_type="widget" data-settings="{&quot;slides_to_show&quot;:&quot;1&quot;,&quot;navigation&quot;:&quot;both&quot;,&quot;autoplay&quot;:&quot;yes&quot;,&quot;pause_on_hover&quot;:&quot;yes&quot;,&quot;pause_on_interaction&quot;:&quot;yes&quot;,&quot;autoplay_speed&quot;:5000,&quot;infinite&quot;:&quot;yes&quot;,&quot;effect&quot;:&quot;slide&quot;,&quot;speed&quot;:500}" data-widget_type="image-carousel.default">
				<div class="elementor-widget-container">
					<div class="elementor-image-carousel-wrapper swiper-container" dir="ltr">
			<div class="elementor-image-carousel swiper-wrapper">
								<div class="swiper-slide"><figure class="swiper-slide-inner"><img class="swiper-slide-image" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-13.53.08.png" alt="Exemplary yahoo_tickers_df dataframe." /><figcaption class="elementor-image-carousel-caption">Exemplary yahoo_tickers_df dataframe.</figcaption></figure></div><div class="swiper-slide"><figure class="swiper-slide-inner"><img class="swiper-slide-image" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-13.53.17.png" alt="Exemplary alpaca_tickers_df dataframe." /><figcaption class="elementor-image-carousel-caption">Exemplary alpaca_tickers_df dataframe.</figcaption></figure></div>			</div>
												<div class="swiper-pagination"></div>
													<div class="elementor-swiper-button elementor-swiper-button-prev">
						<i class="eicon-chevron-left" aria-hidden="true"></i>
						<span class="elementor-screen-only">Previous</span>
					</div>
					<div class="elementor-swiper-button elementor-swiper-button-next">
						<i class="eicon-chevron-right" aria-hidden="true"></i>
						<span class="elementor-screen-only">Next</span>
					</div>
									</div>
				</div>
				</div>
				<div class="elementor-element elementor-element-c1b2d53 elementor-widget elementor-widget-text-editor" data-id="c1b2d53" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>The price update functions for the Yahoo Finance tickers and the Alpaca tickers are actually very similar in structure. For each ticker of the corresponding dataframes, we&#8217;ll first determine the <i>next_date</i>, i.e. the date after its <i>last_date</i> as a starting point for the price download.Â </p><p>Due to <a href="https://forum.alpaca.markets/t/get-barset-ignore-start-and-end-dates/2961">Alpaca&#8217;s weirdly specific requirements for start and end dates</a>, we have to add a timestamp to the <i>next_date</i> and <i>end_date</i> strings in the <i>update_historical_prices_alpaca()</i> function. For the <i>update_historical_prices_yahoo()</i> function, we have to manually drop the first row of the resulting dataframe because, for some reason and despite correctly specifying the <i>next_date</i>, Yahoo still returns data starting from the <i>last_date</i>.</p><p>After that&#8217;s done, we simply iterate over the rows of the returned dataframes and write the vendor_id, ticker_id and the downloaded price data directly into the database.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-fab7f7b elementor-widget elementor-widget-text-editor" data-id="fab7f7b" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #ff7700; font-weight: bold;">def</span> update_historical_prices_yf<span style="color: black;">(</span>tickers_df<span style="color: #66cc66;">,</span> vendor<span style="color: #66cc66;">,</span> conn<span style="color: #66cc66;">,</span> cursor<span style="color: #66cc66;">,</span> end_date<span style="color: black;">)</span>:
  <span style="color: #483d8b;">"""
  Retrieves historical prices in a given timeframe for a set of tickers from Yahoo Finance and writes them directly to the database
  :param tickers_df: dataframe of tickers for which prices should be written
  :param vendor: vendor id
  :param conn: MySQL database connection
  :param cursor: MySQL database cursor for query execution
  :param end_date: latest price date
  """</span>
  <span style="color: #ff7700; font-weight: bold;">for</span> ticker <span style="color: #ff7700; font-weight: bold;">in</span> tqdm<span style="color: black;">(</span>tickers_df.<span style="color: black;">itertuples</span><span style="color: black;">(</span><span style="color: black;">)</span><span style="color: black;">)</span>:
    <span style="color: #ff7700; font-weight: bold;">try</span>:
      next_date <span style="color: #66cc66;">=</span> <span style="color: #008000;">str</span><span style="color: black;">(</span>ticker.<span style="color: black;">last_date</span> + <span style="color: #dc143c;">datetime</span>.<span style="color: black;">timedelta</span><span style="color: black;">(</span>days <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span><span style="color: black;">)</span><span style="color: black;">)</span>
      tmp <span style="color: #66cc66;">=</span> pdr.<span style="color: black;">get_data_yahoo</span><span style="color: black;">(</span>ticker.<span style="color: black;">ticker</span><span style="color: #66cc66;">,</span> start <span style="color: #66cc66;">=</span> next_date<span style="color: #66cc66;">,</span> end <span style="color: #66cc66;">=</span> end_date<span style="color: #66cc66;">,</span> progress <span style="color: #66cc66;">=</span> <span style="color: #008000;">False</span><span style="color: black;">)</span>
      tmp <span style="color: #66cc66;">=</span> tmp.<span style="color: black;">iloc</span><span style="color: black;">[</span><span style="color: #ff4500;">1</span>:<span style="color: #66cc66;">,</span> :<span style="color: black;">]</span> <span style="color: #808080; font-style: italic;"># drop row for last price_date</span>
Â 
      <span style="color: #ff7700; font-weight: bold;">for</span> row <span style="color: #ff7700; font-weight: bold;">in</span> tmp.<span style="color: black;">itertuples</span><span style="color: black;">(</span><span style="color: black;">)</span>:
        values <span style="color: #66cc66;">=</span> <span style="color: black;">[</span>vendor<span style="color: #66cc66;">,</span> ticker.<span style="color: #008000;">id</span><span style="color: black;">]</span> + <span style="color: #008000;">list</span><span style="color: black;">(</span>row<span style="color: black;">)</span>
        sql <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">"INSERT INTO price (vendor_id, ticker_id, price_date, open_price, high_price, low_price, close_price, adj_close_price, volume) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s)"</span>
        cursor.<span style="color: black;">execute</span><span style="color: black;">(</span>sql<span style="color: #66cc66;">,</span> <span style="color: #008000;">tuple</span><span style="color: black;">(</span>values<span style="color: black;">)</span><span style="color: black;">)</span>
    <span style="color: #ff7700; font-weight: bold;">except</span> <span style="color: #008000;">Exception</span> <span style="color: #ff7700; font-weight: bold;">as</span> e:
      <span style="color: #ff7700; font-weight: bold;">print</span><span style="color: black;">(</span><span style="color: #483d8b;">"Failed to update {}."</span>.<span style="color: black;">format</span><span style="color: black;">(</span>ticker.<span style="color: black;">ticker</span><span style="color: black;">)</span><span style="color: black;">)</span>
      <span style="color: #ff7700; font-weight: bold;">continue</span>
Â 
  conn.<span style="color: black;">commit</span><span style="color: black;">(</span><span style="color: black;">)</span>
  <span style="color: #ff7700; font-weight: bold;">print</span><span style="color: black;">(</span><span style="color: #483d8b;">"|---------------| Data successfully written to database. |---------------|"</span><span style="color: black;">)</span>
  <span style="color: #ff7700; font-weight: bold;">return</span>
Â 
Â 
<span style="color: #ff7700; font-weight: bold;">def</span> update_historical_prices_alpaca<span style="color: black;">(</span>tickers_df<span style="color: #66cc66;">,</span> vendor<span style="color: #66cc66;">,</span> api<span style="color: #66cc66;">,</span> conn<span style="color: #66cc66;">,</span> cursor<span style="color: #66cc66;">,</span> end_date<span style="color: black;">)</span>:
  <span style="color: #483d8b;">"""
  Retrieves historical prices in a given timeframe for a set of tickers from Alpaca and writes them directly to the database
  :param tickers_df: dataframe of tickers for which prices should be written
  :param vendor: vendor id
  :param api: Alpaca api object
  :param conn: MySQL database connection
  :param cursor: MySQL database cursor for query execution
  :param end_date: latest price date
  """</span>
  <span style="color: #ff7700; font-weight: bold;">for</span> ticker <span style="color: #ff7700; font-weight: bold;">in</span> tqdm<span style="color: black;">(</span>tickers_df.<span style="color: black;">itertuples</span><span style="color: black;">(</span><span style="color: black;">)</span><span style="color: black;">)</span>:
    <span style="color: #ff7700; font-weight: bold;">try</span>:
      next_date <span style="color: #66cc66;">=</span> <span style="color: #008000;">str</span><span style="color: black;">(</span>ticker.<span style="color: black;">last_date</span> + <span style="color: #dc143c;">datetime</span>.<span style="color: black;">timedelta</span><span style="color: black;">(</span>days <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span><span style="color: black;">)</span><span style="color: black;">)</span> + <span style="color: #483d8b;">'T00:00:00-05:00'</span> <span style="color: #808080; font-style: italic;"># adhering to the strict alpaca date format</span>
      end_date <span style="color: #66cc66;">=</span> end_date + <span style="color: #483d8b;">'T00:00:00-05:00'</span> <span style="color: #808080; font-style: italic;"># adhering to the strict alpaca date format</span>
      tmp <span style="color: #66cc66;">=</span> api.<span style="color: black;">get_barset</span><span style="color: black;">(</span>ticker.<span style="color: black;">ticker</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'day'</span><span style="color: #66cc66;">,</span> limit <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1000</span><span style="color: #66cc66;">,</span> start <span style="color: #66cc66;">=</span> next_date<span style="color: #66cc66;">,</span> end <span style="color: #66cc66;">=</span> end_date<span style="color: black;">)</span>.<span style="color: black;">df</span>
Â 
      <span style="color: #ff7700; font-weight: bold;">for</span> row <span style="color: #ff7700; font-weight: bold;">in</span> tmp.<span style="color: black;">itertuples</span><span style="color: black;">(</span><span style="color: black;">)</span>:
        values <span style="color: #66cc66;">=</span> <span style="color: black;">[</span>vendor<span style="color: #66cc66;">,</span> ticker.<span style="color: #008000;">id</span><span style="color: black;">]</span> + <span style="color: #008000;">list</span><span style="color: black;">(</span>row<span style="color: black;">)</span>
        sql <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">"INSERT INTO price (vendor_id, ticker_id, price_date, open_price, high_price, low_price, close_price, volume) VALUES (%s, %s, %s, %s, %s, %s, %s, %s)"</span>
        cursor.<span style="color: black;">execute</span><span style="color: black;">(</span>sql<span style="color: #66cc66;">,</span> <span style="color: #008000;">tuple</span><span style="color: black;">(</span>values<span style="color: black;">)</span><span style="color: black;">)</span>
    <span style="color: #ff7700; font-weight: bold;">except</span> <span style="color: #008000;">Exception</span> <span style="color: #ff7700; font-weight: bold;">as</span> e:
      <span style="color: #ff7700; font-weight: bold;">print</span><span style="color: black;">(</span><span style="color: #483d8b;">'Failed to update {}.'</span>.<span style="color: black;">format</span><span style="color: black;">(</span>ticker.<span style="color: black;">ticker</span><span style="color: black;">)</span><span style="color: black;">)</span>
      <span style="color: #ff7700; font-weight: bold;">continue</span>
Â 
  conn.<span style="color: black;">commit</span><span style="color: black;">(</span><span style="color: black;">)</span>
  <span style="color: #ff7700; font-weight: bold;">print</span><span style="color: black;">(</span><span style="color: #483d8b;">"|---------------| Data successfully written to database. |---------------|"</span><span style="color: black;">)</span>
  <span style="color: #ff7700; font-weight: bold;">return</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-fc10d52 elementor-widget elementor-widget-text-editor" data-id="fc10d52" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Back in the <i>update.py</i> file, we call these two new functions, batch-wise for Yahoo tickers since those make up by far the largest portion of tickers in the SMD, and normally for Alpaca tickers.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-44e4355 elementor-widget elementor-widget-text-editor" data-id="44e4355" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #808080; font-style: italic;"># still within the else clause</span>
Â 
  <span style="color: #808080; font-style: italic;"># Starting Price download from Yahoo Finance</span>
  splits <span style="color: #66cc66;">=</span> ut.<span style="color: black;">determine_splits</span><span style="color: black;">(</span>yahoo_tickers_df<span style="color: black;">[</span><span style="color: #483d8b;">'ticker'</span><span style="color: black;">]</span>.<span style="color: black;">to_list</span><span style="color: black;">(</span><span style="color: black;">)</span><span style="color: #66cc66;">,</span> cf.<span style="color: black;">BATCH_SIZE</span><span style="color: black;">)</span>
  yahoo_tickers_list <span style="color: #66cc66;">=</span> <span style="color: black;">[</span>yahoo_tickers_df.<span style="color: black;">loc</span><span style="color: black;">[</span>i : i + cf.<span style="color: black;">BATCH_SIZE</span> - <span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> : <span style="color: black;">]</span> <span style="color: #ff7700; font-weight: bold;">for</span> i <span style="color: #ff7700; font-weight: bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">(</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">len</span><span style="color: black;">(</span>yahoo_tickers_df<span style="color: black;">)</span><span style="color: #66cc66;">,</span> cf.<span style="color: black;">BATCH_SIZE</span><span style="color: black;">)</span><span style="color: black;">]</span>
Â 
  count <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span>
  <span style="color: #ff7700; font-weight: bold;">for</span> batch <span style="color: #ff7700; font-weight: bold;">in</span> yahoo_tickers_list:
    <span style="color: #ff7700; font-weight: bold;">print</span><span style="color: black;">(</span><span style="color: #483d8b;">"|---------------| Split {} of {} |---------------|"</span>.<span style="color: black;">format</span><span style="color: black;">(</span>count<span style="color: #66cc66;">,</span> splits<span style="color: black;">)</span><span style="color: black;">)</span>
    ut.<span style="color: black;">update_historical_prices_yf</span><span style="color: black;">(</span>batch<span style="color: #66cc66;">,</span> yf<span style="color: #66cc66;">,</span> conn<span style="color: #66cc66;">,</span> cursor<span style="color: #66cc66;">,</span> yesterday<span style="color: black;">)</span>
    count +<span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span>
Â 
  <span style="color: #808080; font-style: italic;"># Starting Price download from Alpaca</span>
  ut.<span style="color: black;">update_historical_prices_alpaca</span><span style="color: black;">(</span>alpaca_tickers_df<span style="color: #66cc66;">,</span> alp<span style="color: #66cc66;">,</span> api<span style="color: #66cc66;">,</span> conn<span style="color: #66cc66;">,</span> cursor<span style="color: #66cc66;">,</span> yesterday<span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-608e422 elementor-widget elementor-widget-heading" data-id="608e422" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-medium">5.3. Close Connection to SMD</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-89e51c6 elementor-widget elementor-widget-text-editor" data-id="89e51c6" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>At the end of the script, we&#8217;ll first close the connection to the cursor, and then to the database itself:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-e100e25 elementor-widget elementor-widget-text-editor" data-id="e100e25" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">cursor.<span style="color: black;">close</span><span style="color: black;">(</span><span style="color: black;">)</span>
conn.<span style="color: black;">close</span><span style="color: black;">(</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-492769d elementor-widget elementor-widget-heading" data-id="492769d" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-medium">5.4. Letting the Script run</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-bd2787a elementor-widget elementor-widget-text-editor" data-id="bd2787a" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Now it is time to run the script (make sure that your mysql server is running, <i>mysql.server start</i>), see if everything is working well and our SMD gets updated as expected.Â </p><p>For me, updating the whole database six days after its initial population took ca. 40 minutes, with 42 new instruments and 55,554 new rows of price data added. Depending on your internet connection, the amount of tickers in the database and the current load on the API servers, the updating time can vary significantly. For this run, I got between three and five tickers updated per second, whereas on a different day, I only got a throughput of one ticker per second.</p><p>Personally, I added some <i>time.sleep()</i> and <i>print()</i> statements throughout my <i>update.py</i> script for better readability and logging later on, making it look like this:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-de7668c elementor-arrows-position-inside elementor-pagination-position-outside elementor-widget elementor-widget-image-carousel" data-id="de7668c" data-element_type="widget" data-settings="{&quot;slides_to_show&quot;:&quot;1&quot;,&quot;navigation&quot;:&quot;both&quot;,&quot;autoplay&quot;:&quot;yes&quot;,&quot;pause_on_hover&quot;:&quot;yes&quot;,&quot;pause_on_interaction&quot;:&quot;yes&quot;,&quot;autoplay_speed&quot;:5000,&quot;infinite&quot;:&quot;yes&quot;,&quot;effect&quot;:&quot;slide&quot;,&quot;speed&quot;:500}" data-widget_type="image-carousel.default">
				<div class="elementor-widget-container">
					<div class="elementor-image-carousel-wrapper swiper-container" dir="ltr">
			<div class="elementor-image-carousel swiper-wrapper">
								<div class="swiper-slide"><figure class="swiper-slide-inner"><img class="swiper-slide-image" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-15.21.59.png" alt="Fetching new instruments ..." /><figcaption class="elementor-image-carousel-caption">Fetching new instruments ...</figcaption></figure></div><div class="swiper-slide"><figure class="swiper-slide-inner"><img class="swiper-slide-image" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-15.22.22.png" alt="... downloading their price history ..." /><figcaption class="elementor-image-carousel-caption">... downloading their price history ...</figcaption></figure></div><div class="swiper-slide"><figure class="swiper-slide-inner"><img class="swiper-slide-image" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-15.22.52.png" alt="... and updating existing tickers." /><figcaption class="elementor-image-carousel-caption">... and updating existing tickers.</figcaption></figure></div>			</div>
												<div class="swiper-pagination"></div>
													<div class="elementor-swiper-button elementor-swiper-button-prev">
						<i class="eicon-chevron-left" aria-hidden="true"></i>
						<span class="elementor-screen-only">Previous</span>
					</div>
					<div class="elementor-swiper-button elementor-swiper-button-next">
						<i class="eicon-chevron-right" aria-hidden="true"></i>
						<span class="elementor-screen-only">Next</span>
					</div>
									</div>
				</div>
				</div>
				<div class="elementor-element elementor-element-ecdc61b elementor-widget elementor-widget-text-editor" data-id="ecdc61b" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>The script ran through without any problems, if you happen to get some <i>JSONDecodeErrors</i>, manually stop the script and restart it. Don&#8217;t worry, since progress is written to the database throughout the script and not just at the very end, your next run will skip over those entries and continue from where you&#8217;ve left off before.</p><p>Let&#8217;s take a look at Apple&#8217;s entries in the database to see, whether it updated correctly:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-9d195ef elementor-widget elementor-widget-text-editor" data-id="9d195ef" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="sql" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #993333; font-weight: bold;">SELECT</span> ins<span style="color: #66cc66;">.</span>ticker<span style="color: #66cc66;">,</span> p<span style="color: #66cc66;">.*</span> 
<span style="color: #993333; font-weight: bold;">FROM</span> instrument <span style="color: #993333; font-weight: bold;">AS</span> ins 
<span style="color: #993333; font-weight: bold;">INNER</span> <span style="color: #993333; font-weight: bold;">JOIN</span> price <span style="color: #993333; font-weight: bold;">AS</span> p 
<span style="color: #993333; font-weight: bold;">ON</span> ins<span style="color: #66cc66;">.</span>id <span style="color: #66cc66;">=</span> p<span style="color: #66cc66;">.</span>ticker_id 
<span style="color: #993333; font-weight: bold;">WHERE</span> ins<span style="color: #66cc66;">.</span>ticker <span style="color: #66cc66;">=</span> <span style="color: #ff0000;">'AAPL'</span>;</pre>						</div>
				</div>
				<div class="elementor-element elementor-element-8f9f685 elementor-arrows-position-inside elementor-pagination-position-outside elementor-widget elementor-widget-image-carousel" data-id="8f9f685" data-element_type="widget" data-settings="{&quot;slides_to_show&quot;:&quot;1&quot;,&quot;navigation&quot;:&quot;both&quot;,&quot;autoplay&quot;:&quot;yes&quot;,&quot;pause_on_hover&quot;:&quot;yes&quot;,&quot;pause_on_interaction&quot;:&quot;yes&quot;,&quot;autoplay_speed&quot;:5000,&quot;infinite&quot;:&quot;yes&quot;,&quot;effect&quot;:&quot;slide&quot;,&quot;speed&quot;:500}" data-widget_type="image-carousel.default">
				<div class="elementor-widget-container">
					<div class="elementor-image-carousel-wrapper swiper-container" dir="ltr">
			<div class="elementor-image-carousel swiper-wrapper">
								<div class="swiper-slide"><figure class="swiper-slide-inner"><img class="swiper-slide-image" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-15.29.09.png" alt="AAPL price data before update." /><figcaption class="elementor-image-carousel-caption">AAPL price data before update.</figcaption></figure></div><div class="swiper-slide"><figure class="swiper-slide-inner"><img class="swiper-slide-image" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-15.28.08.png" alt="AAPL price data after update." /><figcaption class="elementor-image-carousel-caption">AAPL price data after update.</figcaption></figure></div>			</div>
												<div class="swiper-pagination"></div>
													<div class="elementor-swiper-button elementor-swiper-button-prev">
						<i class="eicon-chevron-left" aria-hidden="true"></i>
						<span class="elementor-screen-only">Previous</span>
					</div>
					<div class="elementor-swiper-button elementor-swiper-button-next">
						<i class="eicon-chevron-right" aria-hidden="true"></i>
						<span class="elementor-screen-only">Next</span>
					</div>
									</div>
				</div>
				</div>
				<div class="elementor-element elementor-element-f7b8e36 elementor-widget elementor-widget-text-editor" data-id="f7b8e36" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>It is completely up to you in which intervals you&#8217;re going to run the <i>update.py</i> script. Getting one or 14 new data points per ticker does not really affect the runtime at all, so if you don&#8217;t need the latest price data as soon as it gets published, you might want to run the script weekly instead of daily. Personally, I&#8217;ll probably run the script bi-weekly on Sundays, at least as long as the SMD is still a local instance on my Mac and not on a server.</p>						</div>
				</div>
					</div>
		</div>
							</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-a7a1cf8 elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="a7a1cf8" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-c17c5d9" data-id="c17c5d9" data-element_type="column">
			<div class="elementor-widget-wrap elementor-element-populated">
								<div class="elementor-element elementor-element-0bc80ad elementor-widget elementor-widget-heading" data-id="0bc80ad" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-default">6. Interacting with the SMD</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-cf2845e elementor-widget elementor-widget-text-editor" data-id="cf2845e" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Now that our SMD is finally complete, let&#8217;s explore it a bit and learn how to interact with it. I am planning on building a full frontend to interact with the database in the future, but for now, let&#8217;s look at some core ways to work with our data. Note that your mysql server must be running (<i>mysql.server start</i>) to establish a connection with the database!</p><p>First, we need to import the <i>config.py</i> and <i>utils.py</i> files, as well as some additional libraries:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-58a6443 elementor-widget elementor-widget-text-editor" data-id="58a6443" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #ff7700; font-weight: bold;">import</span> config <span style="color: #ff7700; font-weight: bold;">as</span> cf
<span style="color: #ff7700; font-weight: bold;">import</span> utils <span style="color: #ff7700; font-weight: bold;">as</span> ut
Â 
<span style="color: #ff7700; font-weight: bold;">import</span> pandas <span style="color: #ff7700; font-weight: bold;">as</span> pd
<span style="color: #ff7700; font-weight: bold;">import</span> numpy <span style="color: #ff7700; font-weight: bold;">as</span> np</pre>						</div>
				</div>
				<div class="elementor-element elementor-element-b023af1 elementor-widget elementor-widget-text-editor" data-id="b023af1" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Then, connect to the SMD as usual:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-4583315 elementor-widget elementor-widget-text-editor" data-id="4583315" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #808080; font-style: italic;"># Connect to DB</span>
conn <span style="color: #66cc66;">=</span> ut.<span style="color: black;">connect_db</span><span style="color: black;">(</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-ee26aa0 elementor-widget elementor-widget-text-editor" data-id="ee26aa0" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>To simplify interacting with our SMD, let&#8217;s write some functions that retrieve either only closing prices or the whole OHLCV data for a given ticker and add them to the <i>utils.py</i> file. Depending on which vendor the ticker of interest got its data from, the functions either return theÂ <i>adj_close_price</i> (Yahoo) or the <i>close_price</i> (Alpaca).</p>						</div>
				</div>
				<div class="elementor-element elementor-element-349dfc3 elementor-widget elementor-widget-text-editor" data-id="349dfc3" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #ff7700; font-weight: bold;">def</span> get_ohlcv_df<span style="color: black;">(</span>ticker<span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>:
  <span style="color: #483d8b;">"""
  Query the database for OHLCV data of a specified ticker
  :param ticker: ticker for which OHLCV data should be returned
  :param conn: MySQL database connection
  :return: dataframe with OHLCV data
  """</span>
  price <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'adj_close_price'</span> <span style="color: #808080; font-style: italic;"># default: Yahoo Finance</span>
  vendor <span style="color: #66cc66;">=</span> get_vendor_id_ticker<span style="color: black;">(</span>ticker<span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">if</span> vendor <span style="color: #66cc66;">==</span> <span style="color: #ff4500;">2</span>:
    price <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'close_price'</span> <span style="color: #808080; font-style: italic;"># Alpaca</span>
Â 
  sql <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">"""
    SELECT p.price_date, p.open_price, p.high_price, p.low_price, p.{}, p.volume
    FROM instrument AS ins
    INNER JOIN price AS p
    ON p.ticker_id = ins.id
    WHERE ins.ticker = '{}'
    ORDER BY p.price_date ASC;"""</span>.<span style="color: black;">format</span><span style="color: black;">(</span>price<span style="color: #66cc66;">,</span> ticker<span style="color: black;">)</span>
Â 
  tmp <span style="color: #66cc66;">=</span> pd.<span style="color: black;">read_sql</span><span style="color: black;">(</span>sql<span style="color: #66cc66;">,</span> conn<span style="color: #66cc66;">,</span> index_col <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'price_date'</span><span style="color: black;">)</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">if</span> tmp.<span style="color: black;">empty</span>:
    <span style="color: #ff7700; font-weight: bold;">print</span><span style="color: black;">(</span><span style="color: #483d8b;">'No data for {} in database.'</span>.<span style="color: black;">format</span><span style="color: black;">(</span>ticker<span style="color: black;">)</span><span style="color: black;">)</span>
    <span style="color: #dc143c;">sys</span>.<span style="color: black;">exit</span><span style="color: black;">(</span><span style="color: #ff4500;">1</span><span style="color: black;">)</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">return</span> tmp
Â 
Â 
<span style="color: #ff7700; font-weight: bold;">def</span> get_price_df<span style="color: black;">(</span>ticker<span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>:
  <span style="color: #483d8b;">"""
  Query the database for (adj) closing prices of a specified ticker
  :param ticker: ticker for which prices should be returned
  :param conn: MySQL database connection
  :return: dataframe with closing prices
  """</span>
  price <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'adj_close_price'</span> <span style="color: #808080; font-style: italic;"># default: Yahoo Finance</span>
  vendor <span style="color: #66cc66;">=</span> get_vendor_id_ticker<span style="color: black;">(</span>ticker<span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">if</span> vendor <span style="color: #66cc66;">==</span> <span style="color: #ff4500;">2</span>:
    price <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'close_price'</span> <span style="color: #808080; font-style: italic;"># Alpaca</span>
Â 
  sql <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">"""
    SELECT p.price_date, p.{}
    FROM instrument AS ins
    INNER JOIN price AS p
    ON p.ticker_id = ins.id
    WHERE ins.ticker = '{}'
    ORDER BY p.price_date ASC;"""</span>.<span style="color: black;">format</span><span style="color: black;">(</span>price<span style="color: #66cc66;">,</span> ticker<span style="color: black;">)</span>
Â 
  tmp <span style="color: #66cc66;">=</span> pd.<span style="color: black;">read_sql</span><span style="color: black;">(</span>sql<span style="color: #66cc66;">,</span> conn<span style="color: #66cc66;">,</span> index_col <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'price_date'</span><span style="color: black;">)</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">if</span> tmp.<span style="color: black;">empty</span>:
    <span style="color: #ff7700; font-weight: bold;">print</span><span style="color: black;">(</span><span style="color: #483d8b;">'No data for {} in database.'</span>.<span style="color: black;">format</span><span style="color: black;">(</span>ticker<span style="color: black;">)</span><span style="color: black;">)</span>
    <span style="color: #dc143c;">sys</span>.<span style="color: black;">exit</span><span style="color: black;">(</span><span style="color: #ff4500;">1</span><span style="color: black;">)</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">return</span> tmp
Â 
Â 
<span style="color: #ff7700; font-weight: bold;">def</span> get_vendor_id_ticker<span style="color: black;">(</span>ticker<span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>:
  <span style="color: #483d8b;">"""
  Given a MySQL database connection, query for the vendor id of a specified ticker
  :param ticker: ticker for which vendor id should be returned
  :conn: MySQL database connection
  :return: vendor id
  """</span>
  sql <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">"""
    SELECT DISTINCT (p.vendor_id)
    FROM instrument AS ins
    INNER JOIN price AS p
    ON p.ticker_id = ins.id
    WHERE ins.ticker = '{}';"""</span>.<span style="color: black;">format</span><span style="color: black;">(</span>ticker<span style="color: black;">)</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">return</span> pd.<span style="color: black;">read_sql</span><span style="color: black;">(</span>sql<span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>.<span style="color: black;">astype</span><span style="color: black;">(</span><span style="color: #008000;">int</span><span style="color: black;">)</span>.<span style="color: black;">iloc</span><span style="color: black;">[</span><span style="color: #ff4500;">0</span><span style="color: black;">]</span><span style="color: black;">[</span><span style="color: #483d8b;">'vendor_id'</span><span style="color: black;">]</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-509d654 elementor-widget elementor-widget-heading" data-id="509d654" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-medium">6.1. Simple Data Retrieval &amp; Static Plotting (matplotlib)</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-87cf40d elementor-widget elementor-widget-text-editor" data-id="87cf40d" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Let&#8217;s start simple with getting closing prices for a specified ticker from our database and storing those in a dataframe:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-a7c3ec1 elementor-widget elementor-widget-text-editor" data-id="a7c3ec1" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">ticker <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'AAPL'</span>
Â 
<span style="color: #808080; font-style: italic;"># Simple data call</span>
data <span style="color: #66cc66;">=</span> ut.<span style="color: black;">get_price_df</span><span style="color: black;">(</span>ticker<span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>
data.<span style="color: black;">tail</span><span style="color: black;">(</span><span style="color: #ff4500;">10</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-d8522eb elementor-widget elementor-widget-image" data-id="d8522eb" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
															<img width="210" height="289" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-16.02.24.png" class="attachment-large size-large" alt="" loading="lazy" />															</div>
				</div>
				<div class="elementor-element elementor-element-fc2b397 elementor-widget elementor-widget-text-editor" data-id="fc2b397" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>We can use the <i>matplotlib</i> library for some simple plotting:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-66cc736 elementor-widget elementor-widget-text-editor" data-id="66cc736" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #ff7700; font-weight: bold;">import</span> matplotlib.<span style="color: black;">pyplot</span> <span style="color: #ff7700; font-weight: bold;">as</span> plt
plt.<span style="color: black;">style</span>.<span style="color: black;">use</span><span style="color: black;">(</span><span style="color: #483d8b;">'seaborn-darkgrid'</span><span style="color: black;">)</span>
Â 
plt.<span style="color: black;">figure</span><span style="color: black;">(</span>figsize <span style="color: #66cc66;">=</span> <span style="color: black;">(</span><span style="color: #ff4500;">14</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">5</span><span style="color: black;">)</span><span style="color: black;">)</span>
plt.<span style="color: black;">plot</span><span style="color: black;">(</span>data<span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'b'</span><span style="color: black;">)</span>
plt.<span style="color: black;">grid</span><span style="color: black;">(</span><span style="color: #008000;">True</span><span style="color: black;">)</span>
plt.<span style="color: black;">title</span><span style="color: black;">(</span><span style="color: #483d8b;">'{} Adj. Close Price'</span>.<span style="color: black;">format</span><span style="color: black;">(</span>ticker<span style="color: black;">)</span><span style="color: black;">)</span>
plt.<span style="color: black;">xlabel</span><span style="color: black;">(</span><span style="color: #483d8b;">'Trading Days'</span><span style="color: black;">)</span>
plt.<span style="color: black;">ylabel</span><span style="color: black;">(</span><span style="color: #483d8b;">'{} Adj. Close Price'</span>.<span style="color: black;">format</span><span style="color: black;">(</span>ticker<span style="color: black;">)</span><span style="color: black;">)</span>
plt.<span style="color: black;">show</span><span style="color: black;">(</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-7782459 elementor-widget elementor-widget-image" data-id="7782459" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
															<img width="828" height="325" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/aapl.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/aapl.png 828w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/aapl-300x118.png 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/aapl-768x301.png 768w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/aapl-500x196.png 500w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/aapl-800x314.png 800w" sizes="(max-width: 828px) 100vw, 828px" />															</div>
				</div>
				<div class="elementor-element elementor-element-8eeca05 elementor-widget elementor-widget-text-editor" data-id="8eeca05" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Let&#8217;s take a look at theÂ <a href="https://www.investopedia.com/terms/v/volatility.asp">volatility</a>Â of the ticker&#8217;s returns as well as the <a href="https://www.investopedia.com/terms/c/cumulativereturn.asp">cumulative returns</a> over the past year (252 trading days). To do so, we need to calculate the log returns and then calculate their standard deviation over a defined time window:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-b2e3692 elementor-widget elementor-widget-text-editor" data-id="b2e3692" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">data<span style="color: black;">[</span><span style="color: #483d8b;">'log_returns'</span><span style="color: black;">]</span> <span style="color: #66cc66;">=</span> np.<span style="color: black;">log</span><span style="color: black;">(</span>data<span style="color: black;">[</span><span style="color: #483d8b;">'adj_close_price'</span><span style="color: black;">]</span> / data<span style="color: black;">[</span><span style="color: #483d8b;">'adj_close_price'</span><span style="color: black;">]</span>.<span style="color: black;">shift</span><span style="color: black;">(</span><span style="color: #ff4500;">1</span><span style="color: black;">)</span><span style="color: black;">)</span>
data<span style="color: black;">[</span><span style="color: #483d8b;">'20_day_historical_volatility'</span><span style="color: black;">]</span> <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">100</span> * data<span style="color: black;">[</span><span style="color: #483d8b;">'log_returns'</span><span style="color: black;">]</span>.<span style="color: black;">rolling</span><span style="color: black;">(</span>window <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">20</span><span style="color: black;">)</span>.<span style="color: black;">std</span><span style="color: black;">(</span><span style="color: black;">)</span>
data.<span style="color: black;">tail</span><span style="color: black;">(</span><span style="color: #ff4500;">10</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-5da0b5e elementor-widget elementor-widget-image" data-id="5da0b5e" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
															<img width="482" height="292" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-15-at-10.37.02.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-15-at-10.37.02.png 482w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-15-at-10.37.02-300x182.png 300w" sizes="(max-width: 482px) 100vw, 482px" />															</div>
				</div>
				<div class="elementor-element elementor-element-194c6a7 elementor-widget elementor-widget-text-editor" data-id="194c6a7" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>We can leverage <i>matplotlib</i>&#8216;s subplots functionality to create a plot of the ticker&#8217;s price, log returns and volatility over the past year:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-45e4393 elementor-widget elementor-widget-text-editor" data-id="45e4393" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #212529;">fig</span><span style="color: #66cc66;">,</span><span style="color: #212529;"> axs </span><span style="color: #66cc66;">=</span><span style="color: #212529;"> plt.</span><span style="color: black;">subplots</span><span style="color: black;">(</span><span style="color: #ff4500;">3</span><span style="color: #66cc66;">,</span><span style="color: #212529;"> sharex </span><span style="color: #66cc66;">=</span> <span style="color: #008000;">True</span><span style="color: #66cc66;">,</span><span style="color: #212529;"> figsize </span><span style="color: #66cc66;">=</span> <span style="color: black;">(</span><span style="color: #ff4500;">20</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">10</span><span style="color: black;">)</span><span style="color: black;">)</span><span style="color: #212529;">
fig.</span><span style="color: black;">suptitle</span><span style="color: black;">(</span><span style="color: #483d8b;">'{} Analysis'</span><span style="color: #212529;">.</span><span style="color: black;">format</span><span style="color: black;">(</span><span style="color: #212529;">ticker</span><span style="color: black;">)</span><span style="color: #66cc66;">,</span><span style="color: #212529;"> fontsize </span><span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'xx-large'</span><span style="color: black;">)</span><span style="color: #212529;">
axs</span><span style="color: black;">[</span><span style="color: #ff4500;">0</span><span style="color: black;">]</span><span style="color: #212529;">.</span><span style="color: black;">plot</span><span style="color: black;">(</span><span style="color: #212529;">data</span><span style="color: black;">[</span><span style="color: #483d8b;">'adj_close_price'</span><span style="color: black;">]</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'r'</span><span style="color: #66cc66;">,</span><span style="color: #212529;"> label </span><span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'Adj. Close Price'</span><span style="color: black;">)</span><span style="color: #212529;">
axs</span><span style="color: black;">[</span><span style="color: #ff4500;">0</span><span style="color: black;">]</span><span style="color: #212529;">.</span><span style="color: black;">legend</span><span style="color: black;">(</span><span style="color: #212529;">loc </span><span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'best'</span><span style="color: black;">)</span><span style="color: #212529;">
Â 
axs</span><span style="color: black;">[</span><span style="color: #ff4500;">1</span><span style="color: black;">]</span><span style="color: #212529;">.</span><span style="color: black;">plot</span><span style="color: black;">(</span><span style="color: #212529;">data</span><span style="color: black;">[</span><span style="color: #483d8b;">'log_returns'</span><span style="color: black;">]</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'g'</span><span style="color: #66cc66;">,</span><span style="color: #212529;"> label </span><span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'Log Returns'</span><span style="color: black;">)</span><span style="color: #212529;">
axs</span><span style="color: black;">[</span><span style="color: #ff4500;">1</span><span style="color: black;">]</span><span style="color: #212529;">.</span><span style="color: black;">legend</span><span style="color: black;">(</span><span style="color: #212529;">loc </span><span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'best'</span><span style="color: black;">)</span><span style="color: #212529;">
Â 
axs</span><span style="color: black;">[</span><span style="color: #ff4500;">2</span><span style="color: black;">]</span><span style="color: #212529;">.</span><span style="color: black;">plot</span><span style="color: black;">(</span><span style="color: #212529;">data</span><span style="color: black;">[</span><span style="color: #483d8b;">'20_day_historical_volatility'</span><span style="color: black;">]</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'b'</span><span style="color: #66cc66;">,</span><span style="color: #212529;"> label </span><span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'20 day Historical Volatility'</span><span style="color: black;">)</span><span style="color: #212529;">
axs</span><span style="color: black;">[</span><span style="color: #ff4500;">2</span><span style="color: black;">]</span><span style="color: #212529;">.</span><span style="color: black;">legend</span><span style="color: black;">(</span><span style="color: #212529;">loc </span><span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'best'</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-3653f1a elementor-widget elementor-widget-image" data-id="3653f1a" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
												<figure class="wp-caption">
										<img width="1024" height="567" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/aapl-analysis-1024x567.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/aapl-analysis-1024x567.png 1024w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/aapl-analysis-300x166.png 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/aapl-analysis-768x425.png 768w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/aapl-analysis-500x277.png 500w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/aapl-analysis-800x443.png 800w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/aapl-analysis.png 1159w" sizes="(max-width: 1024px) 100vw, 1024px" />											<figcaption class="widget-image-caption wp-caption-text">Apple's Stock Price, Log &amp; Cumulative Returns, and 20 Day Historical Volatility.</figcaption>
										</figure>
									</div>
				</div>
				<div class="elementor-element elementor-element-d725138 elementor-widget elementor-widget-heading" data-id="d725138" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-medium">6.2. Detailed Data Retrieval &amp; Interactive Plotting (cufflinks)</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-3103f1c elementor-widget elementor-widget-text-editor" data-id="3103f1c" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Similarly, we can get a more detailed view of a specified ticker by calling the <i>get_ohlcv_df()</i> function and storing its result in a dataframe. Going forward, we will only need the past year&#8217;s prices, so we can reassign the data variable to its tail of 252 trading days.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-4bfa73a elementor-widget elementor-widget-text-editor" data-id="4bfa73a" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">ticker <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'AAPL'</span>
Â 
<span style="color: #808080; font-style: italic;"># Sophisticated data call</span>
data <span style="color: #66cc66;">=</span> ut.<span style="color: black;">get_ohlcv_df</span><span style="color: black;">(</span>ticker<span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>
data <span style="color: #66cc66;">=</span> data.<span style="color: black;">tail</span><span style="color: black;">(</span><span style="color: #ff4500;">252</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-a22ccf4 elementor-widget elementor-widget-image" data-id="a22ccf4" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
															<img width="548" height="309" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-16.07.20.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-16.07.20.png 548w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-16.07.20-300x169.png 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-16.07.20-500x282.png 500w" sizes="(max-width: 548px) 100vw, 548px" />															</div>
				</div>
				<div class="elementor-element elementor-element-7257afb elementor-widget elementor-widget-text-editor" data-id="7257afb" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p><i>Matplotlib</i> is not the only library we can use for creating some nice plots. <a href="https://github.com/santosjorge/cufflinks">Cufflinks</a>, for instance, is a great alternative that combines the power of <i>plotly</i>&nbsp;and <i>pandas</i>&nbsp;to produce interactive charts from dataframes.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-f55e85a elementor-widget elementor-widget-text-editor" data-id="f55e85a" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #ff7700; font-weight: bold;">import</span> cufflinks <span style="color: #ff7700; font-weight: bold;">as</span> cuff
<span style="color: #ff7700; font-weight: bold;">from</span> IPython.<span style="color: black;">display</span> <span style="color: #ff7700; font-weight: bold;">import</span> display<span style="color: #66cc66;">,</span> HTML
cuff.<span style="color: black;">set_config_file</span><span style="color: black;">(</span>sharing <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'public'</span><span style="color: #66cc66;">,</span> theme <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'pearl'</span><span style="color: #66cc66;">,</span> offline <span style="color: #66cc66;">=</span> <span style="color: #008000;">True</span><span style="color: black;">)</span>
Â 
data<span style="color: black;">[</span><span style="color: #483d8b;">'adj_close_price'</span><span style="color: black;">]</span>.<span style="color: black;">iplot</span><span style="color: black;">(</span>kind <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'line'</span><span style="color: #66cc66;">,</span> title <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'{} Line Chart'</span>.<span style="color: black;">format</span><span style="color: black;">(</span>ticker<span style="color: black;">)</span><span style="color: #66cc66;">,</span> xTitle <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'Trading Days'</span><span style="color: #66cc66;">,</span> yTitle <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'Adj. Close Price'</span><span style="color: black;">)</span>
data.<span style="color: black;">iplot</span><span style="color: black;">(</span>kind <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'candle'</span><span style="color: #66cc66;">,</span> rangeslider <span style="color: #66cc66;">=</span> <span style="color: #008000;">True</span><span style="color: #66cc66;">,</span> title <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'{} Candles'</span>.<span style="color: black;">format</span><span style="color: black;">(</span>ticker<span style="color: black;">)</span><span style="color: #66cc66;">,</span> xTitle <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'Trading Days'</span><span style="color: #66cc66;">,</span> yTitle <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'OHLC'</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-b6c5216 elementor-arrows-position-inside elementor-pagination-position-outside elementor-widget elementor-widget-image-carousel" data-id="b6c5216" data-element_type="widget" data-settings="{&quot;slides_to_show&quot;:&quot;1&quot;,&quot;navigation&quot;:&quot;both&quot;,&quot;autoplay&quot;:&quot;yes&quot;,&quot;pause_on_hover&quot;:&quot;yes&quot;,&quot;pause_on_interaction&quot;:&quot;yes&quot;,&quot;autoplay_speed&quot;:5000,&quot;infinite&quot;:&quot;yes&quot;,&quot;effect&quot;:&quot;slide&quot;,&quot;speed&quot;:500}" data-widget_type="image-carousel.default">
				<div class="elementor-widget-container">
					<div class="elementor-image-carousel-wrapper swiper-container" dir="ltr">
			<div class="elementor-image-carousel swiper-wrapper">
								<div class="swiper-slide"><figure class="swiper-slide-inner"><img class="swiper-slide-image" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/aapl-line.png" alt="kind = &#039;line&#039;" /><figcaption class="elementor-image-carousel-caption">kind = 'line'</figcaption></figure></div><div class="swiper-slide"><figure class="swiper-slide-inner"><img class="swiper-slide-image" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/aapl-candle.png" alt="kind = &#039;candle&#039;" /><figcaption class="elementor-image-carousel-caption">kind = 'candle'</figcaption></figure></div>			</div>
												<div class="swiper-pagination"></div>
													<div class="elementor-swiper-button elementor-swiper-button-prev">
						<i class="eicon-chevron-left" aria-hidden="true"></i>
						<span class="elementor-screen-only">Previous</span>
					</div>
					<div class="elementor-swiper-button elementor-swiper-button-next">
						<i class="eicon-chevron-right" aria-hidden="true"></i>
						<span class="elementor-screen-only">Next</span>
					</div>
									</div>
				</div>
				</div>
				<div class="elementor-element elementor-element-7d1853e elementor-widget elementor-widget-text-editor" data-id="7d1853e" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p><i>Cufflinks</i> also offers the powerful <i>QuantFigure</i> class that generates a persistent graph object which can be enhanced with several technical indicators such as <a href="https://www.investopedia.com/terms/b/bollingerbands.asp">Bollinger Bands</a>, <a href="https://www.investopedia.com/terms/s/sma.asp">Simple Moving Averages</a>,&nbsp;<a href="https://www.investopedia.com/terms/r/rsi.asp">RSI</a> and <a href="https://www.investopedia.com/terms/m/macd.asp">MACD</a>:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-5ecc4f5 elementor-widget elementor-widget-text-editor" data-id="5ecc4f5" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">qf <span style="color: #66cc66;">=</span> cuff.<span style="color: black;">QuantFig</span><span style="color: black;">(</span>data<span style="color: #66cc66;">,</span> title <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'{} Quant Figure'</span>.<span style="color: black;">format</span><span style="color: black;">(</span>ticker<span style="color: black;">)</span><span style="color: #66cc66;">,</span> legend <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'top'</span><span style="color: #66cc66;">,</span> name <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'data'</span><span style="color: black;">)</span>
qf.<span style="color: black;">add_bollinger_bands</span><span style="color: black;">(</span>periods <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">20</span><span style="color: #66cc66;">,</span> boll_std <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">2</span><span style="color: black;">)</span>
qf.<span style="color: black;">add_volume</span><span style="color: black;">(</span><span style="color: black;">)</span>
qf.<span style="color: black;">iplot</span><span style="color: black;">(</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-fa5b9aa elementor-widget elementor-widget-image" data-id="fa5b9aa" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
												<figure class="wp-caption">
										<img width="1024" height="358" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/aapl-qf-1024x358.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/aapl-qf-1024x358.png 1024w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/aapl-qf-300x105.png 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/aapl-qf-768x268.png 768w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/aapl-qf-500x175.png 500w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/aapl-qf-800x280.png 800w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/aapl-qf-1280x447.png 1280w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/aapl-qf.png 1288w" sizes="(max-width: 1024px) 100vw, 1024px" />											<figcaption class="widget-image-caption wp-caption-text">Cufflink's QuantFigure is a powerful plotting class.</figcaption>
										</figure>
									</div>
				</div>
				<div class="elementor-element elementor-element-07a09b7 elementor-widget elementor-widget-text-editor" data-id="07a09b7" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>If you want to go all out and generate a very detailed report on a stock&#8217;s price and technical analysis, you can switch from <i>inline</i> plots to <i>browser</i> based plots as follows:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-4e85da1 elementor-widget elementor-widget-text-editor" data-id="4e85da1" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #ff7700; font-weight: bold;">import</span> plotly.<span style="color: black;">io</span> <span style="color: #ff7700; font-weight: bold;">as</span> pio
pio.<span style="color: black;">renderers</span>.<span style="color: black;">default</span> <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">"browser"</span>
Â 
qf <span style="color: #66cc66;">=</span> cuff.<span style="color: black;">QuantFig</span><span style="color: black;">(</span>data<span style="color: #66cc66;">,</span> title <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'{} Technical Analysis'</span>.<span style="color: black;">format</span><span style="color: black;">(</span>ticker<span style="color: black;">)</span><span style="color: #66cc66;">,</span> legend <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'top'</span><span style="color: #66cc66;">,</span> name <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'data'</span><span style="color: black;">)</span>
qf.<span style="color: black;">add_bollinger_bands</span><span style="color: black;">(</span>periods <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">20</span><span style="color: #66cc66;">,</span> boll_std <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">2</span><span style="color: #66cc66;">,</span> colors <span style="color: #66cc66;">=</span> <span style="color: black;">[</span><span style="color: #483d8b;">'magenta'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'grey'</span><span style="color: black;">]</span><span style="color: #66cc66;">,</span> fill <span style="color: #66cc66;">=</span> <span style="color: #008000;">True</span><span style="color: black;">)</span>
qf.<span style="color: black;">add_sma</span><span style="color: black;">(</span><span style="color: black;">[</span><span style="color: #ff4500;">50</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">150</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">200</span><span style="color: black;">]</span><span style="color: #66cc66;">,</span> width <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">3</span><span style="color: #66cc66;">,</span> color <span style="color: #66cc66;">=</span> <span style="color: black;">[</span><span style="color: #483d8b;">'green'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'lightgreen'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'lightblue'</span><span style="color: black;">]</span><span style="color: #66cc66;">,</span> legendgroup <span style="color: #66cc66;">=</span> <span style="color: #008000;">True</span><span style="color: black;">)</span>
qf.<span style="color: black;">add_rsi</span><span style="color: black;">(</span>periods <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">20</span><span style="color: #66cc66;">,</span> color <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'java'</span><span style="color: black;">)</span>
qf.<span style="color: black;">add_macd</span><span style="color: black;">(</span><span style="color: black;">)</span>
qf.<span style="color: black;">add_volume</span><span style="color: black;">(</span><span style="color: black;">)</span>
qf.<span style="color: black;">iplot</span><span style="color: black;">(</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-4f67660 elementor-widget elementor-widget-image" data-id="4f67660" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
												<figure class="wp-caption">
										<img width="1024" height="755" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/newplot-1-1024x755.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/newplot-1-1024x755.png 1024w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/newplot-1-300x221.png 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/newplot-1-768x566.png 768w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/newplot-1-1536x1132.png 1536w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/newplot-1-500x369.png 500w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/newplot-1-800x590.png 800w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/newplot-1-1280x943.png 1280w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/newplot-1.png 1704w" sizes="(max-width: 1024px) 100vw, 1024px" />											<figcaption class="widget-image-caption wp-caption-text">Full Technical Analysis on Apple with cufflink's QuantFigure.</figcaption>
										</figure>
									</div>
				</div>
				<div class="elementor-element elementor-element-a7d140e elementor-widget elementor-widget-heading" data-id="a7d140e" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-medium">6.3.  Comparing Tickers &amp; Indices</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-cd34994 elementor-widget elementor-widget-text-editor" data-id="cd34994" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>It is standard industry practice to closely monitor the performance of indices such as the <a href="https://en.wikipedia.org/wiki/S%26P_500">S&amp;P 500</a> or the <a href="https://en.wikipedia.org/wiki/Dow_Jones_Industrial_Average">Dow Jones Industrial Average</a> (for Germany, the <a href="https://en.wikipedia.org/wiki/DAX">DAX</a> is the most renowned index), and most often compare individual portfolio performance against &#8216;the market&#8217;. The exact calculation of these indices is not trivial and depends amongst others on the market capitalization of their constituents. Luckily, though, there exist ETFs that closely track and imitate such indices, e.g. theÂ <a href="https://www.investopedia.com/articles/investing/122215/spy-spdr-sp-500-trust-etf.asp">SPY (SPDR S&amp;P 500 Trust ETF)</a>, the <a href="https://www.invesco.com/qqq-etf/en/home.html">QQQ (Invesco QQQ Trust ETF)</a>Â for the <a href="https://en.wikipedia.org/wiki/Nasdaq-100">Nasdaq-100</a>, or the <a href="https://www.spdrgoldshares.com/">GLD (SPDR Gold Trust ETF)</a>.</p><p>Even better, we already have pricing data for these ETFs in our database:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-e431f09 elementor-widget elementor-widget-text-editor" data-id="e431f09" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">spy <span style="color: #66cc66;">=</span> ut.<span style="color: black;">get_price_df</span><span style="color: black;">(</span><span style="color: #483d8b;">'SPY'</span><span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>
qqq <span style="color: #66cc66;">=</span> ut.<span style="color: black;">get_price_df</span><span style="color: black;">(</span><span style="color: #483d8b;">'QQQ'</span><span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>
gld <span style="color: #66cc66;">=</span> ut.<span style="color: black;">get_price_df</span><span style="color: black;">(</span><span style="color: #483d8b;">'GLD'</span><span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>
Â 
<span style="color: #ff7700; font-weight: bold;">import</span> matplotlib.<span style="color: black;">pyplot</span> <span style="color: #ff7700; font-weight: bold;">as</span> plt
plt.<span style="color: black;">style</span>.<span style="color: black;">use</span><span style="color: black;">(</span><span style="color: #483d8b;">'seaborn-darkgrid'</span><span style="color: black;">)</span>
Â 
fig<span style="color: #66cc66;">,</span> axs <span style="color: #66cc66;">=</span> plt.<span style="color: black;">subplots</span><span style="color: black;">(</span><span style="color: #ff4500;">3</span><span style="color: #66cc66;">,</span> sharex <span style="color: #66cc66;">=</span> <span style="color: #008000;">True</span><span style="color: #66cc66;">,</span> figsize <span style="color: #66cc66;">=</span> <span style="color: black;">(</span><span style="color: #ff4500;">20</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">10</span><span style="color: black;">)</span><span style="color: black;">)</span>
fig.<span style="color: black;">suptitle</span><span style="color: black;">(</span><span style="color: #483d8b;">'Index Tracking ETFs'</span><span style="color: #66cc66;">,</span> fontsize <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'xx-large'</span><span style="color: black;">)</span>
axs<span style="color: black;">[</span><span style="color: #ff4500;">0</span><span style="color: black;">]</span>.<span style="color: black;">plot</span><span style="color: black;">(</span>spy<span style="color: black;">[</span><span style="color: #483d8b;">'adj_close_price'</span><span style="color: black;">]</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'r'</span><span style="color: #66cc66;">,</span> label <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'SPY'</span><span style="color: black;">)</span>
axs<span style="color: black;">[</span><span style="color: #ff4500;">0</span><span style="color: black;">]</span>.<span style="color: black;">legend</span><span style="color: black;">(</span>loc <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'best'</span><span style="color: black;">)</span>
Â 
axs<span style="color: black;">[</span><span style="color: #ff4500;">1</span><span style="color: black;">]</span>.<span style="color: black;">plot</span><span style="color: black;">(</span>qqq<span style="color: black;">[</span><span style="color: #483d8b;">'adj_close_price'</span><span style="color: black;">]</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'g'</span><span style="color: #66cc66;">,</span> label <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'QQQ'</span><span style="color: black;">)</span>
axs<span style="color: black;">[</span><span style="color: #ff4500;">1</span><span style="color: black;">]</span>.<span style="color: black;">legend</span><span style="color: black;">(</span>loc <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'best'</span><span style="color: black;">)</span>
Â 
axs<span style="color: black;">[</span><span style="color: #ff4500;">2</span><span style="color: black;">]</span>.<span style="color: black;">plot</span><span style="color: black;">(</span>gld<span style="color: black;">[</span><span style="color: #483d8b;">'adj_close_price'</span><span style="color: black;">]</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'b'</span><span style="color: #66cc66;">,</span> label <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'GLD'</span><span style="color: black;">)</span>
axs<span style="color: black;">[</span><span style="color: #ff4500;">2</span><span style="color: black;">]</span>.<span style="color: black;">legend</span><span style="color: black;">(</span>loc <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'best'</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-3066e63 elementor-widget elementor-widget-image" data-id="3066e63" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
															<img width="1024" height="572" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/etfs-1024x572.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/etfs-1024x572.png 1024w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/etfs-300x167.png 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/etfs-768x429.png 768w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/etfs-500x279.png 500w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/etfs-800x447.png 800w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/etfs.png 1150w" sizes="(max-width: 1024px) 100vw, 1024px" />															</div>
				</div>
				<div class="elementor-element elementor-element-ce63da4 elementor-widget elementor-widget-heading" data-id="ce63da4" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h6 class="elementor-heading-title elementor-size-small">6.3.1. Index Constituents</h6>		</div>
				</div>
				<div class="elementor-element elementor-element-157d67f elementor-widget elementor-widget-text-editor" data-id="157d67f" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Having the SPY in the SMD is very valuable and will serve us well later when we&#8217;re actually writing trading strategies and comparing their performance to that of the S&amp;P 500. But wouldn&#8217;t it also be nice to get a list of all the 500 (actually 505) companies within the S&amp;P 500 and cherry pick a few of them for some basic statistical comparison?</p><p>Let&#8217;s write some functions to scrape the <a href="https://en.wikipedia.org/wiki/List_of_S%26P_500_companies">Wikipedia page of the S&amp;P 500 constituents</a> and to get some information on these tickers from our SMD:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-462fb75 elementor-widget elementor-widget-text-editor" data-id="462fb75" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #ff7700; font-weight: bold;">def</span> get_SP500_constituents<span style="color: black;">(</span><span style="color: black;">)</span>:
  <span style="color: #483d8b;">"""
  Scrapes the Wikipedia article on S&amp;P500 constituents and returns a list of their tickers
  :return: list of S&amp;P500 tickers
  """</span>
  url <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'https://en.wikipedia.org/wiki/List_of_S%26P_500_companies'</span>
  page <span style="color: #66cc66;">=</span> requests.<span style="color: black;">get</span><span style="color: black;">(</span>url<span style="color: black;">)</span> <span style="color: #808080; font-style: italic;"># handles the contents of the website</span>
  doc <span style="color: #66cc66;">=</span> lh.<span style="color: black;">fromstring</span><span style="color: black;">(</span>page.<span style="color: black;">content</span><span style="color: black;">)</span> <span style="color: #808080; font-style: italic;"># stores website contents</span>
Â 
  <span style="color: #808080; font-style: italic;"># data is stored in a table &lt;tr&gt;..&lt;/tr&gt;</span>
  tr_elements <span style="color: #66cc66;">=</span> doc.<span style="color: black;">xpath</span><span style="color: black;">(</span><span style="color: #483d8b;">'//tr'</span><span style="color: black;">)</span>
  cols <span style="color: #66cc66;">=</span> <span style="color: black;">[</span><span style="color: black;">]</span>
Â 
  <span style="color: #808080; font-style: italic;"># for each row, store each first element (header) and an empty list</span>
  <span style="color: #ff7700; font-weight: bold;">for</span> t <span style="color: #ff7700; font-weight: bold;">in</span> tr_elements<span style="color: black;">[</span><span style="color: #ff4500;">0</span><span style="color: black;">]</span>:
    name <span style="color: #66cc66;">=</span> t.<span style="color: black;">text_content</span><span style="color: black;">(</span><span style="color: black;">)</span>
    cols.<span style="color: black;">append</span><span style="color: black;">(</span><span style="color: black;">(</span>name<span style="color: #66cc66;">,</span> <span style="color: black;">[</span><span style="color: black;">]</span><span style="color: black;">)</span><span style="color: black;">)</span>
Â 
  <span style="color: #808080; font-style: italic;"># actual data is stored on the second row onwards</span>
  <span style="color: #ff7700; font-weight: bold;">for</span> j <span style="color: #ff7700; font-weight: bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">(</span><span style="color: #ff4500;">1</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">len</span><span style="color: black;">(</span>tr_elements<span style="color: black;">)</span><span style="color: black;">)</span>:
    T <span style="color: #66cc66;">=</span> tr_elements<span style="color: black;">[</span>j<span style="color: black;">]</span> <span style="color: #808080; font-style: italic;"># T is j'th row</span>
Â 
    <span style="color: #808080; font-style: italic;"># If row is not of size 9 (hard-coded), the //tr data is not from our table</span>
    <span style="color: #ff7700; font-weight: bold;">if</span> <span style="color: #008000;">len</span><span style="color: black;">(</span>T<span style="color: black;">)</span> <span style="color: #66cc66;">!=</span> <span style="color: #ff4500;">9</span>:
      <span style="color: #ff7700; font-weight: bold;">break</span>
Â 
    i <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">0</span> <span style="color: #808080; font-style: italic;"># column index</span>
Â 
    <span style="color: #808080; font-style: italic;"># iterate through each row element</span>
    <span style="color: #ff7700; font-weight: bold;">for</span> t <span style="color: #ff7700; font-weight: bold;">in</span> T.<span style="color: black;">iterchildren</span><span style="color: black;">(</span><span style="color: black;">)</span>:
      data <span style="color: #66cc66;">=</span> t.<span style="color: black;">text_content</span><span style="color: black;">(</span><span style="color: black;">)</span>
      cols<span style="color: black;">[</span>i<span style="color: black;">]</span><span style="color: black;">[</span><span style="color: #ff4500;">1</span><span style="color: black;">]</span>.<span style="color: black;">append</span><span style="color: black;">(</span>data<span style="color: black;">)</span> <span style="color: #808080; font-style: italic;"># append data to empty list of i'th column</span>
      i +<span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span> <span style="color: #808080; font-style: italic;"># next column</span>
Â 
  col_names <span style="color: #66cc66;">=</span> <span style="color: black;">{</span>title:column <span style="color: #ff7700; font-weight: bold;">for</span> <span style="color: black;">(</span>title<span style="color: #66cc66;">,</span> column<span style="color: black;">)</span> <span style="color: #ff7700; font-weight: bold;">in</span> cols<span style="color: black;">}</span>
  df <span style="color: #66cc66;">=</span> pd.<span style="color: black;">DataFrame</span><span style="color: black;">(</span>col_names<span style="color: black;">)</span>
  tickers <span style="color: #66cc66;">=</span> df<span style="color: black;">[</span><span style="color: #483d8b;">'Symbol<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: black;">]</span>.<span style="color: #008000;">str</span>.<span style="color: black;">replace</span><span style="color: black;">(</span><span style="color: #483d8b;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">''</span><span style="color: black;">)</span>.<span style="color: black;">to_list</span><span style="color: black;">(</span><span style="color: black;">)</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">return</span> tickers</pre>						</div>
				</div>
				<div class="elementor-element elementor-element-0d6ed70 elementor-widget elementor-widget-text-editor" data-id="0d6ed70" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>This function closely followed <a href="https://towardsdatascience.com/web-scraping-html-tables-with-python-c9baba21059">Syed Sadat Nazrul&#8217;s article</a> on how to scrape a website&#8217;s table, so best head over there for a detailed explanation. Basically though, we iterate over each row of the table and store its first element (i.e. the header) in a list of column names. Then, we iterate over the remaining rows and add their contents to a dataframe. Since I&#8217;m only interested in the tickers, I&#8217;m just returning the <i>Symbol</i> column, casted to a list.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-3fe8347 elementor-widget elementor-widget-text-editor" data-id="3fe8347" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #ff7700; font-weight: bold;">def</span> get_ticker_info_from_list<span style="color: black;">(</span>ticker_list<span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>:
  <span style="color: #483d8b;">"""
  Returns a dataframe with instrument information for a given list of tickers
  :param index: list of tickers
  :param conn: MySQL database connection
  :return: dataframe of instrument information
  """</span>
  ticker_df <span style="color: #66cc66;">=</span> pd.<span style="color: black;">DataFrame</span><span style="color: black;">(</span><span style="color: black;">)</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">for</span> i <span style="color: #ff7700; font-weight: bold;">in</span> <span style="color: #008000;">range</span><span style="color: black;">(</span><span style="color: #ff4500;">0</span><span style="color: #66cc66;">,</span> <span style="color: #008000;">len</span><span style="color: black;">(</span>ticker_list<span style="color: black;">)</span><span style="color: black;">)</span>:
    <span style="color: #ff7700; font-weight: bold;">try</span>:
      sql <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">"""
        SELECT ex.acronym, ins.ticker, ins.name, ins.sector, ins.industry, ins.country, ins.website
        FROM exchange AS ex
        INNER JOIN instrument AS ins
        ON ex.id = ins.exchange_id
        WHERE ins.ticker = '{}';"""</span>.<span style="color: black;">format</span><span style="color: black;">(</span>ticker_list<span style="color: black;">[</span>i<span style="color: black;">]</span><span style="color: black;">)</span>
      tmp <span style="color: #66cc66;">=</span> pd.<span style="color: black;">read_sql</span><span style="color: black;">(</span>sql<span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>
      ticker_df <span style="color: #66cc66;">=</span> ticker_df.<span style="color: black;">append</span><span style="color: black;">(</span>tmp<span style="color: #66cc66;">,</span> ignore_index <span style="color: #66cc66;">=</span> <span style="color: #008000;">True</span><span style="color: black;">)</span>
    <span style="color: #ff7700; font-weight: bold;">except</span> <span style="color: #008000;">Exception</span> <span style="color: #ff7700; font-weight: bold;">as</span> e:
      <span style="color: #ff7700; font-weight: bold;">continue</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">return</span> ticker_df</pre>						</div>
				</div>
				<div class="elementor-element elementor-element-7a2f71b elementor-widget elementor-widget-text-editor" data-id="7a2f71b" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>By calling these two new functions, we get a dataframe with some key information on every ticker included in the S&amp;P 500:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-78242de elementor-widget elementor-widget-text-editor" data-id="78242de" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">sp500 <span style="color: #66cc66;">=</span> ut.<span style="color: black;">get_SP500_constituents</span><span style="color: black;">(</span><span style="color: black;">)</span> <span style="color: #808080; font-style: italic;"># get list of S&amp;P 500 tickers</span>
sp500_df <span style="color: #66cc66;">=</span> ut.<span style="color: black;">get_ticker_info_from_list</span><span style="color: black;">(</span>sp500<span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-d62327e elementor-widget elementor-widget-image" data-id="d62327e" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
												<figure class="wp-caption">
										<img width="1024" height="251" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-30-at-17.46.29-1024x251.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-30-at-17.46.29-1024x251.png 1024w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-30-at-17.46.29-300x73.png 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-30-at-17.46.29-768x188.png 768w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-30-at-17.46.29-500x122.png 500w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-30-at-17.46.29-800x196.png 800w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Screen-Shot-2021-11-30-at-17.46.29.png 1181w" sizes="(max-width: 1024px) 100vw, 1024px" />											<figcaption class="widget-image-caption wp-caption-text">S&amp;P 500 index constituents information from the database.</figcaption>
										</figure>
									</div>
				</div>
				<div class="elementor-element elementor-element-aaa6722 elementor-widget elementor-widget-heading" data-id="aaa6722" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h6 class="elementor-heading-title elementor-size-small">6.3.2. Comparing Tickers</h6>		</div>
				</div>
				<div class="elementor-element elementor-element-c15621b elementor-widget elementor-widget-text-editor" data-id="c15621b" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Now that we&#8217;re able to query our database for (theoretically any) index constituents, let&#8217;s write yet another function to load in closing prices for a subset of S&amp;P 500 tickers:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-8caeefa elementor-widget elementor-widget-text-editor" data-id="8caeefa" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #ff7700; font-weight: bold;">def</span> compare_tickers<span style="color: black;">(</span>tickers<span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>:
  <span style="color: #483d8b;">"""
  Takes in a list of tickers, queries the database for their closing prices and returns a dataframe with all values
  :param tickers: list of tickers for which closing prices should be returned
  :param conn: MySQL database connection
  :return: dataframe with closing prices for the ticker list
  """</span>
  tickers_df <span style="color: #66cc66;">=</span> pd.<span style="color: black;">DataFrame</span><span style="color: black;">(</span><span style="color: black;">)</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">for</span> ticker <span style="color: #ff7700; font-weight: bold;">in</span> tickers:
    tmp <span style="color: #66cc66;">=</span> get_price_df<span style="color: black;">(</span>ticker<span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>
    <span style="color: #ff7700; font-weight: bold;">if</span> tmp.<span style="color: black;">columns</span><span style="color: black;">[</span><span style="color: #ff4500;">0</span><span style="color: black;">]</span> <span style="color: #66cc66;">==</span> <span style="color: #483d8b;">'adj_close_price'</span>:
      <span style="color: #808080; font-style: italic;"># ticker is a Yahoo ticker</span>
      tmp <span style="color: #66cc66;">=</span> tmp.<span style="color: black;">rename</span><span style="color: black;">(</span>columns <span style="color: #66cc66;">=</span> <span style="color: black;">{</span><span style="color: #483d8b;">'adj_close_price'</span> : ticker<span style="color: black;">}</span><span style="color: black;">)</span>
    <span style="color: #ff7700; font-weight: bold;">else</span>:
      <span style="color: #808080; font-style: italic;"># ticker is an Alpaca ticker</span>
      tmp <span style="color: #66cc66;">=</span> tmp.<span style="color: black;">rename</span><span style="color: black;">(</span>columns <span style="color: #66cc66;">=</span> <span style="color: black;">{</span><span style="color: #483d8b;">'close_price'</span> : ticker<span style="color: black;">}</span><span style="color: black;">)</span>
    tickers_df <span style="color: #66cc66;">=</span> pd.<span style="color: black;">concat</span><span style="color: black;">(</span><span style="color: black;">[</span>tickers_df<span style="color: #66cc66;">,</span> tmp<span style="color: black;">]</span><span style="color: #66cc66;">,</span> axis <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1</span><span style="color: black;">)</span>
Â 
  <span style="color: #ff7700; font-weight: bold;">return</span> tickers_df.<span style="color: black;">sort_values</span><span style="color: black;">(</span>by <span style="color: #66cc66;">=</span> <span style="color: black;">[</span><span style="color: #483d8b;">'price_date'</span><span style="color: black;">]</span><span style="color: #66cc66;">,</span> ascending <span style="color: #66cc66;">=</span> <span style="color: #008000;">True</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-f2e4666 elementor-widget elementor-widget-text-editor" data-id="f2e4666" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">tickers <span style="color: #66cc66;">=</span> <span style="color: black;">[</span><span style="color: #483d8b;">'AAPL'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'AMZN'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'FB'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'F'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'GOOG'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'JNJ'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'SPY'</span><span style="color: black;">]</span>
Â 
tickers_df <span style="color: #66cc66;">=</span> ut.<span style="color: black;">compare_tickers</span><span style="color: black;">(</span>tickers<span style="color: #66cc66;">,</span> conn<span style="color: black;">)</span>
tickers_df <span style="color: #66cc66;">=</span> tickers_df.<span style="color: black;">tail</span><span style="color: black;">(</span><span style="color: #ff4500;">252</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-4c08004 elementor-widget elementor-widget-image" data-id="4c08004" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
												<figure class="wp-caption">
										<img width="715" height="308" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-16.18.49.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-16.18.49.png 715w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-16.18.49-300x129.png 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-16.18.49-500x215.png 500w" sizes="(max-width: 715px) 100vw, 715px" />											<figcaption class="widget-image-caption wp-caption-text">Closing prices for a selection of S&amp;P 500 companies over the past year.</figcaption>
										</figure>
									</div>
				</div>
				<div class="elementor-element elementor-element-2ec6a2f elementor-widget elementor-widget-text-editor" data-id="2ec6a2f" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>We don&#8217;t want to compare the individual price histories of these tickers but rather their returns. So, with a little help of <i>pandas</i>&#8216; <i>df.pct_change()</i> function, we can easily calculate the returns of our ticker selection:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-d5fd0ea elementor-widget elementor-widget-text-editor" data-id="d5fd0ea" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">returns_df <span style="color: #66cc66;">=</span> tickers_df.<span style="color: black;">pct_change</span><span style="color: black;">(</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-e972f6c elementor-widget elementor-widget-image" data-id="e972f6c" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
												<figure class="wp-caption">
										<img width="645" height="308" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-16.19.21.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-16.19.21.png 645w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-16.19.21-300x143.png 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-16.19.21-500x239.png 500w" sizes="(max-width: 645px) 100vw, 645px" />											<figcaption class="widget-image-caption wp-caption-text">Returns for a selection of S&amp;P 500 companies over the past year.</figcaption>
										</figure>
									</div>
				</div>
				<div class="elementor-element elementor-element-27ff693 elementor-widget elementor-widget-text-editor" data-id="27ff693" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>To compare the correlation of returns for these tickers, we can make use of the <i>seaborn</i> library and its <i>jointplot()</i> and <i>pairplot()</i> functions:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-c4c570b elementor-widget elementor-widget-text-editor" data-id="c4c570b" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #ff7700; font-weight: bold;">import</span> matplotlib.<span style="color: black;">pyplot</span> <span style="color: #ff7700; font-weight: bold;">as</span> plt
<span style="color: #ff7700; font-weight: bold;">import</span> seaborn <span style="color: #ff7700; font-weight: bold;">as</span> sns
sns.<span style="color: black;">set_style</span><span style="color: black;">(</span><span style="color: #483d8b;">'whitegrid'</span><span style="color: black;">)</span>
Â 
sns.<span style="color: black;">jointplot</span><span style="color: black;">(</span><span style="color: #483d8b;">'AAPL'</span><span style="color: #66cc66;">,</span> <span style="color: #483d8b;">'GOOG'</span><span style="color: #66cc66;">,</span> returns_df<span style="color: #66cc66;">,</span> kind <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'scatter'</span><span style="color: black;">)</span>
sns.<span style="color: black;">pairplot</span><span style="color: black;">(</span>returns_df.<span style="color: black;">dropna</span><span style="color: black;">(</span><span style="color: black;">)</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-7f190b3 elementor-arrows-position-inside elementor-pagination-position-outside elementor-widget elementor-widget-image-carousel" data-id="7f190b3" data-element_type="widget" data-settings="{&quot;slides_to_show&quot;:&quot;1&quot;,&quot;navigation&quot;:&quot;both&quot;,&quot;autoplay&quot;:&quot;yes&quot;,&quot;pause_on_hover&quot;:&quot;yes&quot;,&quot;pause_on_interaction&quot;:&quot;yes&quot;,&quot;autoplay_speed&quot;:5000,&quot;infinite&quot;:&quot;yes&quot;,&quot;effect&quot;:&quot;slide&quot;,&quot;speed&quot;:500}" data-widget_type="image-carousel.default">
				<div class="elementor-widget-container">
					<div class="elementor-image-carousel-wrapper swiper-container" dir="ltr">
			<div class="elementor-image-carousel swiper-wrapper">
								<div class="swiper-slide"><figure class="swiper-slide-inner"><img class="swiper-slide-image" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/joint.png" alt="JointPlot" /><figcaption class="elementor-image-carousel-caption">JointPlot</figcaption></figure></div><div class="swiper-slide"><figure class="swiper-slide-inner"><img class="swiper-slide-image" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/pair.png" alt="PairPlot" /><figcaption class="elementor-image-carousel-caption">PairPlot</figcaption></figure></div>			</div>
												<div class="swiper-pagination"></div>
													<div class="elementor-swiper-button elementor-swiper-button-prev">
						<i class="eicon-chevron-left" aria-hidden="true"></i>
						<span class="elementor-screen-only">Previous</span>
					</div>
					<div class="elementor-swiper-button elementor-swiper-button-next">
						<i class="eicon-chevron-right" aria-hidden="true"></i>
						<span class="elementor-screen-only">Next</span>
					</div>
									</div>
				</div>
				</div>
				<div class="elementor-element elementor-element-4f34b71 elementor-widget elementor-widget-text-editor" data-id="4f34b71" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>A different representation of ticker correlations can be achieved via a heatmap:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-4d33a8b elementor-widget elementor-widget-text-editor" data-id="4d33a8b" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">corr_df <span style="color: #66cc66;">=</span> returns_df.<span style="color: black;">corr</span><span style="color: black;">(</span>method <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'pearson'</span><span style="color: black;">)</span>
mask <span style="color: #66cc66;">=</span> np.<span style="color: black;">zeros_like</span><span style="color: black;">(</span>corr_df<span style="color: black;">)</span>
mask<span style="color: black;">[</span>np.<span style="color: black;">triu_indices_from</span><span style="color: black;">(</span>mask<span style="color: black;">)</span><span style="color: black;">]</span> <span style="color: #66cc66;">=</span> <span style="color: #008000;">True</span>
Â 
plt.<span style="color: black;">figure</span><span style="color: black;">(</span>figsize <span style="color: #66cc66;">=</span> <span style="color: black;">(</span><span style="color: #ff4500;">14</span><span style="color: #66cc66;">,</span> <span style="color: #ff4500;">10</span><span style="color: black;">)</span><span style="color: black;">)</span>
plt.<span style="color: black;">title</span><span style="color: black;">(</span><span style="color: #483d8b;">'Correlation Heatmap'</span><span style="color: #66cc66;">,</span> fontsize <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'xx-large'</span><span style="color: black;">)</span>
sns.<span style="color: black;">heatmap</span><span style="color: black;">(</span>corr_df<span style="color: #66cc66;">,</span> cmap <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'RdYlGn'</span><span style="color: #66cc66;">,</span> vmax <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">1.0</span><span style="color: #66cc66;">,</span> vmin <span style="color: #66cc66;">=</span> -<span style="color: #ff4500;">1.0</span> <span style="color: #66cc66;">,</span> mask <span style="color: #66cc66;">=</span> mask<span style="color: #66cc66;">,</span> linewidths <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">8.0</span><span style="color: black;">)</span>
plt.<span style="color: black;">yticks</span><span style="color: black;">(</span>rotation <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">0</span><span style="color: black;">)</span> 
plt.<span style="color: black;">xticks</span><span style="color: black;">(</span>rotation <span style="color: #66cc66;">=</span> <span style="color: #ff4500;">90</span><span style="color: black;">)</span> 
plt.<span style="color: black;">show</span><span style="color: black;">(</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-f5d964e elementor-widget elementor-widget-image" data-id="f5d964e" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
															<img width="769" height="610" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/corr.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/corr.png 769w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/corr-300x238.png 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/corr-500x397.png 500w" sizes="(max-width: 769px) 100vw, 769px" />															</div>
				</div>
				<div class="elementor-element elementor-element-4cb7989 elementor-widget elementor-widget-text-editor" data-id="4cb7989" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>From this representation we can easily see that AAPL and GOOG are most closely correlated to the SPY and that the typical tech stocks are intercorrelated aswell (no surprise there). Ford and Johnson &amp; Johnson show no correlation at all to the other tickers, which makes sense given that they are in completely different industries.</p><p>Lastly, we can calculate the normalized returns of our ticker selection for the time frame of one year:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-f8cbaa1 elementor-widget elementor-widget-text-editor" data-id="f8cbaa1" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">returns_norm_df <span style="color: #66cc66;">=</span> tickers_df / tickers_df.<span style="color: black;">iloc</span><span style="color: black;">[</span><span style="color: #ff4500;">0</span> <span style="color: #66cc66;">,</span> :<span style="color: black;">]</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-eca330a elementor-widget elementor-widget-image" data-id="eca330a" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
												<figure class="wp-caption">
										<img width="604" height="309" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-16.21.32.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-16.21.32.png 604w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-16.21.32-300x153.png 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/Screen-Shot-2021-12-06-at-16.21.32-500x256.png 500w" sizes="(max-width: 604px) 100vw, 604px" />											<figcaption class="widget-image-caption wp-caption-text">Normalized returns for a selection of S&amp;P 500 companies over the past year.</figcaption>
										</figure>
									</div>
				</div>
				<div class="elementor-element elementor-element-e91f709 elementor-widget elementor-widget-text-editor" data-id="e91f709" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre class="python" style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;"><span style="color: #ff7700; font-weight: bold;">import</span> cufflinks <span style="color: #ff7700; font-weight: bold;">as</span> cuff
<span style="color: #ff7700; font-weight: bold;">from</span> IPython.<span style="color: black;">display</span> <span style="color: #ff7700; font-weight: bold;">import</span> display<span style="color: #66cc66;">,</span> HTML
cuff.<span style="color: black;">set_config_file</span><span style="color: black;">(</span>sharing <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'public'</span><span style="color: #66cc66;">,</span> theme <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'pearl'</span><span style="color: #66cc66;">,</span> offline <span style="color: #66cc66;">=</span> <span style="color: #008000;">True</span><span style="color: black;">)</span>
Â 
returns_norm_df.<span style="color: black;">iplot</span><span style="color: black;">(</span>title <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'Normalized Returns of Ticker Selection'</span><span style="color: #66cc66;">,</span> xTitle <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'Dates'</span><span style="color: #66cc66;">,</span> yTitle <span style="color: #66cc66;">=</span> <span style="color: #483d8b;">'Normalized Returns'</span><span style="color: black;">)</span></pre>						</div>
				</div>
				<div class="elementor-element elementor-element-f2840c2 elementor-widget elementor-widget-image" data-id="f2840c2" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
															<img width="1024" height="358" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/norm-1024x358.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/norm-1024x358.png 1024w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/norm-300x105.png 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/norm-768x268.png 768w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/norm-500x175.png 500w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/norm-800x280.png 800w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/norm-1280x447.png 1280w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/norm.png 1288w" sizes="(max-width: 1024px) 100vw, 1024px" />															</div>
				</div>
				<div class="elementor-element elementor-element-d8f0b8e elementor-widget elementor-widget-text-editor" data-id="d8f0b8e" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>This chart nicely displays how each of the stocks from our selection of S&amp;P 500 companies performed over the past year. Since we normalized the returns before, we can compare them easily between individual stocks. Surprisingly, Ford actually outperformed all the tech stocks and more than doubled in value while Johnson &amp; Johnson barely made any advances at all. Note, how the Apple (orange) and SPY (yellow) chart lines are nearly overlapping, confirming the high positive correlation assumption we made earlier when charting the heatmap.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-5ae5653 elementor-widget elementor-widget-text-editor" data-id="5ae5653" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>With this chapter I tried to give you a broad overview on what to do with all your newly collected data and, most importantly, how to do it. There are infinite possibilities to interact with the SMD and in one of my future posts, I will surely go into much more detail. But for now, I&#8217;m confident that the information above suffices for some first manual analysis and charting.</p>						</div>
				</div>
					</div>
		</div>
							</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-0d9c97a elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="0d9c97a" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-793cd80" data-id="793cd80" data-element_type="column">
			<div class="elementor-widget-wrap elementor-element-populated">
								<div class="elementor-element elementor-element-37dc403 elementor-widget elementor-widget-heading" data-id="37dc403" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-default">7. Open Issues</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-58694dc elementor-widget elementor-widget-text-editor" data-id="58694dc" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p style="font-size: 15px; font-style: normal; font-weight: 400; text-align: justify;">This article served as a beginner-friendly and comprehensive guide to building up a MySQL database from scratch for storing historical price data for a large number of financial instruments. I went in great detail over the database schema, table design and initial population via the Alpaca and Yahoo Finance APIs. Additionally, I went over writing a script for updating both, instruments and prices, to keep the database always up-to-date. Lastly, I gave some inspiration on how to interact with the database &#8211; from simple price retrieval and basic plotting to more sophisticated approaches of querying for OHLCV data, creating interactive and dynamic plots from it and working with lists of index constituents.</p><p style="font-size: 15px; font-style: normal; font-weight: 400; text-align: justify;">If you&#8217;ve followed my setup, you now have your personalÂ <i>Securities Master Database</i>Â and know how to interact with it. Having a stable and reliable source of high quality data is already pretty nice, but in the coming blog posts, we will explore even further how to leverage it for backtesting of trading strategies.</p><p style="font-size: 15px; font-style: normal; font-weight: 400; text-align: justify;">Sometime in the future, I&#8217;m planning on upgrading my SMD and sharing my experiences and results in yet another post. Some ideas comprise:</p><ul style="font-size: 15px; font-style: normal; font-weight: 400; text-align: justify;"><li style="font-size: 15px;">hosting the SMD on a Raspberry Pi instead of locally on my Mac</li><li style="font-size: 15px;">setting up user profiles for people other than me</li><li style="font-size: 15px;">building a frontend to explore the contents of the database outside of MySQL Workbench</li><li style="font-size: 15px;">letting the SMD update itself regularly via cronjobs (weekly or even daily)</li><li style="font-size: 15px;">letting the SMD clean itself monthly via cronjobs (check for delisted tickers and delete instrument and price data, check for name changes, e.g. Facebook &gt; Meta and update the instrument table, delete SPACs from the database, etc.)</li><li style="font-size: 15px;">adding new tables for fundamental data, trading strategies, watchlists, etc.</li><li style="font-size: 15px;">&#8230;</li></ul><div style="text-align: justify;">I might also simplify the SMD again and reiterate over the code base to write things more efficiently. For instance, only about 3% of all historical price data currently stems from the Alpaca API. It might be better to use Alpaca for the ticker universe only and later on for its paper &amp; live trading API and leave the historical data retrieval completely to Yahoo Finance for less &#8216;spaghettified&#8217; code and easier consistency.</div><p>Â </p><div style="text-align: justify;">Until then, I hope to see you in the next post! Thanks for reading <img src="https://s.w.org/images/core/emoji/13.1.0/72x72/1f642.png" alt="ðŸ™‚" class="wp-smiley" style="height: 1em; max-height: 1em;" /></div><div style="text-align: justify;">Â </div><div style="text-align: justify;">Cheers, Niklas</div>						</div>
				</div>
					</div>
		</div>
							</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-840e792 elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="840e792" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-f9a73ce" data-id="f9a73ce" data-element_type="column">
			<div class="elementor-widget-wrap elementor-element-populated">
								<div class="elementor-element elementor-element-3063c89 elementor-widget elementor-widget-heading" data-id="3063c89" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-default">8. References</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-d3e3223 elementor-widget elementor-widget-text-editor" data-id="d3e3223" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<div><b>Props to these guys:</b></div><ul style="font-size: 15px; font-style: normal; font-weight: 400;"><li style="font-size: 15px;"><a href="https://www.quantstart.com/articles/Securities-Master-Database-with-MySQL-and-Python/">QuantStart Article</a></li><li style="font-size: 15px;"><a href="https://reasonabledeviations.com/2018/02/01/stock-price-database/#choosing-a-database-management-system">Robert Andrew Martin&#8217;s Blog</a></li><li style="font-size: 15px;"><a href="https://hackingthemarkets.com/">Hacking the Markets</a>Â (<a href="https://www.youtube.com/watch?v=OFnOEIyqSRg&amp;list=PLvzuUVysUFOuoRna8KhschkVVUo2E2g6G">Part Time Larry&#8217;s YouTube Series</a>)</li></ul><div><b>Some more helpful sources:</b></div><div><ul><li><a href="https://algotrading101.com/learn/yfinance-guide/">https://algotrading101.com/learn/yfinance-guide/</a></li><li><a href="https://algotrading101.com/learn/alpaca-trading-api-guide/">https://algotrading101.com/learn/alpaca-trading-api-guide/</a></li></ul></div>						</div>
				</div>
					</div>
		</div>
							</div>
		</section>
						</div>
					</div>
		]]></content:encoded>
					
					<wfw:commentRss>https://niklasbaier.github.io/me/building-up-a-securities-master-database/feed/</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
			</item>
		<item>
		<title>Roadmap to a Full Quant Tech Stack</title>
		<link>https://niklasbaier.github.io/me/roadmap-to-a-full-quant-tech-stack/</link>
					<comments>https://niklasbaier.github.io/me/roadmap-to-a-full-quant-tech-stack/#respond</comments>
		
		<dc:creator><![CDATA[Niklas Baier]]></dc:creator>
		<pubDate>Tue, 16 Nov 2021 12:28:08 +0000</pubDate>
				<category><![CDATA[Algorithmic Trading]]></category>
		<category><![CDATA[Quantitative Finance]]></category>
		<guid isPermaLink="false">https://niklasbaier.github.io/me/?p=43</guid>

					<description><![CDATA[Roadmap to a Full Quant Tech Stack I&#8217;ve wanted to write a blog post like this for quite some time now. As someone who just recently (re-)discovered his love for coding, getting into the universe of existing programs, frameworks, libraries and best practices can feel overwhelming at times. However, after some weeks of experimenting with &#8230;<p class="read-more"> <a class="" href="https://niklasbaier.github.io/me/roadmap-to-a-full-quant-tech-stack/"> <span class="screen-reader-text">Roadmap to a Full Quant Tech Stack</span> Read More &#187;</a></p>]]></description>
										<content:encoded><![CDATA[		<div data-elementor-type="wp-post" data-elementor-id="43" class="elementor elementor-43" data-elementor-settings="[]">
							<div class="elementor-section-wrap">
							<section class="elementor-section elementor-top-section elementor-element elementor-element-2e1b736 elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="2e1b736" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-dd9c330" data-id="dd9c330" data-element_type="column">
			<div class="elementor-widget-wrap elementor-element-populated">
								<div class="elementor-element elementor-element-177ba76 elementor-widget elementor-widget-heading" data-id="177ba76" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h1 class="elementor-heading-title elementor-size-xl">Roadmap to a Full Quant Tech Stack</h1>		</div>
				</div>
				<div class="elementor-element elementor-element-21d91c4 elementor-widget elementor-widget-image" data-id="21d91c4" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
															<img src="https://niklasbaier.github.io/me/wp-content/uploads/elementor/thumbs/network-scaled-ph4oi90r38w1jt3o2oszm62c1fxazij4h8vtcmyehc.jpg" title="network" alt="network" />															</div>
				</div>
				<div class="elementor-element elementor-element-247579b elementor-widget elementor-widget-text-editor" data-id="247579b" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p style="font-size: 15px; font-style: normal; font-weight: 400;">I&#8217;ve wanted to write a blog post like this for quite some time now. As someone who just recently (re-)discovered his love for coding, getting into the universe of existing programs, frameworks, libraries and best practices can feel overwhelming at times.</p><p style="font-size: 15px; font-style: normal; font-weight: 400;">However, after some weeks of experimenting with my setup, I feel confident enough to write this small excerpt about my current tech stack. I will update this overview article from time to time to include my latest insights / tools, so feel free to revisit anytime!</p>						</div>
				</div>
					</div>
		</div>
							</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-7704d82 elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="7704d82" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-ff4c14a" data-id="ff4c14a" data-element_type="column">
			<div class="elementor-widget-wrap elementor-element-populated">
								<div class="elementor-element elementor-element-f905dd8 elementor-widget elementor-widget-heading" data-id="f905dd8" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-default">1. Wait, Full Quant Tech Stack?</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-04113fb elementor-widget elementor-widget-text-editor" data-id="04113fb" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p style="font-size: 15px; font-style: normal; font-weight: 400;"><span style="font-style: inherit; font-weight: inherit; font-family: var( --e-global-typography-text-font-family ), Sans-serif; --darkreader-inline-color: var(--darkreader-text--e-global-color-text); --darkreader-inline-bgcolor: var(--darkreader-bg--ast-global-color-5);">So, what do I mean byÂ </span><span style="font-weight: inherit; font-family: var( --e-global-typography-text-font-family ), Sans-serif; --darkreader-inline-color: var(--darkreader-text--e-global-color-text); --darkreader-inline-bgcolor: var(--darkreader-bg--ast-global-color-5);"><i>Full Quant Tech Stack</i></span><span style="font-style: inherit; font-weight: inherit; font-family: var( --e-global-typography-text-font-family ), Sans-serif; --darkreader-inline-color: var(--darkreader-text--e-global-color-text); --darkreader-inline-bgcolor: var(--darkreader-bg--ast-global-color-5);">? Full stack refers to the full spectrum of a software system &#8211; from front to back, i.e. from a frontend such as a graphical interface / website, to the programming logic in between, all the way to the backend (database). Since I want my quant coding adventures to be as independent of any one-size-fits-all solution as possible, as well as learn how to develop a full application from scratch, I have scouted the internet and most well-known quant exchange websites to come up with a set of tools for my coding endeavours.</span></p><p style="font-size: 15px; font-style: normal; font-weight: 400;">Building up a full tech stack for quantitative / algorithmic trading encompasses the following modules:</p>						</div>
				</div>
				<div class="elementor-element elementor-element-f5eab1d elementor-widget elementor-widget-text-editor" data-id="f5eab1d" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<pre style="font-family: monospace; font-size: 14.4px; margin-bottom: 1rem; color: #212529; font-style: normal; font-weight: 400; background-color: #ffffff;">full-quant-tech-stack/
â”œâ”€ backend/
â”œâ”€ algo-engine/
â”œâ”€ trading-engine/
â”œâ”€ frontend/</pre>						</div>
				</div>
				<div class="elementor-element elementor-element-c298ff8 elementor-widget elementor-widget-image" data-id="c298ff8" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
												<figure class="wp-caption">
										<img width="1024" height="523" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/fullstack-1024x523.jpg" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/fullstack-1024x523.jpg 1024w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/fullstack-300x153.jpg 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/fullstack-768x393.jpg 768w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/fullstack-1536x785.jpg 1536w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/fullstack-2048x1047.jpg 2048w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/fullstack-500x256.jpg 500w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/fullstack-800x409.jpg 800w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/fullstack-1280x654.jpg 1280w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/fullstack-1920x981.jpg 1920w" sizes="(max-width: 1024px) 100vw, 1024px" />											<figcaption class="widget-image-caption wp-caption-text">Not pretty, but I envision the Full Quant Tech Stack modules to play together something like this.</figcaption>
										</figure>
									</div>
				</div>
				<div class="elementor-element elementor-element-2643828 elementor-widget elementor-widget-text-editor" data-id="2643828" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p><span style="text-align: justify;">The idea of this article is to give a brief overview of each of these modules and which tools / libraries I am choosing going forward. Upcoming articles will then go into much more detail on how to build up / work with these tools.</span></p>						</div>
				</div>
					</div>
		</div>
							</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-b73774e elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="b73774e" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-57ff6f0" data-id="57ff6f0" data-element_type="column">
			<div class="elementor-widget-wrap elementor-element-populated">
								<div class="elementor-element elementor-element-2f99319 elementor-widget elementor-widget-heading" data-id="2f99319" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-default">2. Backend - Securities Master Database</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-ceb2316 elementor-widget elementor-widget-text-editor" data-id="ceb2316" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>Arguably the most boring part of a tech stack, but nonetheless indispensable &#8211; without available, clean and high quality data, there is no algorithmic trading.</p><p>For my <i>Securities Master Database</i> (SMD), I decided to go with a simple MySQL database that runs locally on my dev setup. I have plans on hosting this SMD on an always-on Raspberry Pi sometime in the future to have remote access without cluttering my disc.</p><p>Getting said high quality market data still poses a challenge to this date. Due to my student status, I have access to <a href="https://www.bloomberg.com/europe">Bloomberg</a> and <a href="https://www.thomsonreuters.com/en.html">Thomson Reuters</a> at my university, but since my golden student days are coming closer to their end, I don&#8217;t want to be dependent of these paid services in the future. Another popular source of data is <a href="https://finance.yahoo.com/">Yahoo Finance</a>, which I already have some experience with &#8211; good and bad. Other data vendors such as <a href="https://alpaca.markets/">Alpaca</a> provide relatively easy to access data via their API, but mostly only for US equities and over a limited timeframe.</p><p>This leads me to the main problem: deciding on a stock universe to include in the SMD. As already mentioned, data providers such as Alpaca offer very high quality ticker data for thousands of stocks and ETFs, but only from the US. Yahoo Finance offers data for nearly every stock, but requires a very tedious and often times somewhat manual setup.</p><p>I will go into more detail about these issues in the <a href="https://niklasbaier.github.io/me/building-up-a-securities-master-database/">dedicated blog post about the SMD</a>, but for now, I will stick with a combination of the Yahoo Finance and the Alpaca API.</p>						</div>
				</div>
					</div>
		</div>
							</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-8fdbeb6 elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="8fdbeb6" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-e94acaa" data-id="e94acaa" data-element_type="column">
			<div class="elementor-widget-wrap elementor-element-populated">
								<div class="elementor-element elementor-element-a302f4c elementor-widget elementor-widget-heading" data-id="a302f4c" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-default">3. Algo Engine - From Ideation to Performance Evaluation</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-e0d71ac elementor-widget elementor-widget-heading" data-id="e0d71ac" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-medium">3.1. Algorithm Creation &amp; Model Training</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-2daa549 elementor-widget elementor-widget-text-editor" data-id="2daa549" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>This is where it gets exciting! The algorithm or model is the brain of the trading engine and is responsible for issuing buy/sell signals on some predetermined criteria (algorithm) or on its own (artificial intelligence).</p><p>There is a wide variety of established trading strategies that can easily be translated into an algorithmic program. Websites such as <a href="https://quantocracy.com/">Quantocracy</a>, <a href="https://quantpedia.com/">Quantpedia</a>, <a href="https://quantnet.com/forum/home/">QuantNet</a>, <a href="https://www.quantstart.com/">QuantStart</a>, <a href="https://quantivity.wordpress.com/">Quantivity</a>, and <a href="https://quant.stackexchange.com/">Quant Stackexchange</a>Â provide more than enough material and (pseudo-)code to get started. Though not necessarily specialized on the quantitative finance / algorithmic trading domain, <a href="https://paperswithcode.com/">Papers with Code</a>Â can also be a valuable resource.</p><p>I am planning on first translating some simple trading strategies such as the <a href="https://www.investopedia.com/terms/g/goldencross.asp#:~:text=A%20golden%20cross%20is%20a%20technical%20chart%20pattern%20indicating%20the,indicating%20a%20bearish%20price%20movement.">Golden Cross</a> or <a href="https://www.investopedia.com/terms/r/rsi.asp">RSI</a>Â into code and then gradually moving on to more complex strategies as well as developing my own. Once I&#8217;m comfortable with these &#8216;hardcoded&#8217; strategies, I want to explore the usability of machine / deep / reinforcement learning models for automatic strategy generation.</p>						</div>
				</div>
				<div class="elementor-element elementor-element-423ae86 elementor-widget elementor-widget-heading" data-id="423ae86" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-medium">3.2. Backtesting &amp; Performance Evaluation</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-4de9892 elementor-widget elementor-widget-text-editor" data-id="4de9892" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>This part of the quant stack is all about testing the actual performance of a strategy and comparing its key metrics such as annual returns, <a href="https://www.investopedia.com/terms/s/sharperatio.asp">Sharpe Ratio</a> and <a href="https://www.investopedia.com/terms/v/volatility.asp">volatility</a> to those of a given benchmark (most often an index such as the <a href="https://en.wikipedia.org/wiki/S%26P_500">S&amp;P 500</a>).</p><p>The python library <a href="https://www.backtrader.com/">Backtrader</a> is well-suited for this task and can generate beautiful charts as the one below about a strategy&#8217;s execution &amp; portfolio development. Plus, Backtrader is <a href="https://www.backtrader.com/docu/">very well documented</a> and integrates nicely with Alpaca.Â <span style="color: var(--darkreader-text--e-global-color-text); font-family: var( --e-global-typography-text-font-family ), Sans-serif; font-weight: var( --e-global-typography-text-font-weight ); background-color: var(--darkreader-bg--ast-global-color-5); font-size: 1rem;" data-darkreader-inline-color="" data-darkreader-inline-bgcolor="">An alternative would be <a href="https://github.com/polakowo/vectorbt">VectorBT</a>.</span></p>						</div>
				</div>
				<div class="elementor-element elementor-element-9303cc3 elementor-widget elementor-widget-image" data-id="9303cc3" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
												<figure class="wp-caption">
										<img width="1024" height="574" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Figure_0-1024x574.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Figure_0-1024x574.png 1024w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Figure_0-300x168.png 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Figure_0-768x431.png 768w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Figure_0-1536x861.png 1536w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/Figure_0-2048x1148.png 2048w" sizes="(max-width: 1024px) 100vw, 1024px" />											<figcaption class="widget-image-caption wp-caption-text">Backtesting the Golden Cross strategy on WMT using Backtrader.</figcaption>
										</figure>
									</div>
				</div>
				<div class="elementor-element elementor-element-8d3f185 elementor-widget elementor-widget-text-editor" data-id="8d3f185" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p><span style="text-align: justify;">For advanced portfolio analytics, I will be using <a href="https://github.com/ranaroussi/quantstats">QuantStats</a></span><span style="text-align: justify;">, a package by the legendary <a href="https://github.com/ranaroussi">Ran Aroussi</a>Â </span><span style="text-align: justify;">who has also written the <a href="https://github.com/ranaroussi/yfinance">yfinance</a> library that I make heavy usage of for my backend. <a href="https://github.com/quantopian/pyfolio">PyFolio</a> would be an alternative here.</span></p>						</div>
				</div>
				<div class="elementor-element elementor-element-c651e90 elementor-widget elementor-widget-image" data-id="c651e90" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
												<figure class="wp-caption">
										<img width="228" height="1024" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/report-228x1024.jpg" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/11/report-228x1024.jpg 228w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/report-67x300.jpg 67w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/report-768x3448.jpg 768w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/report-342x1536.jpg 342w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/report-456x2048.jpg 456w, https://niklasbaier.github.io/me/wp-content/uploads/2021/11/report-scaled.jpg 570w" sizes="(max-width: 228px) 100vw, 228px" />											<figcaption class="widget-image-caption wp-caption-text">Tear Sheet report using QuantStats.</figcaption>
										</figure>
									</div>
				</div>
					</div>
		</div>
							</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-3d9ad59 elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="3d9ad59" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-0d9cc66" data-id="0d9cc66" data-element_type="column">
			<div class="elementor-widget-wrap elementor-element-populated">
								<div class="elementor-element elementor-element-0455466 elementor-widget elementor-widget-heading" data-id="0455466" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-default">4. Trading Engine - Paper &amp; Live Trading</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-17bab83 elementor-widget elementor-widget-text-editor" data-id="17bab83" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p>After a strategy has been thoroughly tested and refined on historical data, the next step involves connecting the trading engine to a paper trading / virtual portfolio API to test its performance in the real world. Probably the easiest solution here is again the Alpaca API which allows for free-of-charge algorithmic papertrading.</p><p style="font-size: 15px; font-weight: 400;"><span style="font-style: normal;">The ultimate goal of building up this </span><i>Full Quant Tech Stack</i>Â is getting the trading bot live and letting it trade with real money for (hopefully) positive returns. Unfortunately, Alpaca which has been such an easy and comfortable use for the previous steps, does not let non-US citizens issue real transactions via their API. Thus, when the time comes and my first promising trading bot can go live, I will have to find another broker (maybe <a href="https://www.interactivebrokers.com/en/home.php">Interactive Brokers</a>) that works for my purposes. But I have the feeling that this issue still lies far in the future and I will have gathered much more experience and knowledge until then!</p>						</div>
				</div>
					</div>
		</div>
							</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-dd654ff elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="dd654ff" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-ee0aa22" data-id="ee0aa22" data-element_type="column">
			<div class="elementor-widget-wrap elementor-element-populated">
								<div class="elementor-element elementor-element-bd1d471 elementor-widget elementor-widget-heading" data-id="bd1d471" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-default">5. Frontend - Data Exploration (Optional)</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-6945da7 elementor-widget elementor-widget-text-editor" data-id="6945da7" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p style="font-size: 15px; font-style: normal; font-weight: 400;">While tools such as <a href="https://www.mysql.com/products/workbench/">MySQL Workbench</a> already facilitate interacting with the backend, it is relatively easy to build a frontend web-application for data exploration with libraries such as <a href="https://fastapi.tiangolo.com/">FastAPI</a>. I&#8217;m not completely sure yet which elements to include in a potential frontend, but for one: dynamic charts for technical analysis, generated via the <a href="https://github.com/santosjorge/cufflinks">cufflinks</a> library.Â </p>						</div>
				</div>
				<div class="elementor-element elementor-element-bba4721 elementor-widget elementor-widget-image" data-id="bba4721" data-element_type="widget" data-widget_type="image.default">
				<div class="elementor-widget-container">
												<figure class="wp-caption">
										<img width="1024" height="755" src="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/newplot-1-1024x755.png" class="attachment-large size-large" alt="" loading="lazy" srcset="https://niklasbaier.github.io/me/wp-content/uploads/2021/12/newplot-1-1024x755.png 1024w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/newplot-1-300x221.png 300w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/newplot-1-768x566.png 768w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/newplot-1-1536x1132.png 1536w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/newplot-1-500x369.png 500w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/newplot-1-800x590.png 800w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/newplot-1-1280x943.png 1280w, https://niklasbaier.github.io/me/wp-content/uploads/2021/12/newplot-1.png 1704w" sizes="(max-width: 1024px) 100vw, 1024px" />											<figcaption class="widget-image-caption wp-caption-text">Technical Analysis Quant Figure using cufflinks.</figcaption>
										</figure>
									</div>
				</div>
					</div>
		</div>
							</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-03851b1 elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="03851b1" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-bc3c4f1" data-id="bc3c4f1" data-element_type="column">
			<div class="elementor-widget-wrap elementor-element-populated">
								<div class="elementor-element elementor-element-6db4c7a elementor-widget elementor-widget-heading" data-id="6db4c7a" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-default">6. Ready, Set, Code!</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-ddd9761 elementor-widget elementor-widget-text-editor" data-id="ddd9761" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<p style="font-size: 15px; font-style: normal; font-weight: 400;">With these tools set in stone (at least for now), I will begin my Quant Finance / Algotrading coding journey! I will do my best to learn as much as I can as well as documenting my successes, failures and learnings. I am looking forward to you joining me in this exciting adventure!</p><p style="font-size: 15px; font-style: normal; font-weight: 400;">Â </p><p style="font-size: 15px; font-style: normal; font-weight: 400;">Thank you for reading <img src="https://s.w.org/images/core/emoji/13.1.0/72x72/1f642.png" alt="ðŸ™‚" class="wp-smiley" style="height: 1em; max-height: 1em;" /></p><p style="font-size: 15px; font-style: normal; font-weight: 400;">Cheers, Niklas</p>						</div>
				</div>
					</div>
		</div>
							</div>
		</section>
				<section class="elementor-section elementor-top-section elementor-element elementor-element-e333a90 elementor-section-boxed elementor-section-height-default elementor-section-height-default" data-id="e333a90" data-element_type="section">
						<div class="elementor-container elementor-column-gap-default">
					<div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-e369229" data-id="e369229" data-element_type="column">
			<div class="elementor-widget-wrap elementor-element-populated">
								<div class="elementor-element elementor-element-b98ecc5 elementor-widget elementor-widget-heading" data-id="b98ecc5" data-element_type="widget" data-widget_type="heading.default">
				<div class="elementor-widget-container">
			<h2 class="elementor-heading-title elementor-size-default">7. References</h2>		</div>
				</div>
				<div class="elementor-element elementor-element-515420a elementor-widget elementor-widget-text-editor" data-id="515420a" data-element_type="widget" data-widget_type="text-editor.default">
				<div class="elementor-widget-container">
							<ul><li><a href="https://alpaca.markets/learn/algo-trading-landscape/">https://alpaca.markets/learn/algo-trading-landscape/</a></li><li><a href="https://algotrading101.com/learn/quantitative-trader-guide/">https://algotrading101.com/learn/quantitative-trader-guide/</a></li></ul>						</div>
				</div>
					</div>
		</div>
							</div>
		</section>
						</div>
					</div>
		]]></content:encoded>
					
					<wfw:commentRss>https://niklasbaier.github.io/me/roadmap-to-a-full-quant-tech-stack/feed/</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
			</item>
	</channel>
</rss>
